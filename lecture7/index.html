<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <script src="/libs/lunr/lunr.min.js"></script> <script src="/libs/lunr/lunr_index.js"></script> <script src="/libs/lunr/lunrclient.min.js"></script> <link rel=stylesheet  href="/libs/katex/katex.min.css"> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/poole_hyde.css"> <link rel=stylesheet  href="/css/custom.css"> <style> html {font-size: 17px;} .franklin-content {position: relative; padding-left: 8%; padding-right: 5%; line-height: 1.35em;} @media (min-width: 940px) { .franklin-content {width: 100%; margin-left: auto; margin-right: auto;} } @media (max-width: 768px) { .franklin-content {padding-left: 6%; padding-right: 6%;} } </style> <link rel=icon  href="/assets/favicon.png"> <title>Lecture 7</title> <style> .content {max-width: 50rem} </style> <div class=sidebar > <div class="container sidebar-sticky"> <div class=sidebar-about > <img src="/assets/vaw_logo.png" style="width: 180px; height: auto; display: inline"> <div style="font-weight: margin-bottom: 0.5em"><a href="/"> Fall 2022</a> <span style="opacity: 0.7;">| <a href="http://www.vvz.ethz.ch/Vorlesungsverzeichnis/lerneinheit.view?semkez=2022W&ansicht=KATALOGDATEN&lerneinheitId=162403&lang=en"> ETHZ 101-0250-00</a></span></div> <br> <h1><a href="/">Solving partial differential equations in parallel on GPUs</a></h1> <div style="line-height:18px; font-size: 15px; opacity: 0.85">by &nbsp; <a href="https://vaw.ethz.ch/en/people/person-detail.MjcwOTYw.TGlzdC8xOTYxLDE1MTczNjI1ODA=.html">Ludovic Räss</a>, &nbsp; <a href="https://vaw.ethz.ch/en/personen/person-detail.html?persid=124402">Mauro Werder</a>, &nbsp; <a href="https://www.cscs.ch/about/staff/">Samuel Omlin</a> & <br> <a href="https://vaw.ethz.ch/en/people/person-detail.MzAwMjIy.TGlzdC8xOTYxLDE1MTczNjI1ODA=.html">Ivan Utkin</a> </div> </div> <br> <style> </style> <nav class=sidebar-nav  style="opacity: 0.9; margin-bottom: 1.2cm;"> <a class="sidebar-nav-item " href="/"><b>Welcome</b></a> <a class="sidebar-nav-item " href="/logistics/">Logistics</a> <a class="sidebar-nav-item " href="/homework/">Homework</a> <a class="sidebar-nav-item " href="/software_install/">Software install</a> <a class="sidebar-nav-item " href="/extras/">Extras</a> <br> <div class=course-section >Part 1 - Introduction</div> <a class="sidebar-nav-item " href="/lecture1/">Lecture 1 - Why Julia GPU</a> <a class="sidebar-nav-item " href="/lecture2/">Lecture 2 - PDEs & physical processes</a> <a class="sidebar-nav-item " href="/lecture3/">Lecture 3 - Solving elliptic PDEs</a> <div class=course-section >Part 2 - Solving PDEs on GPUs</div> <a class="sidebar-nav-item " href="/lecture4/">Lecture 4 - Porous convection</a> <a class="sidebar-nav-item " href="/lecture5/">Lecture 5 - Parallel computing</a> <a class="sidebar-nav-item " href="/lecture6/">Lecture 6 - GPU computing & perf</a> <div class=course-section >Part 3 - Multi-GPU computing (projects)</div> <a class="sidebar-nav-item active" href="/lecture7/">Lecture 7 - XPU computing</a> <a class="sidebar-nav-item " href="/lecture8/">Lecture 8 - Julia MPI & multi-XPU</a> <a class="sidebar-nav-item " href="/lecture9/">Lecture 9 - Advanced optimisations</a> <div class=course-section >Final Projects</div> <a class="sidebar-nav-item " href="/lecture10/">Lecture 10 - Final projects</a> </nav> <form id=lunrSearchForm  name=lunrSearchForm > <input class=search-input  name=q  placeholder="Enter search term" type=text > <input type=submit  value=Search  formaction="/search/index.html"> </form> <br> <br> </div> </div> <div class="content container"> <div class=franklin-content > <h1 id=lecture_7 ><a href="#lecture_7" class=header-anchor >Lecture 7</a></h1> <blockquote> <p><strong>Agenda</strong><br />📚 The &quot;two-language problem&quot;, <code>ParallelStencil.jl</code> XPU implementation<br />💻 Reference testing, GitHub CI and workflows<br />🚧 Exercises:</p> <ul> <li><p>XPU codes for diffusion / acoustic waves 2D</p> <li><p>Cauchy-Navier elasticity &#40;waves&#41;</p> <li><p>CI workflows</p> </ul> </blockquote> <hr /> <p><a id=content  class=anchor ></a> <strong>Content</strong></p> <div class=franklin-toc ><ol><li><a href="#lecture_7">Lecture 7</a><li><a href="#julia_xpu_the_two-language_solution">Julia XPU: the two-language solution</a><ol><li><a href="#the_two-language_problem">The two-language problem</a><li><a href="#backend_portable_xpu_implementation">Backend portable XPU implementation</a><li><a href="#towards_stokes_flow_i_acoustic_to_elastic">Towards Stokes flow I: acoustic to elastic</a></ol><li><a href="#continuous_integration_ci_and_github_actions">Continuous Integration &#40;CI&#41; and GitHub Actions</a><li><a href="#exercises_-_lecture_7">Exercises - lecture 7</a><ol><li><a href="#exercise_1_-_diffusion_2d_xpu_implementation">Exercise 1 - <strong>Diffusion 2D XPU implementation</strong></a><li><a href="#exercise_2_-_acoustic_2d_xpu_implementation">Exercise 2 - <strong>Acoustic 2D XPU implementation</strong></a><li><a href="#exercise_3_-_cauchy-navier_elastic_waves">Exercise 3 - <strong>Cauchy-Navier elastic waves</strong></a><li><a href="#exercise_4_-_ci_and_github_actions">Exercise 4 - <strong>CI and GitHub Actions</strong></a></ol></ol></div> <p><a href="#exercises_-_lecture_7"><em>👉 get started with exercises</em></a></p> <hr /> <h1 id=julia_xpu_the_two-language_solution ><a href="#julia_xpu_the_two-language_solution" class=header-anchor >Julia XPU: the two-language solution</a></h1> <h3 id=the_goal_of_this_lecture_7 ><a href="#the_goal_of_this_lecture_7" class=header-anchor >The goal of this lecture 7:</a></h3> <ul> <li><p>Address the <strong><em>two-language problem</em></strong></p> <li><p>Backend portable XPU implementation</p> <li><p>Towards Stokes I: acoustic to elastic</p> <li><p>Reference testing, GitHub CI and workflows</p> </ul> <h2 id=the_two-language_problem ><a href="#the_two-language_problem" class=header-anchor >The two-language problem</a></h2> <p>Combining CPU and GPU implementation within a single code.</p> <p>You may certainly be familiar with this situation in scientific computing:</p> <p><img src="../assets/literate_figures/l7-2lang_1.png" alt="two-lang problem" /></p> <p>Which may turn out into a costly cycle:</p> <p><img src="../assets/literate_figures/l7-2lang_2.png" alt="two-lang problem" /></p> <p>This situation is referred to as the <strong><em>two-language problem</em></strong>.</p> <p>Multi-language/software environment leads to:</p> <ul> <li><p>Translation errors</p> <li><p>Large development time &#40;overhead&#41;</p> <li><p>Non-portable solutions</p> </ul> <p>Good news&#33; Julia is a perfect candidate to solve the <strong><em>two-language problem</em></strong> as Julia code is:</p> <ul> <li><p><strong><em>simple</em></strong>, high-level, interactive &#40;low development costs&#41;</p> <li><p><strong><em>fast</em></strong>, compiled just ahead of time &#40;before one uses it for the first time&#41;</p> </ul> <div class=img-med ><img src="../assets/literate_figures/l7-2lang_3.png" alt="two-lang problem" /></div> <p>Julia provides a <strong><em>portable</em></strong> solution in many aspects &#40;beyond performance portability&#41;.</p> <p>As you may have started to experience, GPUs deliver great performance but may not be present in every laptop or workstation. Also, powerful GPUs require to be hosted in servers, especially when multiple GPUs are needed to perform high-resolution calculations.</p> <p>Wouldn&#39;t it be great to have <strong>single code that both executes on CPU and GPU?</strong></p> <blockquote> <p>Using the CPU &quot;backend&quot; for prototyping and debugging, and switching to the GPU &quot;backend&quot; for production purpose.</p> </blockquote> <p>Wouldn&#39;t it be great? ... <strong>YES</strong>, and there is a Julia solution&#33;</p> <div class=img-med ><img src="../assets/literate_figures/ps_logo.png" alt=ParallelStencil  /></div> <h2 id=backend_portable_xpu_implementation ><a href="#backend_portable_xpu_implementation" class=header-anchor >Backend portable XPU implementation</a></h2> <p>Let&#39;s get started with <a href="https://github.com/omlins/ParallelStencil.jl">ParallelStencil.jl</a></p> <h3 id=getting_started_with_parallelstencil ><a href="#getting_started_with_parallelstencil" class=header-anchor >Getting started with ParallelStencil</a></h3> <p>ParallelStencil enables to:</p> <ul> <li><p>Write architecture-agnostic high-level code</p> <li><p>Parallel high-performance stencil computations on GPUs and CPUs</p> </ul> <p>ParallelStencil relies on the native kernel programming capabilities of:</p> <ul> <li><p><a href="https://cuda.juliagpu.org/stable/">CUDA.jl</a> for high-performance computations on GPUs</p> <li><p><a href="https://docs.julialang.org/en/v1/base/multi-threading/#Base.Threads">Base.Threads</a> for high-performance computations on CPUs</p> </ul> <h3 id=short_tour_of_parallelstencils_readme ><a href="#short_tour_of_parallelstencils_readme" class=header-anchor >Short tour of ParallelStencil&#39;s README</a></h3> <p>Before we start our push-up exercises, let&#39;s have a rapid tour of <a href="https://github.com/omlins/ParallelStencil.jl">ParallelStencil</a>&#39;s repo and <a href="https://github.com/omlins/ParallelStencil.jl"><code>README</code></a>.</p> <p><em>So, how does it work?</em></p> <p>As first hands-on for this lecture, let&#39;s <em><strong>merge</strong></em> the diffusion 2D solvers <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/scripts/"><code>diffusion_2D_perf_loop_fun.jl</code></a> and the <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/scripts/"><code>diffusion_2D_perf_gpu.jl</code></a> into a single <em><strong>XPU</strong></em> code using ParallelStencil.</p> <div class=note ><div class=title >💡 Note</div> <div class=messg >Two approaches are possible &#40;we&#39;ll implement both&#41;. Parallelisation using stencil computations with 1&#41; math-close notation; 2&#41; more explicit kernel programming approach.</div></div> <h3 id=stencil_computations_with_math-close_notation ><a href="#stencil_computations_with_math-close_notation" class=header-anchor >Stencil computations with math-close notation</a></h3> <p>Let&#39;s get started with using the ParallelStencil.jl module and the <code>ParallelStencil.FiniteDifferences2D</code> submodule to enable math-close notation.</p> <p>💻 We&#39;ll start from the <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/scripts/"><code>diffusion_2D_perf_gpu.jl</code></a> &#40;available in the <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/scripts/">scripts/</a> folder in case you don&#39;t have it at hand from lecture 6&#41; to create the <code>diffusion_2D_xpu.jl</code> script.</p> <p>The first step is to handle the packages:</p> <pre><code class="julia hljs"><span class=hljs-keyword >const</span> USE_GPU = <span class=hljs-literal >false</span>
<span class=hljs-keyword >using</span> ParallelStencil
<span class=hljs-keyword >using</span> ParallelStencil.FiniteDifferences2D
<span class=hljs-meta >@static</span> <span class=hljs-keyword >if</span> USE_GPU
    <span class=hljs-meta >@init_parallel_stencil</span>(CUDA, <span class=hljs-built_in >Float64</span>, <span class=hljs-number >2</span>)
<span class=hljs-keyword >else</span>
    <span class=hljs-meta >@init_parallel_stencil</span>(Threads, <span class=hljs-built_in >Float64</span>, <span class=hljs-number >2</span>)
<span class=hljs-keyword >end</span>
<span class=hljs-keyword >using</span> Plots, Printf</code></pre> <p>Then, we need to create two compute functions , <code>compute_q&#33;</code> to compute the fluxes, and <code>compute_C&#33;</code> for computing the update of <code>C</code>, the quantity we diffusion &#40;e.g. concentration&#41;.</p> <p>Let&#39;s start with <code>compute_q&#33;</code>. There we want to program the following fluxes</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msub><mi>q</mi><mi>x</mi></msub><mo>=</mo><mo>−</mo><mi>D</mi><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>C</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>x</mi></mrow></mfrac><mtext> </mtext><mo separator=true >,</mo><mtext> </mtext><msub><mi>q</mi><mi>y</mi></msub><mo>=</mo><mo>−</mo><mi>D</mi><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>C</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>y</mi></mrow></mfrac><mtext> </mtext><mi mathvariant=normal >.</mi></mrow><annotation encoding="application/x-tex"> q_x = -D\frac{∂C}{∂x} ~,~~ q_y = -D\frac{∂C}{∂y} ~.</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord >−</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace nobreak"> </span><span class=mpunct >,</span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.25188em;vertical-align:-0.8804400000000001em;"></span><span class=mord >−</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace nobreak"> </span><span class=mord >.</span></span></span></span></span> <p>ParallelStencil&#39;s <code>FiniteDifferences2D</code> submodule provides macros we need: <code>@all&#40;&#41;</code>, <code>@d_xi&#40;&#41;</code>, <code>@d_yi&#40;&#41;</code>.</p> <p>The macros used in this example are described in the Module documentation callable from the Julia REPL / IJulia:</p> <pre><code class="julia hljs">julia&gt; <span class=hljs-keyword >using</span> ParallelStencil.FiniteDifferences2D

julia&gt;?

help?&gt; <span class=hljs-meta >@all</span></code></pre> <p>This would, e.g., give you more infos about the <code>@all</code> macro.</p> <p>So, back to our compute function &#40;kernel&#41;. The <code>compute_q&#33;</code> function gets the <code>@parallel</code> macro in its definition and returns nothing.</p> <p>Inside, we define the flux definition as following:</p> <pre><code class="julia hljs"><span class=hljs-meta >@parallel</span> <span class=hljs-keyword >function</span> compute_q!(qx, qy, C, D, dx, dy)
    <span class=hljs-meta >@all</span>(qx) = -D*<span class=hljs-meta >@d_xi</span>(C)/dx
    <span class=hljs-meta >@all</span>(qy) = -D*<span class=hljs-meta >@d_yi</span>(C)/dy
    <span class=hljs-keyword >return</span>
<span class=hljs-keyword >end</span></code></pre> <p>Now that we&#39;re done with <code>compute_q&#33;</code>, your turn&#33;</p> <p>By analogy, update <code>compute_C&#33;</code>.</p> <pre><code class="julia hljs"><span class=hljs-meta >@parallel</span> <span class=hljs-keyword >function</span> compute_C!(C, qx, qy, dt, dx, dy)
   <span class=hljs-meta >@inn</span>(C) = <span class=hljs-meta >@inn</span>(C) - dt*( <span class=hljs-meta >@d_xa</span>(qx)/dx + <span class=hljs-meta >@d_ya</span>(qy)/dy )
    <span class=hljs-keyword >return</span>
<span class=hljs-keyword >end</span></code></pre> <p>So far so good. We are done with the kernels. Let&#39;s see what changes are needed in the main part of the script.</p> <p>In the <code># Physics</code> section, change total time to <code>ttot &#61; 1e2</code>. The <code># Numerics</code> only needs <code>nx</code>, <code>ny</code> and <code>nout</code>; the kernel launch parameters being now automatically adapted:</p> <pre><code class="julia hljs"><span class=hljs-meta >@views</span> <span class=hljs-keyword >function</span> diffusion_2D(; do_visu=<span class=hljs-literal >false</span>)
    <span class=hljs-comment ># Physics</span>
    Lx, Ly  = <span class=hljs-number >10.0</span>, <span class=hljs-number >10.0</span>
    D       = <span class=hljs-number >1.0</span>
    ttot    = <span class=hljs-number >1e2</span>
    <span class=hljs-comment ># Numerics</span>
    nx, ny  = <span class=hljs-number >32</span>*<span class=hljs-number >4</span>, <span class=hljs-number >32</span>*<span class=hljs-number >4</span> <span class=hljs-comment ># number of grid points</span>
    nout    = <span class=hljs-number >50</span>
    <span class=hljs-comment ># [...]</span>
    <span class=hljs-keyword >return</span>
<span class=hljs-keyword >end</span></code></pre> <p>In the <code># Derived numerics</code>, we can skip the scalar pre-processing, keeping only</p> <pre><code class="julia hljs"><span class=hljs-comment ># [...]</span>
<span class=hljs-comment ># Derived numerics</span>
dx, dy  = Lx/nx, Ly/ny
dt      = min(dx,dy)^<span class=hljs-number >2</span>/D/<span class=hljs-number >4.1</span>
nt      = cld(ttot, dt)
xc, yc  = <span class=hljs-built_in >LinRange</span>(dx/<span class=hljs-number >2</span>, Lx-dx/<span class=hljs-number >2</span>, nx), <span class=hljs-built_in >LinRange</span>(dy/<span class=hljs-number >2</span>, Ly-dy/<span class=hljs-number >2</span>, ny)
<span class=hljs-comment ># [...]</span></code></pre> <p>In the <code># Array initialisation</code> section, we need to wrap the Gaussian by <code>Data.Array</code> &#40;instead of <code>CuArray</code>&#41; and initialise the flux arrays:</p> <pre><code class="julia hljs"><span class=hljs-comment ># [...]</span>
<span class=hljs-comment ># Array initialisation</span>
C       = Data.<span class=hljs-built_in >Array</span>(exp.(.-(xc .- Lx/<span class=hljs-number >2</span>).^<span class=hljs-number >2</span> .-(yc&#x27; .- Ly/<span class=hljs-number >2</span>).^<span class=hljs-number >2</span>))
qx      = <span class=hljs-meta >@zeros</span>(nx-<span class=hljs-number >1</span>,ny-<span class=hljs-number >2</span>)
qy      = <span class=hljs-meta >@zeros</span>(nx-<span class=hljs-number >2</span>,ny-<span class=hljs-number >1</span>)
<span class=hljs-comment ># [...]</span></code></pre> <p>In the <code># Time loop</code>, only the kernel call needs to be worked out. We can here re-use the single <code>@parallel</code> macro which now serves to launch the computations on the chosen backend:</p> <pre><code class="julia hljs"><span class=hljs-comment ># [...]</span>
t_tic = <span class=hljs-number >0.0</span>; niter = <span class=hljs-number >0</span>
<span class=hljs-comment ># Time loop</span>
<span class=hljs-keyword >for</span> it = <span class=hljs-number >1</span>:nt
    <span class=hljs-keyword >if</span> (it==<span class=hljs-number >11</span>) t_tic = Base.time(); niter = <span class=hljs-number >0</span> <span class=hljs-keyword >end</span>
    <span class=hljs-meta >@parallel</span> compute_q!(qx, qy, C, D, dx, dy)
    <span class=hljs-meta >@parallel</span> compute_C!(C, qx, qy, dt, dx, dy)
    niter += <span class=hljs-number >1</span>
    <span class=hljs-keyword >if</span> do_visu &amp;&amp; (it % nout == <span class=hljs-number >0</span>)
        <span class=hljs-comment ># visualisation unchanged</span>
    <span class=hljs-keyword >end</span>
<span class=hljs-keyword >end</span>
<span class=hljs-comment ># [...]</span></code></pre> <p>The performance evaluation section remaining unchanged, we are all set&#33;</p> <p><strong>Wrap-up tasks</strong></p> <ul> <li><p>Let&#39;s execute the code having the <code>USE_GPU &#61; false</code> flag set. We are running on multi-threading CPU backend with multi-threading enabled.</p> <li><p>Changing the <code>USE_GPU</code> flag to <code>true</code> &#40;having first relaunched a Julia session&#41; will make the application running on a GPU. On the GPU, you can reduce <code>ttot</code> and increase <code>nx, ny</code> in order achieve higher <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi mathvariant=normal >e</mi><mi mathvariant=normal >f</mi><mi mathvariant=normal >f</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_\mathrm{eff}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">e</span><span class="mord mathrm mtight" style="margin-right:0.07778em;">f</span><span class="mord mathrm mtight" style="margin-right:0.07778em;">f</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.</p> </ul> <div class=note ><div class=title >💡 Note</div> <div class=messg >Curious to see how it works under the hood? Feel free to <a href="https://github.com/omlins/ParallelStencil.jl/blob/cd59a5b0d1fd32ceaecbf7fc922ab87a24257781/src/ParallelKernel/parallel.jl#L263">explore the source code</a>. Another nice bit of open source software &#40;and the fact that Julia&#39;s meta programming rocks 🚀&#41;.</div></div> <h3 id=stencil_computations_with_more_explicit_kernel_programming_approach ><a href="#stencil_computations_with_more_explicit_kernel_programming_approach" class=header-anchor >Stencil computations with more explicit kernel programming approach</a></h3> <p>ParallelStencil also allows for more explicit kernel programming, enabled by <code>@parallel_indices</code> kernel definitions. In style, the codes are closer to the initial plain GPU version we started from, <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/scripts/"><code>diffusion_2D_perf_gpu.jl</code></a>.</p> <p>As the macro name suggests, kernels defined using <code>@parallel_indices</code> allow for explicit indices handling within the kernel operations. This approach is <em><strong>currently</strong></em> more performant than using <code>@parallel</code> kernel definitions.</p> <p>As second push-up, let&#39;s transform the <code>diffusion_2D_xpu.jl</code> into <code>diffusion_2D_perf_xpu.jl</code>.</p> <p>💻 We&#39;ll need bits from both <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/scripts/"><code>diffusion_2D_perf_gpu.jl</code></a> and <code>diffusion_2D_xpu.jl</code>.</p> <p>We can keep the package handling and initialisation identical to what we implemented in the <code>diffusion_2D_xpu.jl</code> script.</p> <p>Then, we can start from the flux macro an compute function definition from the <code>diffusion_2D_perf_gpu.jl</code> script, removing the <code>ix</code>, <code>iy</code> indices as those are now handled by ParallelStencil. The function definition takes however the <code>@parallel_indices</code> macro and the <code>&#40;ix,iy&#41;</code> tuple:</p> <pre><code class="julia hljs"><span class=hljs-comment ># macros to avoid array allocation</span>
<span class=hljs-keyword >macro</span> qx(ix,iy)  esc(:( -D_dx*(C[$ix+<span class=hljs-number >1</span>,$iy+<span class=hljs-number >1</span>] - C[$ix,$iy+<span class=hljs-number >1</span>]) )) <span class=hljs-keyword >end</span>
<span class=hljs-keyword >macro</span> qy(ix,iy)  esc(:( -D_dy*(C[$ix+<span class=hljs-number >1</span>,$iy+<span class=hljs-number >1</span>] - C[$ix+<span class=hljs-number >1</span>,$iy]) )) <span class=hljs-keyword >end</span>

<span class=hljs-meta >@parallel_indices</span> (ix,iy) <span class=hljs-keyword >function</span> compute!(C2, C, D_dx, D_dy, dt, _dx, _dy, size_C1_2, size_C2_2)
    <span class=hljs-keyword >if</span> (ix&lt;=size_C1_2 &amp;&amp; iy&lt;=size_C2_2)
        C2[ix+<span class=hljs-number >1</span>,iy+<span class=hljs-number >1</span>] = C[ix+<span class=hljs-number >1</span>,iy+<span class=hljs-number >1</span>] - dt*( (<span class=hljs-meta >@qx</span>(ix+<span class=hljs-number >1</span>,iy) - <span class=hljs-meta >@qx</span>(ix,iy))*_dx + (<span class=hljs-meta >@qy</span>(ix,iy+<span class=hljs-number >1</span>) - <span class=hljs-meta >@qy</span>(ix,iy))*_dy )
    <span class=hljs-keyword >end</span>
    <span class=hljs-keyword >return</span>
<span class=hljs-keyword >end</span></code></pre> <p>The <code># Physics</code> section remains unchanged, and the <code># Numerics section</code> is identical to the previous <code>xpu</code> script, i.e., no need for explicit block and thread definition.</p> <div class=warning ><div class=title >⚠️ Warning&#33;</div> <div class=messg >ParallelStencil computes the GPU kernel launch parameters based on optimal heuristics. Recalling lecture 6, multiple of 32 are most optimal; number of grid points should thus be chosen accordingly, i.e. as multiple of 32.</div></div> <p>We can then keep the scalar preprocessing &#40;<code>D_dx</code>, <code>D_dy</code>, <code>_dx</code>, <code>_dy</code>&#41; in the <code># Derived numerics</code> section.</p> <p>In the <code># Array initialisation</code>, make sure wrapping the Gaussian by <code>Data.Array</code>. The <code>cuthreads</code> and <code>cublocks</code> tuples are no longer needed.</p> <p>The <code># Time loop</code> gets very concise; XPU kernels are launched here also with <code>@parallel</code> macro &#40;that implicitly includes <code>synchronize&#40;&#41;</code> statement&#41;:</p> <pre><code class="julia hljs"><span class=hljs-comment ># Time loop</span>
<span class=hljs-keyword >for</span> it = <span class=hljs-number >1</span>:nt
    <span class=hljs-keyword >if</span> (it==<span class=hljs-number >11</span>) t_tic = Base.time(); niter = <span class=hljs-number >0</span> <span class=hljs-keyword >end</span>
    <span class=hljs-meta >@parallel</span> compute!(C2, C, D_dx, D_dy, dt, _dx, _dy, size_C1_2, size_C2_2)
    C, C2 = C2, C <span class=hljs-comment ># pointer swap</span>
    niter += <span class=hljs-number >1</span>
    <span class=hljs-keyword >if</span> do_visu &amp;&amp; (it % nout == <span class=hljs-number >0</span>)
        <span class=hljs-comment ># visu unchanged</span>
    <span class=hljs-keyword >end</span>
<span class=hljs-keyword >end</span></code></pre> <p>Here we go 🚀 The <code>diffusion_2D_perf_xpu.jl</code> code is ready and should squeeze the performance out of your CPU or GPU, running as fast as the exclusive Julia multi-threaded or Julia GPU implementations, respectively.</p> <h3 id=multi-xpu_support ><a href="#multi-xpu_support" class=header-anchor >Multi-XPU support</a></h3> <p><em>What about multi-XPU support and distributed memory parallelisation?</em></p> <p>ParallelStencil is seamlessly interoperable with <a href=""><code>ImplicitGlobalGrid.jl</code></a>, which enables distributed parallelisation of stencil-based XPU applications on a regular staggered grid and enables close to ideal weak scaling of real-world applications on thousands of GPUs.</p> <p>Moreover, ParallelStencil enables hiding communication behind computation with a simple macro call and without any particular restrictions on the package used for communication.</p> <p><em>This will be material for next lectures.</em></p> <div class=note ><div class=title >💡 Note</div> <div class=messg >Head to ParallelStencil&#39;s <a href="https://github.com/omlins/ParallelStencil.jl#concise-singlemulti-xpu-miniapps">miniapp section</a> if you are curious about various domain science applications featrued there.</div></div> <h2 id=towards_stokes_flow_i_acoustic_to_elastic ><a href="#towards_stokes_flow_i_acoustic_to_elastic" class=header-anchor >Towards Stokes flow I: acoustic to elastic</a></h2> <p>Pursuing the exploration of various physical processes, we are missing two important categories: solid mechanics &#40;e.g., Navier-Cauchy equations&#41; and fluid mechanics &#40;e.g., Navier-Stokes equations&#41;.</p> <p>The goal of this part of the lecture is to explore the elastic wave propagation processes, building upon acoustic waves from lecture 3.</p> <p>We&#39;ll use a practical approach to familiarise with stress, strain, strain-rates and elastic rheology, i.e., the elastic shear and bulk modulus. &#40;We&#39;ll concentrate on the fluid mechanics in a following lecture.&#41;</p> <p>The <a href="https://en.wikipedia.org/wiki/Linear_elasticity#Elastodynamics_in_terms_of_displacements">Navier-Cauchy equation</a> we are interested in reads as following, when expressed &#40;linearised&#41; in terms of velocities &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mo>=</mo><msup><mi mathvariant=normal >∂</mi><mn>2</mn></msup><mi>u</mi><mi mathvariant=normal >/</mi><mi mathvariant=normal >∂</mi><msup><mi>t</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">v=∂^2u/∂t^2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.064108em;vertical-align:-0.25em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">u</span><span class=mord >/</span><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal">t</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>&#41;:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>P</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mo>−</mo><mi>K</mi><msub><mi mathvariant=normal >∇</mi><mi>k</mi></msub><msub><mi>v</mi><mi>k</mi></msub><mtext> </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex"> \frac{∂P}{∂t} = -K ∇_k v_k ~,</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class=mord >−</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class=mord ><span class=mord >∇</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class=mpunct >,</span></span></span></span></span> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>τ</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mi>μ</mi><mrow><mo fence=true >(</mo><msub><mi mathvariant=normal >∇</mi><mi>i</mi></msub><msub><mi>v</mi><mi>j</mi></msub><mo>+</mo><msub><mi mathvariant=normal >∇</mi><mi>j</mi></msub><msub><mi>v</mi><mi>i</mi></msub><mo>−</mo><mfrac><mn>1</mn><mn>3</mn></mfrac><msub><mi>δ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi mathvariant=normal >∇</mi><mi>k</mi></msub><msub><mi>v</mi><mi>k</mi></msub><mo fence=true >)</mo></mrow><mtext> </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex"> \frac{∂τ}{∂t} = μ\left(∇_i v_j + ∇_j v_i -\frac{1}{3} δ_{ij} ∇_k v_k \right) ~,</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="mord mathnormal">μ</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=mord ><span class=mord >∇</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class=mord >∇</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.32144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >3</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03785em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mord ><span class=mord >∇</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace nobreak"> </span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span></span></span></span></span> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>ρ</mi><mfrac><mrow><mi mathvariant=normal >∂</mi><msub><mi>v</mi><mi>i</mi></msub></mrow><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow></mfrac><mo>=</mo><msub><mi mathvariant=normal >∇</mi><mi>j</mi></msub><mrow><mo fence=true >(</mo><msub><mi>τ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>−</mo><mi>P</mi><msub><mi>δ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo fence=true >)</mo></mrow><mtext> </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex"> ρ \frac{∂v_i}{∂t} = ∇_j \left( τ_{ij} - P δ_{ij} \right) ~,</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord mathnormal">ρ</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.036108em;vertical-align:-0.286108em;"></span><span class=mord ><span class=mord >∇</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;">(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03785em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace nobreak"> </span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span></span></span></span></span> <p>where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> is the pressure, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span> the velocity, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> the bulk modulus, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi></mrow><annotation encoding="application/x-tex">μ</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">μ</span></span></span></span> the elastic shear modulus, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>τ</mi></mrow><annotation encoding="application/x-tex">τ</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span></span></span></span> the deviatoric stress tensor, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ρ</mi></mrow><annotation encoding="application/x-tex">ρ</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ρ</span></span></span></span> the density, and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>δ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\delta_{ij}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.980548em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03785em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> the Kronecker delta.</p> <p>One can recognise the terms from the acoustic wave equation, namely:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>P</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mo>−</mo><mi>K</mi><msub><mi mathvariant=normal >∇</mi><mi>k</mi></msub><msub><mi>v</mi><mi>k</mi></msub><mtext> </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex"> \frac{∂P}{∂t} = -K ∇_k v_k ~,</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class=mord >−</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class=mord ><span class=mord >∇</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class=mpunct >,</span></span></span></span></span> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>ρ</mi><mfrac><mrow><mi mathvariant=normal >∂</mi><msub><mi>v</mi><mi>i</mi></msub></mrow><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow></mfrac><mo>=</mo><msub><mi mathvariant=normal >∇</mi><mi>j</mi></msub><mrow><mo fence=true >(</mo><mo>−</mo><mi>P</mi><msub><mi>δ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo fence=true >)</mo></mrow><mtext> </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex"> ρ \frac{∂v_i}{∂t} = ∇_j \left( - P δ_{ij} \right)~,</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord mathnormal">ρ</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.036108em;vertical-align:-0.286108em;"></span><span class=mord ><span class=mord >∇</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;">(</span><span class=mord >−</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03785em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace nobreak"> </span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span></span></span></span></span> <p>which suggests only volumetric or bulk effects to be considered in the latter.</p> <p>Note that the original constitutive relation in linear elasticity &#40;elastic rheology&#41; is</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>σ</mi><mo>=</mo><mo>−</mo><mi>P</mi><mo>+</mo><mi>μ</mi><mrow><mo fence=true >(</mo><msub><mi mathvariant=normal >∇</mi><mi>i</mi></msub><msub><mi>u</mi><mi>j</mi></msub><mo>+</mo><msub><mi mathvariant=normal >∇</mi><mi>j</mi></msub><msub><mi>u</mi><mi>i</mi></msub><mo fence=true >)</mo></mrow><mtext> </mtext><mi mathvariant=normal >.</mi></mrow><annotation encoding="application/x-tex"> σ = -P + μ \left(∇_i u_j + ∇_j u_i \right) ~.</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.76666em;vertical-align:-0.08333em;"></span><span class=mord >−</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathnormal">μ</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;">(</span><span class=mord ><span class=mord >∇</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">u</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class=mord >∇</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">u</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace nobreak"> </span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >.</span></span></span></span></span> <p>However, we here consider deviatoric stresses <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><mi>τ</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">(τ)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span><span class=mclose >)</span></span></span></span> &#40;removing the trace of the stress tensor - the pressure <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>&#41; and derive the expression w.r.t. time to express it as function of strain-rates <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><mi>v</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">(v)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=mclose >)</span></span></span></span>.</p> <h3 id=task_1_-_starting_from_acoustic ><a href="#task_1_-_starting_from_acoustic" class=header-anchor >Task 1 - starting from acoustic</a></h3> <p>The task is now to implement the Navier-Cauchy equations in 2D starting from the acoustic 2D script realised in lecture 3.</p> <p>We can start from the <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/scripts/"><code>acoustic_2D_elast0.jl</code></a> script located in the &#40;available in the <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/scripts/">scripts/</a> folder&#41;.</p> <p>After running the script to confirm all works as expected, start by:</p> <ul> <li><p>making a new version of the script: <code>acoustic_2D_elast1.jl</code></p> <li><p>modifying the array dimensions in order to have velocity arrays with appropriate sizes allowing to update all pressure values <code>&#40;nx, ny&#41;</code>,</p> <li><p>renaming <code>qx</code> and <code>qy</code> to <code>dVxdt</code> and <code>dVydt</code>, respectively.</p> </ul> <h3 id=task_2_-_adding_normal_stresses ><a href="#task_2_-_adding_normal_stresses" class=header-anchor >Task 2 - adding normal stresses</a></h3> <p>The next task is to add the normal stress, the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">xx</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class="mord mathnormal">x</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">yy</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> components of the stress tensor.</p> <p>One can make the analogy of stresses being &quot;fluxes of momentum&quot;, the velocity equations &#40;4&#41; being the momentum balance. Since we here consider elastic processes &#40;Cauchy-Navier elasticity&#41;, these fluxes will be time dependent &#40;see eq. 3&#41;.</p> <p>Start by making a new version of the script named <code>acoustic_2D_elast2.jl</code>. Then, add for the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">xx</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class="mord mathnormal">x</span></span></span></span> normal stress component following &#40;the array needs to be initialised&#41;:</p> <pre><code class="julia hljs">τxx  .= τxx .+ dt*(<span class=hljs-number >2.0</span>.*μ.* (diff(Vx,dims=<span class=hljs-number >1</span>)/dx .- <span class=hljs-number >1</span>/<span class=hljs-number >3</span> .*∇V))</code></pre>
<p>Note that one has to remove the divergence &#40;volumetric part&#41; of the stress tensor if considering its deviatoric form &#40;removing the trace of the tensor, i.e. the pressure we explicitly define and compute&#41;.</p>
<p>Also, adding elastic shear rheology, we need to define the elastic shear modulus <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">μ = 1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">μ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >1</span></span></span></span> in the <code># Physics</code> section.</p>
<p>Repeat this for the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">yy</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> normal stress component:</p>
<pre><code class="julia hljs">τyy  .= τyy .+ dt*(<span class=hljs-number >2.0</span>.*μ.* (diff(Vy,dims=<span class=hljs-number >2</span>)/dy) .- <span class=hljs-number >1.0</span>/<span class=hljs-number >3.0</span> .*∇V)</code></pre>
<p>We now have to fix the divergence which is not yet defined, replacing the appropriate calculation by &#40;that needs to be initialised&#41;:</p>
<pre><code class="julia hljs">∇V    .= diff(Vx,dims=<span class=hljs-number >1</span>)./dx .+ diff(Vy,dims=<span class=hljs-number >2</span>)./dy</code></pre>
<p>Having added elasticity to the acoustic process &#40;elastic stresses instead of only pressure&#41;, we need to adapt the time step stability condition:</p>
<pre><code class="julia hljs">dt     = min(dx,dy)/sqrt((K + <span class=hljs-number >4</span>/<span class=hljs-number >3</span>*μ)/ρ)/<span class=hljs-number >2.1</span></code></pre>
<p>to take shear modulus <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi></mrow><annotation encoding="application/x-tex">μ</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">μ</span></span></span></span> into account.</p>
<p>This new addition should now permit to propagate a first elastic wave. However, taking a closer look at the animation, you may certainly see that the wave propagates as a square. Reason for this is that we are missing the shear stress, the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">xy</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> components of the tensor &#40;see figure below&#41;.</p>
<div class=img-med ><img src="../assets/literate_figures/l7-elast.gif" alt="elastic missing shear" /></div>
<p>We&#39;re soon done.</p>
<p>However, his last part is a <a href="#exercise_3_-_cauchy-navier_elastic_waves">homework task</a>.</p>
<p>Now it&#39;s <strong>time to wrap up</strong> this part before moving to more Git workflows. So far, we learned about:</p>
<ul>
<li><p>How Julia solves the two-language problem</p>

<li><p>XPU programming with ParallelStencil</p>

<li><p>Cauchy-Navier elastic wave propagation &#40;solid mechanics&#41;</p>

</ul>

<p><a href="#content">⤴ <em><strong>back to Content</strong></em></a></p>
<h1 id=continuous_integration_ci_and_github_actions ><a href="#continuous_integration_ci_and_github_actions" class=header-anchor >Continuous Integration &#40;CI&#41; and GitHub Actions</a></h1>
<p>Last lecture we learned how to make and run tests for a Julia project.</p>
<p>This lecture we will learn how to run those tests on Github automatically after you push to it. This will make sure that</p>
<ul>
<li><p>tests are always run</p>

<li><p>you will be alerted by email when a test fails</p>

</ul>
<p><em>You may start to wonder why we&#39;re doing all of these tooling shenanigans...</em></p>
<p>One requirement for the final project will be that it contains tests, which are run via GitHub Actions CI.  Additionally, you&#39;ll have to write your project report as &quot;documentation&quot; for the package which will be deployed to its website, again via GitHub Actions.</p>
<p><strong>These days it is expected of good numerical software that it is well tested and documented.</strong></p>
<h3 id=github_actions ><a href="#github_actions" class=header-anchor >GitHub Actions</a></h3>
<p>GitHub Actions are a generic way to run computations when you interact with the repository. There is extensive <a href="https://docs.github.com/en/actions">documentation</a> for it &#40;no need for you to read it&#41;.</p>
<p>For instance the course&#39;s <a href="https://eth-vaw-glaciology.github.io/course-101-0250-00/">website</a> is generated from the markdown input files upon pushing to the repo:</p>
<ul>
<li><p><a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/tree/main/website">https://github.com/eth-vaw-glaciology/course-101-0250-00/tree/main/website</a> contains the source</p>

<li><p>the <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/.github/workflows/Deploy.yml">https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/.github/workflows/Deploy.yml</a> is the GitHub Actions script which tells it to run Franklin.jl to</p>

<li><p>create the website <a href="https://eth-vaw-glaciology.github.io/course-101-0250-00/">https://eth-vaw-glaciology.github.io/course-101-0250-00/</a></p>

</ul>
<h3 id=github_actions_for_ci ><a href="#github_actions_for_ci" class=header-anchor >GitHub Actions for CI</a></h3>
<p>How do we use GitHub Actions for CI?</p>
<ol>
<li><p>create a Julia project and add some tests</p>

<li><p>make a suitable GitHub Actions scrip &#40;that <code>.yml</code> file&#41;</p>

<li><p>pushing to GitHub will now run the tests &#40;maybe you need to activate Actions in <code>Setting</code> -&gt; <code>Actions</code> -&gt; <code>Allow all actions</code>&#41;</p>

</ol>
<div class=note ><div class=title >💡 Note</div>
<div class=messg >There are other providers of CI, e.g. Travis, Appveyor, etc. Here we&#39;ll only look at GitHub actions.</div></div>
<h4 id=example_from_last_lecture_continued ><a href="#example_from_last_lecture_continued" class=header-anchor >Example from last lecture continued</a></h4>
<p>In the last lecture I setup a <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00-L6Testing.jl">project</a> to illustrate how unit-testing works.</p>
<p>Let&#39;s now add CI to this:</p>
<ol>
<li><p>create a Julia project and add some tests <strong>&#91;done&#93;</strong></p>

<li><p>make a suitable GitHub Actions scrip &#40;that <code>.yml</code> file&#41;</p>

<li><p>pushing to GitHub will now run the tests &#40;maybe you need to activate Actions in <code>Setting</code> -&gt; <code>Actions</code> -&gt; <code>Allow all actions</code>&#41;</p>

</ol>
<p>For step 2 we follow the documentation on <a href="https://github.com/julia-actions/julia-runtest">https://github.com/julia-actions/julia-runtest</a>.</p>
<div class=note ><div class=title >💡 Note</div>
<div class=messg ><a href="https://github.com/invenia/PkgTemplates.jl">PkgTemplates.jl</a> is a handy package, which can generate a suitable Github Actions file.</div></div>
<h4 id=example_from_last_lecture_continued_yml_magic ><a href="#example_from_last_lecture_continued_yml_magic" class=header-anchor >Example from last lecture continued: YML magic</a></h4>
<p>The <code>.yml</code> file, adapted from the <code>README</code> of <a href="https://github.com/julia-actions/julia-runtest">julia-runtest</a>:</p>
<pre><code class="yml hljs"><span class=hljs-attr >name:</span> <span class=hljs-string >Run</span> <span class=hljs-string >tests</span>

<span class=hljs-attr >on:</span> [<span class=hljs-string >push</span>, <span class=hljs-string >pull_request</span>]

<span class=hljs-attr >jobs:</span>
  <span class=hljs-attr >test:</span>
    <span class=hljs-attr >runs-on:</span> <span class=hljs-string >${{</span> <span class=hljs-string >matrix.os</span> <span class=hljs-string >}}</span>
    <span class=hljs-attr >strategy:</span>
      <span class=hljs-attr >matrix:</span>
        <span class=hljs-attr >julia-version:</span> [<span class=hljs-string >&#x27;1.6&#x27;</span>]
        <span class=hljs-attr >julia-arch:</span> [<span class=hljs-string >x64</span>]
        <span class=hljs-attr >os:</span> [<span class=hljs-string >ubuntu-latest</span>]

    <span class=hljs-attr >steps:</span>
      <span class=hljs-bullet >-</span> <span class=hljs-attr >uses:</span> <span class=hljs-string >actions/checkout@v2</span>
      <span class=hljs-bullet >-</span> <span class=hljs-attr >uses:</span> <span class=hljs-string >julia-actions/setup-julia@v1</span>
        <span class=hljs-attr >with:</span>
          <span class=hljs-attr >version:</span> <span class=hljs-string >${{</span> <span class=hljs-string >matrix.julia-version</span> <span class=hljs-string >}}</span>
          <span class=hljs-attr >arch:</span> <span class=hljs-string >${{</span> <span class=hljs-string >matrix.julia-arch</span> <span class=hljs-string >}}</span>
      <span class=hljs-bullet >-</span> <span class=hljs-attr >uses:</span> <span class=hljs-string >julia-actions/julia-buildpkg@v1</span>
      <span class=hljs-bullet >-</span> <span class=hljs-attr >uses:</span> <span class=hljs-string >julia-actions/julia-runtest@v1</span></code></pre>
<h4 id=where_is_my_badge ><a href="#where_is_my_badge" class=header-anchor >Where is my BADGE&#33;&#33;&#33;</a></h4>
<p>The CI will create a badge &#40;a small picture&#41; which reflects the status of the Action. Typically added to the <code>README.md</code>:</p>
<p><img src="../assets/literate_figures/ci-badge.png" alt=ci-badge  /></p>
<p>It can be found under</p>
<pre><code class="julia hljs">https://github.com/&lt;USER&gt;/&lt;REPO&gt;/actions/workflows/CI.yml/badge.svg</code></pre>
<p>and should be added to the near the top of <code>README</code> like so:</p>
<pre><code class="julia hljs">[![CI action](https://github.com/&lt;USER&gt;/&lt;REPO&gt;/actions/workflows/CI.yml/badge.svg)](https://github.com/&lt;USER&gt;/&lt;REPO&gt;/actions/workflows/CI.yml)</code></pre>
<p>&#40;this also sets the link to the Actions which gets open upon clicking on it&#41;</p>
<p>👉 <em><strong>All together</strong></em> on <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00-L6Testing.jl">https://github.com/eth-vaw-glaciology/course-101-0250-00-L6Testing.jl</a></p>
<h4 id=wait_a_second_we_submit_our_homework_as_subfolders_of_our_github_repo ><a href="#wait_a_second_we_submit_our_homework_as_subfolders_of_our_github_repo" class=header-anchor >Wait a second, we submit our homework as subfolders of our GitHub repo...</a></h4>
<p>This makes the <code>.yml</code> a bit more complicated:</p>
<pre><code class="yml hljs"><span class=hljs-attr >name:</span> <span class=hljs-string >CI</span>
<span class=hljs-attr >on:</span>
  [<span class=hljs-string >push</span>, <span class=hljs-string >pull_request</span>]
<span class=hljs-attr >jobs:</span>
  <span class=hljs-attr >test:</span>
    <span class=hljs-attr >name:</span> <span class=hljs-string >Julia</span> <span class=hljs-string >${{</span> <span class=hljs-string >matrix.julia-version</span> <span class=hljs-string >}}</span> <span class=hljs-bullet >-</span> <span class=hljs-string >${{</span> <span class=hljs-string >matrix.os</span> <span class=hljs-string >}}</span> <span class=hljs-bullet >-</span> <span class=hljs-string >${{</span> <span class=hljs-string >matrix.julia-arch</span> <span class=hljs-string >}}</span> <span class=hljs-bullet >-</span> <span class=hljs-string >${{</span> <span class=hljs-string >github.event_name</span> <span class=hljs-string >}}</span>
    <span class=hljs-attr >runs-on:</span> <span class=hljs-string >${{</span> <span class=hljs-string >matrix.os</span> <span class=hljs-string >}}</span>
    <span class=hljs-attr >strategy:</span>
      <span class=hljs-attr >fail-fast:</span> <span class=hljs-literal >false</span>
      <span class=hljs-attr >matrix:</span>
        <span class=hljs-attr >julia-version:</span> [<span class=hljs-string >&#x27;1.6&#x27;</span>]
        <span class=hljs-attr >julia-arch:</span> [<span class=hljs-string >x64</span>]
        <span class=hljs-attr >os:</span> [<span class=hljs-string >ubuntu-latest</span>]
    <span class=hljs-attr >steps:</span>
      <span class=hljs-bullet >-</span> <span class=hljs-attr >uses:</span> <span class=hljs-string >actions/checkout@v2</span>
      <span class=hljs-bullet >-</span> <span class=hljs-attr >uses:</span> <span class=hljs-string >julia-actions/setup-julia@v1</span>
        <span class=hljs-attr >with:</span>
          <span class=hljs-attr >version:</span> <span class=hljs-string >${{</span> <span class=hljs-string >matrix.julia-version</span> <span class=hljs-string >}}</span>
          <span class=hljs-attr >arch:</span> <span class=hljs-string >${{</span> <span class=hljs-string >matrix.julia-arch</span> <span class=hljs-string >}}</span>
      <span class=hljs-bullet >-</span> <span class=hljs-attr >uses:</span> <span class=hljs-string >actions/cache@v1</span>
        <span class=hljs-attr >env:</span>
          <span class=hljs-attr >cache-name:</span> <span class=hljs-string >cache-artifacts</span>
        <span class=hljs-attr >with:</span>
          <span class=hljs-attr >path:</span> <span class=hljs-string >~/.julia/artifacts</span>
          <span class=hljs-attr >key:</span> <span class=hljs-string >${{</span> <span class=hljs-string >runner.os</span> <span class=hljs-string >}}-test-${{</span> <span class=hljs-string >env.cache-name</span> <span class=hljs-string >}}-${{</span> <span class=hljs-string >hashFiles(&#x27;**/Project.toml&#x27;)</span> <span class=hljs-string >}}</span>
          <span class=hljs-attr >restore-keys:</span> <span class=hljs-string >|
            ${{ runner.os }}-test-${{ env.cache-name }}-
            ${{ runner.os }}-test-
            ${{ runner.os }}-
</span>      <span class=hljs-bullet >-</span> <span class=hljs-attr >uses:</span> <span class=hljs-string >julia-actions/julia-buildpkg@v1</span>
      <span class=hljs-bullet >-</span> <span class=hljs-attr >run:</span> <span class=hljs-string >julia</span> <span class=hljs-string >--check-bounds=yes</span> <span class=hljs-string >--color=yes</span> <span class=hljs-string >-e</span> <span class=hljs-string >&#x27;cd(&quot;&lt;subfolder-of-julia-project&gt;&quot;); import Pkg; Pkg.activate(&quot;.&quot;); Pkg.test()&#x27;</span></code></pre>
<p>Note that you have to <em><strong>adjust</strong></em> the bit: <code>cd&#40;&quot;&lt;subfolder-of-julia-project&gt;&quot;&#41;</code>.</p>
<p>👉 The <em><strong>example</strong></em> is in <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00-L6Testing-subfolder.jl">course-101-0250-00-L6Testing-subfolder.jl</a>.</p>
<h4 id=a_final_note ><a href="#a_final_note" class=header-anchor >A final note</a></h4>
<p>GitHub Actions are limited to 2000min per month per user for private repositories.</p>

<p><a href="#content">⤴ <em><strong>back to Content</strong></em></a></p>
<h1 id=exercises_-_lecture_7 ><a href="#exercises_-_lecture_7" class=header-anchor >Exercises - lecture 7</a></h1>
<div class=warning ><div class=title >⚠️ Warning&#33;</div>
<div class=messg >Exercises have to be handed in as monolithic Julia scripts &#40;one code per script&#41; and uploaded to your private &#40;shared&#41; GitHub repository, in a <strong>specific folder for each lecture</strong>. The git commit hash &#40;or SHA&#41; of the final push needs to be uploaded on Moodle &#40;<a href="/homework">more</a>&#41;.</div></div>
<h2 id=exercise_1_-_diffusion_2d_xpu_implementation ><a href="#exercise_1_-_diffusion_2d_xpu_implementation" class=header-anchor >Exercise 1 - <strong>Diffusion 2D XPU implementation</strong></a></h2>
<p>👉 See <a href="/logistics/#submission">Logistics</a> for submission details.</p>
<p>The goal of this exercise is to:</p>
<ul>
<li><p>Finalise the XPU implementation of the 2D diffusion code started in class</p>

<li><p>Familiarise with XPU programming, <code>@parallel</code> and <code>@parallel_indices</code></p>

</ul>
<p>In this exercise, you will finalise the diffusion 2D scripts started during lecture 7.</p>
<p>Create a new folder in your GitHub repository for this week&#39;s &#40;lecture 7&#41; exercises. In there, create a new subfolder <code>diffusion2D_xpu</code> where you will add following script:</p>
<ul>
<li><p><code>diffusion_2D_xpu.jl</code></p>

<li><p><code>diffusion_2D_perf_xpu.jl</code></p>

</ul>
<h3 id=task_1 ><a href="#task_1" class=header-anchor >Task 1</a></h3>
<p>Finalise the <code>diffusion_2D_xpu.jl</code> script from class.</p>
<ul>
<li><p>This version should contain compute functions &#40;kernels&#41; definitions using <code>@parallel</code> approach together with using <code>ParallelStencil.FiniteDifferences2D</code> submodule.</p>

<li><p>Include the kwarg <code>do_visu</code> to allow disabling plotting when assessing performance.</p>

<li><p>Also, make sure to include and update the performance evaluation section at the end of the script &#40;as in the previous GPU and CPU script versions&#41;.</p>

</ul>
<p>You can get started looking at the <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/scripts/"><code>diffusion_2D_perf_gpu.jl</code></a> script &#40;available in the <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/scripts/">scripts/</a> folder in case you don&#39;t have it at hand from lecture 6&#41;.</p>
<h3 id=task_2 ><a href="#task_2" class=header-anchor >Task 2</a></h3>
<p>Finalise the <code>diffusion_2D_perf_xpu.jl</code> script from class.</p>
<ul>
<li><p>This version should contain compute functions &#40;kernels&#41; definitions using <code>@parallel_indices</code> approach.</p>

<li><p>Use a macros for the flux definition to avoid unnecessary memory accesses. Also, make sure to adapt the array you initialise.</p>

<li><p>Include the kwarg <code>do_visu</code> to allow disabling plotting when assessing performance.</p>

<li><p>Also, make sure to include and update the performance evaluation section at the end of the script &#40;as in the previous GPU and CPU script versions&#41;.</p>

</ul>
<h3 id=task_3 ><a href="#task_3" class=header-anchor >Task 3</a></h3>
<p>Create a <code>README.md</code> file in your lecture 7 GitHub folder, adding a first section about &quot;Diffusion 2D XPU performance&quot;.</p>
<p>In this section, include a figure reporting the performance of both the <code>diffusion_2D_xpu.jl</code> and <code>diffusion_2D_perf_xpu.jl</code> implementation of the diffusion 2D solver using the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi mathvariant=normal >e</mi><mi mathvariant=normal >f</mi><mi mathvariant=normal >f</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_\mathrm{eff}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">e</span><span class="mord mathrm mtight" style="margin-right:0.07778em;">f</span><span class="mord mathrm mtight" style="margin-right:0.07778em;">f</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> metric.</p>
<p>Vary the number of grid points <code>nx &#61; ny &#61; 16 * 2 .^ &#40;1:8&#41;</code> &#40;or until you run out of memory on the GPU&#41;. Report as well the value for memory copy <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi mathvariant=normal >p</mi><mi mathvariant=normal >e</mi><mi mathvariant=normal >a</mi><mi mathvariant=normal >k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_\mathrm{peak}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.969438em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">p</span><span class="mord mathrm mtight">e</span><span class="mord mathrm mtight">a</span><span class="mord mathrm mtight">k</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> of the given GPU &#40;and arithmetic precision&#41; you are using. Make sure to including figure axis labels and add a short figure caption or description to the <code>README</code>.</p>
<div class=note ><div class=title >💡 Note</div>
<div class=messg >Remember that for performance benchmark purpose, the code needs only to run a couple of seconds. Adapt, e.g., <code>ttot</code> &#40;or <code>nt</code>&#41; as function of the number of grid points to achieve this &#40;avoiding the high-resolution runs to take forever to finalise&#41;.</div></div>

<p><a href="#content">⤴ <em><strong>back to Content</strong></em></a></p>
<hr />
<h2 id=exercise_2_-_acoustic_2d_xpu_implementation ><a href="#exercise_2_-_acoustic_2d_xpu_implementation" class=header-anchor >Exercise 2 - <strong>Acoustic 2D XPU implementation</strong></a></h2>
<p>👉 See <a href="/logistics/#submission">Logistics</a> for submission details.</p>
<p>The goal of this exercise is to:</p>
<ul>
<li><p>Create a XPU implementation of the 2D acoustic code</p>

<li><p>Familiarise with XPU programming, <code>@parallel</code> and <code>@parallel_indices</code></p>

</ul>
<p>In this exercise, you will create an acoustic 2D scripts, &quot;merging&quot; the multi-threaded CPU version <code>acoustic_2D_perf_loop_fun.jl</code> and the plain GPU version <code>acoustic_2D_perf_gpu.jl</code> from last week&#39;s lecture 6.</p>
<p>In this week&#39;s lecture 7 GitHub folder, create a new subfolder <code>acoustic2D_xpu</code> where you will add following script:</p>
<ul>
<li><p><code>acoustic_2D_xpu.jl</code></p>

<li><p><code>acoustic_2D_perf_xpu.jl</code></p>

</ul>
<h3 id=task_1__2 ><a href="#task_1__2" class=header-anchor >Task 1</a></h3>
<p>Start working on the <code>acoustic_2D_xpu.jl</code> script.</p>
<ul>
<li><p>This version should contain compute functions &#40;kernels&#41; definitions using <code>@parallel</code> approach together with using <code>ParallelStencil.FiniteDifferences2D</code> submodule.</p>

<li><p>Include the kwarg <code>do_visu</code> to allow disabling plotting when assessing performance.</p>

<li><p>Also, make sure to include and update the performance evaluation section at the end of the script &#40;as in the previous GPU and CPU script versions&#41;.</p>

</ul>
<p>To get get started, get inspired by the <code>diffusion_2D_xpu.jl</code> script we mostly terminated in class during lecture 7 and the know-how you acquired finalising exercise 1.</p>
<p>If you still struggle getting started you&#39;ll find, after homework 6 due-date, the <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/scripts/"><code>acoustic_2D_perf_gpu.jl</code></a> script in the <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/scripts/">scripts/</a> folder.</p>
<h3 id=task_2__2 ><a href="#task_2__2" class=header-anchor >Task 2</a></h3>
<p>Create the <code>acoustic_2D_perf_xpu.jl</code> script.</p>
<ul>
<li><p>This version should contain compute functions &#40;kernels&#41; definitions using <code>@parallel_indices</code> approach.</p>

<li><p>Include the kwarg <code>do_visu</code> to allow disabling plotting when assessing performance.</p>

<li><p>Also, make sure to include and update the performance evaluation section at the end of the script &#40;as in the previous GPU and CPU script versions&#41;.</p>

</ul>
<h3 id=task_3__2 ><a href="#task_3__2" class=header-anchor >Task 3</a></h3>
<p>Create a <code>README.md</code> file in your lecture 7 GitHub folder, adding a second section about &quot;Acoustic 2D XPU performance&quot;.</p>
<p>In this section, include one figure that reporting the performance of both the <code>acoustic_2D_xpu.jl</code> and <code>acoustic_2D_perf_xpu.jl</code> implementation of the acoustic 2D solver using the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi mathvariant=normal >e</mi><mi mathvariant=normal >f</mi><mi mathvariant=normal >f</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_\mathrm{eff}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">e</span><span class="mord mathrm mtight" style="margin-right:0.07778em;">f</span><span class="mord mathrm mtight" style="margin-right:0.07778em;">f</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> metric.</p>
<p>Vary the number of grid points <code>nx &#61; ny &#61; 16 * 2 .^ &#40;1:8&#41;</code> &#40;or until you run out of memory on the GPU&#41;. Report as well the value for memory copy <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi mathvariant=normal >p</mi><mi mathvariant=normal >e</mi><mi mathvariant=normal >a</mi><mi mathvariant=normal >k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_\mathrm{peak}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.969438em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">p</span><span class="mord mathrm mtight">e</span><span class="mord mathrm mtight">a</span><span class="mord mathrm mtight">k</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> of the given GPU &#40;and arithmetic precision&#41; you are using. Make sure to including figure axis labels and add a short figure caption or description to the <code>README</code>.</p>

<p><a href="#content">⤴ <em><strong>back to Content</strong></em></a></p>
<hr />
<h2 id=exercise_3_-_cauchy-navier_elastic_waves ><a href="#exercise_3_-_cauchy-navier_elastic_waves" class=header-anchor >Exercise 3 - <strong>Cauchy-Navier elastic waves</strong></a></h2>
<p>👉 See <a href="/logistics/#submission">Logistics</a> for submission details.</p>
<p>The goal of this exercise is to:</p>
<ul>
<li><p>Familiarise with Cauch-Navier elasticity</p>

<li><p>Step from acoustic waves to elastic waves</p>

<li><p>Get a glimpse into solid mechanics</p>

</ul>
<h3 id=getting_started ><a href="#getting_started" class=header-anchor >Getting started</a></h3>
<p>In this exercises your task will be to terminate the 2D implementation of an elastic wave solver based on the <a href="#towards_stokes_flow_i_acoustic_to_elastic">Cauchy-Navier elasticity as presented in lecture 7</a>.</p>
<p>In class, we stopped at <a href="#task_2_-_adding_normal_stresses"><strong>Task 2</strong></a>, adding normal stress components.</p>
<p>The remaining 2 tasks to achieve a full implementation of the 2D elastic wave solver are:</p>
<ul>
<li><p>adding shear stresses</p>

<li><p>re-arranging the order of computation</p>

</ul>
<p>Create a folder titles <code>elastic2D</code> within this week&#39;s lecture 7 GitHub parent folder. Copy in there the following codes developed in class &#40;refer to the <a href="#towards_stokes_flow_i_acoustic_to_elastic">course section</a> for directions regarding details implementing these 3 code versions&#41;:</p>
<ul>
<li><p><code>acoustic_2D_elast0.jl</code></p>

<li><p><code>acoustic_2D_elast1.jl</code></p>

<li><p><code>acoustic_2D_elast2.jl</code></p>

</ul>
<h3 id=task_3_-_adding_shear_stresses ><a href="#task_3_-_adding_shear_stresses" class=header-anchor >Task 3 - adding shear stresses</a></h3>
<p>Start by making a new duplicate of the latest <code>acoustic_2D_elast2.jl</code> script, renaming it <code>acoustic_2D_elast3.jl</code>. In this new script, add the shear stress <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">xy</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> component:</p>
<pre><code class="julia hljs">τxy  .= τxy .+ ??</code></pre>
<p>Note that we assume the strain&#40;-rate&#41; tensor to be symmetric, thus the following is to be assumed <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>τ</mi><mrow><mi>x</mi><mi>y</mi></mrow></msub><mo>=</mo><msub><mi>τ</mi><mrow><mi>y</mi><mi>x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">τ_{xy} = τ_{yx}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.716668em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.716668em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>.</p>
<p>Make sure to correctly interpret <a href="https://en.wikipedia.org/wiki/Einstein_notation">Einstein&#39;s notation</a> - normal <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><msub><mi>τ</mi><mrow><mi>x</mi><mi>x</mi></mrow></msub><mo separator=true >,</mo><msub><mi>τ</mi><mrow><mi>y</mi><mi>y</mi></mrow></msub><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">(τ_{xx}, τ_{yy})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.036108em;vertical-align:-0.286108em;"></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span> and shear <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><msub><mi>τ</mi><mrow><mi>x</mi><mi>y</mi></mrow></msub><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">(τ_{xy})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.036108em;vertical-align:-0.286108em;"></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span> stresses are not defined in the same way.</p>
<div class=note ><div class=title >💡 Note</div>
<div class=messg >Transforming <a href="https://en.wikipedia.org/wiki/Einstein_notation">Einstein&#39;s notation</a> into code: rate of change of normal stress <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >∂</mi><msub><mi>τ</mi><mrow><mi>x</mi><mi>x</mi></mrow></msub><mi mathvariant=normal >/</mi><mi mathvariant=normal >∂</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">∂τ_{xx}/∂t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord >/</span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span></span> is defined as <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mtext> </mtext><mi>μ</mi><mtext> </mtext><mo stretchy=false >(</mo><mi mathvariant=normal >∂</mi><msub><mi>v</mi><mi>x</mi></msub><mi mathvariant=normal >/</mi><mi mathvariant=normal >∂</mi><mi>x</mi><mo>−</mo><mn>1</mn><mi mathvariant=normal >/</mi><mn>3</mn><mi mathvariant=normal >∇</mi><mi>v</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">2~μ~(∂v_x/∂x -1/3∇v)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >2</span><span class="mspace nobreak"> </span><span class="mord mathnormal">μ</span><span class="mspace nobreak"> </span><span class=mopen >(</span><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord >/</span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">x</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >1</span><span class=mord >/</span><span class=mord >3</span><span class=mord >∇</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=mclose >)</span></span></span></span>, i.e. two <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>μ</mi></mrow><annotation encoding="application/x-tex">2μ</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class=mord >2</span><span class="mord mathnormal">μ</span></span></span></span> times the normal strain-rate. For the rate of change of the shear stress <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >∂</mi><msub><mi>τ</mi><mrow><mi>x</mi><mi>y</mi></mrow></msub><mi mathvariant=normal >/</mi><mi mathvariant=normal >∂</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">∂τ_{xy}/∂t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.036108em;vertical-align:-0.286108em;"></span><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mord >/</span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span></span>, the shear strain-rate defines as <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi mathvariant=normal >/</mi><mn>2</mn><mtext> </mtext><mo stretchy=false >(</mo><mi mathvariant=normal >∂</mi><msub><mi>v</mi><mi>x</mi></msub><mi mathvariant=normal >/</mi><mi mathvariant=normal >∂</mi><mi>y</mi><mo>+</mo><mi mathvariant=normal >∂</mi><msub><mi>v</mi><mi>y</mi></msub><mi mathvariant=normal >/</mi><mi mathvariant=normal >∂</mi><mi>x</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">1/2~(∂v_x/∂y + ∂v_y/∂x)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >1</span><span class=mord >/</span><span class=mord >2</span><span class="mspace nobreak"> </span><span class=mopen >(</span><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord >/</span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1.036108em;vertical-align:-0.286108em;"></span><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mord >/</span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">x</span><span class=mclose >)</span></span></span></span>. Make sure to implement it consistently.</div></div>
<p><img src="../assets/literate_figures/stagg_elast_ex7.png" alt="2D staggered grid" /></p>
<p>The shear stress <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>τ</mi><mrow><mi>x</mi><mi>y</mi></mrow></msub></mrow><annotation encoding="application/x-tex">τ_{xy}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.716668em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> derivative needs then to be included into the momentum equations, used to compute the rate of change of velocity in both <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> direction &#40;similarly to the normal stress&#41;.</p>
<div class=note ><div class=title >💡 Note</div>
<div class=messg >Make sure to take the &quot;cross-derivative&quot; of the shear stress when adding them to the momentum equation; use <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >∂</mi><msub><mi>τ</mi><mrow><mi>x</mi><mi>y</mi></mrow></msub><mi mathvariant=normal >/</mi><mi mathvariant=normal >∂</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">∂τ_{xy}/∂y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.036108em;vertical-align:-0.286108em;"></span><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mord >/</span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> when computing <code>dVxdt</code> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >∂</mi><msub><mi>τ</mi><mrow><mi>x</mi><mi>y</mi></mrow></msub><mi mathvariant=normal >/</mi><mi mathvariant=normal >∂</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">∂τ_{xy}/∂x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.036108em;vertical-align:-0.286108em;"></span><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mord >/</span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">x</span></span></span></span> for computing <code>dVydt</code>.</div></div>
<h3 id=task_4_-_rearranging_the_code ><a href="#task_4_-_rearranging_the_code" class=header-anchor >Task 4 - rearranging the code</a></h3>
<p>For enhanced stability of the elastic solver, it is important to use the newly computed quantities as soon as possible.</p>
<p>Create a last duplicate of the <code>acoustic_2D_elast3.jl</code> script, renaming it <code>elastic_2D.jl</code>.</p>
<p>In this final version of the script, move the pressure update at the beginning of the time loop. First update pressure in order to use the updated pressure later on when computing the pressure gradient in the velocity update.</p>
<p>You should now have a 2D elastic solver up and running 🚀</p>
<h3 id=final_task ><a href="#final_task" class=header-anchor >Final Task</a></h3>
<p>Compare the results between acoustic and elastic wave propagation for identical physical and numerical input parameters. Create one figure for each simulation that you add to the <code>README</code> in a new final section. Comment briefly about the results.</p>

<p><a href="#content">⤴ <em><strong>back to Content</strong></em></a></p>
<hr />
<h2 id=exercise_4_-_ci_and_github_actions ><a href="#exercise_4_-_ci_and_github_actions" class=header-anchor >Exercise 4 - <strong>CI and GitHub Actions</strong></a></h2>
<p>👉 See <a href="/logistics/#submission">Logistics</a> for submission details.</p>
<p>The goal of this exercise is to:</p>
<ul>
<li><p>setup Continuous Integration with GitHub Actions</p>

</ul>
<h3 id=tasks ><a href="#tasks" class=header-anchor >Tasks</a></h3>
<ul>
<li><p>copy the repository you created for Lecture6-Exercise3 over to your Lecture7 solution folder as <code>L7CIExercise</code> &#40;if you did not complete that exercise, use the package <a href="https://github.com/mauro3/SimpleTraits.jl">https://github.com/mauro3/SimpleTraits.jl</a> instead, make sure to not copy over the <code>.github</code> and <code>.git</code> folders&#41;</p>

<li><p>follow/revisit the lecture and in particular look at the example at <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00-L6Testing-subfolder.jl">https://github.com/eth-vaw-glaciology/course-101-0250-00-L6Testing-subfolder.jl</a> to setup CI</p>

<li><p>push to GitHub and make sure the CI runs and passes</p>

<li><p>add the CI-badge to the folder-local <code>README.md</code></p>

</ul>

<p><a href="#content">⤴ <em><strong>back to Content</strong></em></a></p>
<div class=page-foot >
  <div class=copyright >
    <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/"><b>Edit this page on <img class=github-logo  src="https://unpkg.com/ionicons@5.1.2/dist/svg/logo-github.svg"></b></a><br>
    Last modified: September 20, 2022. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div>
    </div>