<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/course-101-0250-00/libs/katex/katex.min.css"> <link rel=stylesheet  href="/course-101-0250-00/libs/highlight/github.min.css"> <link rel=stylesheet  href="/course-101-0250-00/css/franklin.css"> <link rel=stylesheet  href="/course-101-0250-00/css/poole_hyde.css"> <link rel=stylesheet  href="/course-101-0250-00/css/custom.css"> <style> html {font-size: 17px;} .franklin-content {position: relative; padding-left: 8%; padding-right: 5%; line-height: 1.35em;} @media (min-width: 940px) { .franklin-content {width: 100%; margin-left: auto; margin-right: auto;} } @media (max-width: 768px) { .franklin-content {padding-left: 6%; padding-right: 6%;} } </style> <link rel=icon  href="/course-101-0250-00/assets/favicon.png"> <title>Lecture 10</title> <style> .content {max-width: 50rem} </style> <div class=sidebar > <div class="container sidebar-sticky"> <div class=sidebar-about > <img src="/course-101-0250-00/assets/vaw_logo.png" style="width: 180px; height: auto; display: inline"> <div style="font-weight: margin-bottom: 0.5em"><a href="/course-101-0250-00/"> Fall 2021</a> <span style="opacity: 0.7;">| <a href="http://www.vvz.ethz.ch/Vorlesungsverzeichnis/lerneinheit.view?semkez=2021W&ansicht=KATALOGDATEN&lerneinheitId=155538&lang=en"> ETHZ 101-0250-00</a></span></div> <br> <h1><a href="/course-101-0250-00/">Solving partial differential equations in parallel on GPUs</a></h1> <div style="line-height:18px; font-size: 15px; opacity: 0.85">by <a href="https://vaw.ethz.ch/en/people/person-detail.MjcwOTYw.TGlzdC8xOTYxLDE1MTczNjI1ODA=.html">Ludovic RÃ¤ss</a>, <a href="https://vaw.ethz.ch/en/personen/person-detail.html?persid=124402">Mauro Werder</a> & <a href="https://www.cscs.ch/about/staff/">Samuel Omlin</a> </div> </div> <br> <style> </style> <nav class=sidebar-nav  style="opacity: 0.9"> <a class="sidebar-nav-item " href="/course-101-0250-00/"><b>Welcome</b></a> <a class="sidebar-nav-item " href="/course-101-0250-00/logistics/">Logistics</a> <a class="sidebar-nav-item " href="/course-101-0250-00/homework/">Homework</a> <a class="sidebar-nav-item " href="/course-101-0250-00/software_install/">Software install</a> <a class="sidebar-nav-item " href="/course-101-0250-00/extras/">Extras</a> <br> <div class=course-section >Part 1 - Introduction</div> <a class="sidebar-nav-item active" href="/course-101-0250-00/lecture1/">Lecture 1 - Why Julia GPU</a> <a class="sidebar-nav-item " href="/course-101-0250-00/lecture2/">Lecture 2 - ODEs & PDEs</a> <a class="sidebar-nav-item " href="/course-101-0250-00/lecture3/">Lecture 3 - Acoustic waves</a> <a class="sidebar-nav-item " href="/course-101-0250-00/lecture4/">Lecture 4 - Implicit & nonlinear</a> <div class=course-section >Part 2 - Solving PDEs on GPUs</div> <a class="sidebar-nav-item " href="/course-101-0250-00/lecture5/">Lecture 5 - Parallel computing</a> <a class="sidebar-nav-item " href="/course-101-0250-00/lecture6/">Lecture 6 - GPU computing & perf</a> <a class="sidebar-nav-item " href="/course-101-0250-00/lecture7/">Lecture 7 - XPU computing</a> <a class="sidebar-nav-item " href="/course-101-0250-00/lecture8/">Lecture 8 - Julia MPI & multi-XPU</a> <a class="sidebar-nav-item " href="/course-101-0250-00/lecture9/">Lecture 9 - Advanced optimisations</a> <div class=course-section >Part 3 - Projects</div> <a class="sidebar-nav-item active" href="/course-101-0250-00/lecture10/">Lecture 10 - Final projects</a> <br> </nav> </div> </div> <div class="content container"> <div class=franklin-content > <h1 id=final_projects ><a href="#final_projects" class=header-anchor >Final projects</a></h1> <blockquote> <p><strong>Agenda</strong><br />ðŸ“š Final projects<br />ðŸ’» MPI &amp; Advanced optimisations Q&amp;A<br />ðŸš§ Exercises: Q&amp;A</p> </blockquote> <hr /> <p><strong>Content</strong></p> <div class=franklin-toc ><ol><li><a href="#final_projects">Final projects</a><ol><li><a href="#information_about_final_projects">Information about final projects</a><li><a href="#getting_started_with_the_final_projects">Getting started with the final projects</a><li><a href="#project_submission">Project submission</a><li><a href="#project_grading">Project grading</a></ol></ol></div> <hr /> <h2 id=information_about_final_projects ><a href="#information_about_final_projects" class=header-anchor >Information about final projects</a></h2> <p>Final projects will provide 60&#37; of the course grade. We recommend you work in teams of two, but being your own teammate is fine too.</p> <p><em>Note that a single GitHub repository is sufficient per project.</em></p> <p><strong>Project&#39;s due date is XXX &#40;enforced by a &quot;release tag v1.0.0&quot;&#41;.</strong></p> <p><a href="https://github.com/eth-vaw-glaciology/FinalProjectRepo.jl"><strong>Project template</strong> available here</a> - copy or clone to get started.</p> <hr /> <p>Final projects compose of 2 distinct parts &#40;50&#37; of the project mark each&#41; to be handed-in on a single GitHub repository, including scripts, documentation &#40;and code documentation&#41;, unit and reference testing, Continuous Integration &#40;CI - using e.g. GitHub Actions&#41;, instructions to run the software and reproduce the results, references.</p> <h3 id=part_1_3d_multi-xpus_diffusion_solver ><a href="#part_1_3d_multi-xpus_diffusion_solver" class=header-anchor >Part 1: 3D multi-XPUs diffusion solver</a></h3> <p>Steady state solution of a diffusive process for given physical time steps using the pseudo-transient acceleration &#40;using the so-called &quot;<a href="&#40;/lecture4/#implicit_solutions&#41;">dual-time</a>&quot; method&#41;.</p> <p>Your task in <strong><em>part 1</em></strong> is to solve the linear diffusion equation in 3D</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><mi mathvariant=normal >âˆ‚</mi><mi>H</mi></mrow><mrow><mi mathvariant=normal >âˆ‚</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mi mathvariant=normal >âˆ‡</mi><mo>â‹…</mo><mi>D</mi><mtext> </mtext><mi mathvariant=normal >âˆ‡</mi><mi>H</mi><mtext> </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex"> \frac{âˆ‚H}{âˆ‚t} = âˆ‡ â‹… D\;âˆ‡H ~ ,</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span><span class=vlist-s >â€‹</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class=mord >âˆ‡</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >â‹…</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord >âˆ‡</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mspace nobreak"> </span><span class=mpunct >,</span></span></span></span></span> <p>where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">D=1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >1</span></span></span></span>, using an implicit iterative approach leveraging pseudo-transient acceleration &#40;see <a href="/course-101-0250-00/lecture4/#steady-state_and_implicit_iterative_solutions">Lecture 4</a>&#41;. Use following physical parameters</p> <pre><code class="julia hljs">lx, ly, lz = <span class=hljs-number >10.0</span>, <span class=hljs-number >10.0</span>, <span class=hljs-number >10.0</span> <span class=hljs-comment ># domain size</span>
D          = <span class=hljs-number >1.0</span>              <span class=hljs-comment ># diffusion coefficient</span>
ttot       = <span class=hljs-number >1.0</span>              <span class=hljs-comment ># total simulation time</span>
dt         = <span class=hljs-number >0.2</span>              <span class=hljs-comment ># physical time step</span></code></pre> <p>and converge your reference solution to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant=normal >t</mi><mi mathvariant=normal >o</mi><msub><mi mathvariant=normal >l</mi><mrow><mi mathvariant=normal >n</mi><mi mathvariant=normal >l</mi></mrow></msub></mrow><mo>=</mo><mn>1</mn><msup><mn>0</mn><mrow><mo>âˆ’</mo><mn>8</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\mathrm{tol_{nl}} = 10^{-8}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.84444em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathrm">t</span><span class="mord mathrm">o</span><span class=mord ><span class="mord mathrm">l</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">n</span><span class="mord mathrm mtight">l</span></span></span></span></span><span class=vlist-s >â€‹</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8141079999999999em;vertical-align:0em;"></span><span class=mord >1</span><span class=mord ><span class=mord >0</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">8</span></span></span></span></span></span></span></span></span></span></span></span> using the L2-norm on the equation&#39;s residual <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>H</mi></msub></mrow><annotation encoding="application/x-tex">R_H</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.08125em;">H</span></span></span></span><span class=vlist-s >â€‹</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> &#40;<code>norm&#40;R_H&#41;/sqrt&#40;length&#40;R_H&#41;&#41;</code>&#41;.</p> <p>As initial condition, define a Gaussian distribution of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span> centred in the domain&#39;s centre with amplitude of 2 and standard deviation of 1. Enforce Dirichlet boundary condition <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">H=0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span></span></span></span> an all 6 faces.</p> <div class=note ><div class=title >ðŸ’¡ Note</div> <div class=messg >Use <a href="">ParallelStencil.jl</a> and <a href="">ImplicitGlobalGrid.jl</a> for the &#40;multi-&#41;XPU implementation. You are free to use either <code>@parallel</code> or <code>@parallel_indices</code> type of kernel definition.</div></div> <p>Implement the 3D diffusion equation &#40;1&#41; using a <a href="/course-101-0250-00/lecture4/#implicit_solutions">dual-time stepping</a> approach, including the physical time-derivative as physical term in the residual definition and using pseudo-time to iterate the solution as suggested <a href="/course-101-0250-00/lecture4/#implicit_solutions">here &#40;Eqs 11 &amp; 12&#41;</a>.</p> <p>For the multi-XPU implementation, you can build on the <a href="/course-101-0250-00/lecture8/#using_implicitglobalgridjl">2D multi-XPU diffusion</a> provided in Lecture 8, extending it to 3D.</p> <div class=note ><div class=title >ðŸ’¡ Note</div> <div class=messg >GitHub Actions only provides CPU-based runners. For unit and reference testing purpose, select small problem sizes &#40;e.g. <code>nx &#61; ny &#61; nz &#61; 32</code>&#41;, run on a single process &#40;launching the code without <code>mpirun</code> or <code>mpiexecjl</code>&#41; and use ParallelStencil&#39;s CPU backend &#40;setting <code>USE_GPU &#61; false</code>&#41;.</div></div> <h3 id=part_2_your_personal_project ><a href="#part_2_your_personal_project" class=header-anchor >Part 2: &#91;your personal project&#93;</a></h3> <p>Selecting a project of your choice among 3 possible directions:</p> <ol> <li><p>Solving PDEs you have some interest in &#40;e.g. related to another project or future study/research direction of yours&#41;</p> <li><p>Applying <a href="/course-101-0250-00/lecture9/">advanced optimisations</a> and benchmarking to existing PDEs; the ones seen in class or, e.g., to examples from <a href="https://github.com/omlins/ParallelStencil.jl#concise-singlemulti-xpu-miniapps">ParallelStencil&#39;s miniapps</a>.</p> <li><p>Solving one of the proposed PDE&#39;s</p> <ul> <li><p><a href="https://en.wikipedia.org/wiki/Shallow_water_equations">2D Shallow water equations</a></p> <li><p><a href="https://doi.org/10.1093/gji/ggy434">3D Thermo-mechanically coupled viscous flow</a></p> <li><p><a href="https://en.wikipedia.org/wiki/Linear_elasticity#Elastodynamics_in_terms_of_displacements">3D elastic wave propagation</a></p> <li><p>3D viscous Stokes flow</p> <li><p>viscous or elastic poromechanics</p> <li><p>more ...</p> </ul> </ol> <h2 id=getting_started_with_the_final_projects ><a href="#getting_started_with_the_final_projects" class=header-anchor >Getting started with the final projects</a></h2> <p>The following steps will get you started with the final projects:</p> <ol> <li><p>Find a classmate to work with &#40;being your own mate is fine too&#41;</p> <li><p>Select a topic of your choice for <strong><em>part 2</em></strong> &#40;see <a href="">here</a>&#41;</p> <li><p>Copy or clone the <a href="https://github.com/eth-vaw-glaciology/FinalProjectRepo.jl"><strong>template</strong></a> for the final project.</p> <li><p>Invite the teaching staff to the repo</p> <li><p>Send and email to Ludovic &#40;luraess@ethz.ch&#41; and Mauro &#40;werder@vaw.baug.ethz.ch&#41; by <strong>Tuesday November 30, 2021</strong>, including</p> <ul> <li><p>your project mate</p> <li><p>a brief description of your choice for <strong><em>part 2</em></strong></p> <li><p>a link to your final project GitHub repository</p> <li><p><em>anything else missing in this list</em></p> </ul> <li><p>Work on you final project, asking for help</p> <ul> <li><p>in the Element <em>Helpdesk</em> channel for general question</p> <li><p>as <strong>GitHub &quot;issue&quot;</strong> for project specific questions</p> </ul> </ol> <h2 id=project_submission ><a href="#project_submission" class=header-anchor >Project submission</a></h2> <p>Submission deadline for the project is XXX. Final submission timestamp is enforced upon tagging the v1.0.0 version release of your repository. See <a href="https://docs.github.com/en/repositories/releasing-projects-on-github/about-releases">GitHub docs</a> for infos.</p> <h2 id=project_grading ><a href="#project_grading" class=header-anchor >Project grading</a></h2> <p>Grading of the project will be 50&#37; for <strong><em>part 1</em></strong> and 50&#37; for <strong><em>part 2</em></strong>.</p> <p>For a successful outcome, both parts are expected to be handed-in as single GitHub repository featuring the following items:</p> <ul> <li><p>documented and polished scripts &#40;using e.g. docstrings, in-line comments&#41;</p> <li><p>documentation including:</p> <ul> <li><p>a succinct <code>README.md</code> directing to both project parts enhanced documentation </p> <li><p>an enhanced <code>README.md</code> for each parts following to proposed structure with equations, cross-references, figures, figure captions</p> <li><p>instructions to run the software and reproduce the results</p> <li><p>references</p> </ul> <li><p>unit and reference testing</p> <li><p>Continuous Integration &#40;CI - using e.g. GitHub Actions&#41;</p> <li><p>additional features if needed</p> </ul> <hr /> <p><em>Note that in case of un-expected results, the grading will reward the development, implementation and extensive documentation, even if, e.g, stiff PDEs would not deliver expected results.</em></p> <div class=page-foot > <div class=copyright > <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/"><b>Edit this page on <img class=github-logo  src="https://unpkg.com/ionicons@5.1.2/dist/svg/logo-github.svg"></b></a><br> Last modified: November 22, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </div> </div>