<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/course-101-0250-00/libs/katex/katex.min.css"> <link rel=stylesheet  href="/course-101-0250-00/libs/highlight/github.min.css"> <link rel=stylesheet  href="/course-101-0250-00/css/franklin.css"> <link rel=stylesheet  href="/course-101-0250-00/css/poole_hyde.css"> <link rel=stylesheet  href="/course-101-0250-00/css/custom.css"> <style> html {font-size: 17px;} .franklin-content {position: relative; padding-left: 8%; padding-right: 5%; line-height: 1.35em;} @media (min-width: 940px) { .franklin-content {width: 100%; margin-left: auto; margin-right: auto;} } @media (max-width: 768px) { .franklin-content {padding-left: 6%; padding-right: 6%;} } </style> <link rel=icon  href="/course-101-0250-00/assets/favicon.png"> <title>Lecture 2</title> <style> .content {max-width: 50rem} </style> <div class=sidebar > <div class="container sidebar-sticky"> <div class=sidebar-about > <img src="/course-101-0250-00/assets/vaw_logo.png" style="width: 180px; height: auto; display: inline"> <div style="font-weight: margin-bottom: 0.5em"><a href="/course-101-0250-00/"> Fall 2021</a> <span style="opacity: 0.7;">| <a href="http://www.vvz.ethz.ch/Vorlesungsverzeichnis/lerneinheit.view?semkez=2021W&ansicht=KATALOGDATEN&lerneinheitId=155538&lang=en"> ETHZ 101-0250-00</a></span></div> <br> <h1><a href="/course-101-0250-00/">Solving partial differential equations in parallel on GPUs</a></h1> <div style="line-height:18px; font-size: 15px; opacity: 0.85">by <a href="https://vaw.ethz.ch/en/people/person-detail.MjcwOTYw.TGlzdC8xOTYxLDE1MTczNjI1ODA=.html">Ludovic Räss</a>, <a href="https://vaw.ethz.ch/en/personen/person-detail.html?persid=124402">Mauro Werder</a> & <a href="https://www.cscs.ch/about/staff/">Samuel Omlin</a> </div> </div> <br> <style> </style> <nav class=sidebar-nav  style="opacity: 0.9"> <a class="sidebar-nav-item " href="/course-101-0250-00/"><b>Welcome</b></a> <a class="sidebar-nav-item " href="/course-101-0250-00/logistics/">Logistics</a> <a class="sidebar-nav-item " href="/course-101-0250-00/homework/">Homework</a> <a class="sidebar-nav-item " href="/course-101-0250-00/software_install/">Software install</a> <a class="sidebar-nav-item " href="/course-101-0250-00/extras/">Extras</a> <br> <div class=course-section >Part 1 - Introduction</div> <a class="sidebar-nav-item " href="/course-101-0250-00/lecture1/">Lecture 1</a> <a class="sidebar-nav-item active" href="/course-101-0250-00/lecture2/">Lecture 2</a> <a class="sidebar-nav-item " href="/course-101-0250-00/lecture3/">Lecture 3</a> <div class=course-section >Part 2 - Solving PDEs on GPUs</div> <div class=course-section >Part 3 - Projects</div> </nav> </div> </div> <div class="content container"> <div class=franklin-content > <h1 id=lecture_2 ><a href="#lecture_2" class=header-anchor >Lecture 2</a></h1> <blockquote> <p><strong>Agenda</strong><br />📚 ODEs &amp; PDEs - reaction, diffusion, advection<br />💻 Get started on GitHub<br />🚧 Exercises:</p> <ul> <li><p>basic code structure &amp; vectorisation</p> <li><p>combine physical processes</p> <li><p>first steps on Git</p> </ul> </blockquote> <p><hr /> </p> <p><a id=content  class=anchor ></a> <strong>Content</strong></p> <div class=franklin-toc ><ol><li><a href="#lecture_2">Lecture 2</a><li><a href="#odes_pdes_reaction_-_diffusion_-_advection">ODEs &amp; PDEs: reaction - diffusion - advection</a><ol><li><a href="#odes_-_reaction">ODEs - reaction</a><li><a href="#pdes_-_diffusion">PDEs - diffusion</a><li><a href="#pdes_-_advection">PDEs - advection</a><li><a href="#wrapping-up">Wrapping-up</a></ol><li><a href="#getting_started_on_github">Getting started on GitHub</a><li><a href="#exercises_-_lecture_2">Exercises - lecture 2</a><ol><li><a href="#exercise_1_-_many_volcanic_bomb">Exercise 1 - <strong>Many volcanic bomb</strong></a></ol></ol></div> <p><a href="#exercises_-_lecture_2"><em>👉 get started with exercises</em></a></p> <hr /> <h1 id=odes_pdes_reaction_-_diffusion_-_advection ><a href="#odes_pdes_reaction_-_diffusion_-_advection" class=header-anchor >ODEs &amp; PDEs: reaction - diffusion - advection</a></h1> <p>Reaction - Diffusion - Advection gifs</p> <h3 id=the_goal_of_this_lecture_2_is_to_familiarise_or_refresh_with ><a href="#the_goal_of_this_lecture_2_is_to_familiarise_or_refresh_with" class=header-anchor >The goal of this lecture 2 is to familiarise &#40;or refresh&#41; with</a></h3> <ul> <li><p>Ordinary differential equations - ODEs &#40;e.g. reaction equation&#41;</p> <li><p>Partial differential equations - PDEs &#40;e.g. diffusion and advection equations&#41;</p> <li><p>Finite-difference discretisation</p> <li><p>Explicit solutions</p> <li><p>Multi-process &#40;physics&#41; coupling</p> </ul> <blockquote> <p>A <strong>partial differential equation &#40;PDE&#41;</strong> is an equation which imposes relations between the various partial derivatives of a multivariable function.<br /><strong>Ordinary differential equations &#40;ODE&#41;</strong> form a subclass of partial differential equations, corresponding to functions of a single variable. <a href="https://en.wikipedia.org/wiki/Partial_differential_equation"><em>Wikipedia</em></a></p> </blockquote> <h2 id=odes_-_reaction ><a href="#odes_-_reaction" class=header-anchor >ODEs - reaction</a></h2> <p>Simple reaction equation, finite-difference method and explicit solution</p> <p>Let&#39;s take-off 🚀</p> <p>Our first task is to design a numerical solution approach for the following reaction process &#40;e.g. <a href="https://en.wikipedia.org/wiki/Chemical_kinetics">reaction kinetics</a>&#41;</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>C</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mo>−</mo><mfrac><mrow><mi>C</mi><mo>−</mo><msub><mi>C</mi><mrow><mi>e</mi><mi>q</mi></mrow></msub></mrow><mi>ξ</mi></mfrac><mtext> </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex"> \frac{∂C}{∂t} = -\frac{C-C_{eq}}{ξ}~, </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.2407700000000004em;vertical-align:-0.8804400000000001em;"></span><span class=mord >−</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.36033em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.04601em;">ξ</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace nobreak"> </span><span class=mpunct >,</span></span></span></span></span> <p>where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span> is the concentration of ,e.g. a specific chemical quantity, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span></span></span></span> is time, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mrow><mi>e</mi><mi>q</mi></mrow></msub></mrow><annotation encoding="application/x-tex">C_{eq}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.969438em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> is the equilibrium concentration of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ξ</mi></mrow><annotation encoding="application/x-tex">ξ</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.04601em;">ξ</span></span></span></span> is the reaction rate.</p> <p>Suppose the reaction kinetics process occurs in a spatial domain &#40;x-direction&#41; of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>x</mi><mo>=</mo><mn>10.0</mn></mrow><annotation encoding="application/x-tex">Lx=10.0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal">x</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >1</span><span class=mord >0</span><span class=mord >.</span><span class=mord >0</span></span></span></span>, consider a reaction rate <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ξ</mi><mo>=</mo><mn>10.0</mn></mrow><annotation encoding="application/x-tex">ξ=10.0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.04601em;">ξ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >1</span><span class=mord >0</span><span class=mord >.</span><span class=mord >0</span></span></span></span> and an equilibrium concentration <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mrow><mi>e</mi><mi>q</mi></mrow></msub><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">C_{eq}=0.5</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.969438em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span><span class=mord >.</span><span class=mord >5</span></span></span></span>.</p> <p>The goal is now to predict the evolution of a system with initial random distribution of concentration <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span> in the range <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >[</mo><mn>0</mn><mo separator=true >,</mo><mn>1</mn><mo stretchy=false >]</mo></mrow><annotation encoding="application/x-tex">[0, 1]</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >[</span><span class=mord >0</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >1</span><span class=mclose >]</span></span></span></span> for non-dimensional total time of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>20.0</mn></mrow><annotation encoding="application/x-tex">20.0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >2</span><span class=mord >0</span><span class=mord >.</span><span class=mord >0</span></span></span></span>.</p> <pre><code class="julia hljs"><span class=hljs-comment ># Physics</span>
Lx   = <span class=hljs-number >10.0</span>
ξ    = <span class=hljs-number >10.0</span>
Ceq  = <span class=hljs-number >0.5</span>
ttot = <span class=hljs-number >20.0</span></code></pre> <p>As next step, one needs to discretise the continuum problem in both space and time. We will use a <a href="https://en.wikipedia.org/wiki/Finite_difference">finite-difference</a> spatial discretisation and an explicit &#40;<a href="https://en.wikipedia.org/wiki/Euler_method">forward Euler</a>&#41; time integration scheme.</p> <p>In a new <code># Numerics</code> section we define the number of grid points we will use to discretise our physical domain <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">Lx</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal">x</span></span></span></span>.</p> <p>Then, in a <code># Derived numerics</code> section, we compute the grid size <code>dx</code>, the time-step <code>dt</code>, the number of time-steps <code>nt</code> and the vector containing the coordinate of all cell centres <code>xc</code>.</p> <pre><code class="julia hljs"><span class=hljs-comment ># Numerics</span>
nx   = <span class=hljs-number >128</span>
<span class=hljs-comment ># Derived numerics</span>
dx   = Lx/nx
dt   = ξ/<span class=hljs-number >2.0</span>
nt   = cld(ttot, dt)
xc   = <span class=hljs-built_in >LinRange</span>(dx/<span class=hljs-number >2</span>, Lx-dx/<span class=hljs-number >2</span>, nx)</code></pre> <div class=note ><div class=title >💡 Note</div> <div class=messg >Type <code>?</code> in the Julia REPL followed by the function you want to know more about to display infos</div></div> <p>We now need to initialise 3 1D arrays to hold information about concentration <code>C</code>, initial concentration distribution <code>Ci</code>, and rate of change of concentration <code>dCdt</code>.</p> <pre><code class="julia hljs"><span class=hljs-comment ># Array initialisation</span>
C    =  rand(<span class=hljs-built_in >Float64</span>, nx)
Ci   =  copy(C)
dCdt = zeros(<span class=hljs-built_in >Float64</span>, nx)</code></pre> <div class=note ><div class=title >💡 Note</div> <div class=messg >We here work with double precision arithmetic <code>Float64</code></div></div> <p>Remains the most important part, the <code># Time loop</code> where <em>predictive</em> action should take place. We will loop from <code>it&#61;1</code> to <code>nt</code> computing the rate of change of <code>C</code>, <code>dCdt</code>, and then updating <code>C</code>. We also want to visualise the evolution of the concentration distribution.</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> Plots

<span class=hljs-comment ># Time loop</span>
<span class=hljs-keyword >for</span> it = <span class=hljs-number >1</span>:nt
  dCdt = ...
  C    = ...
  display(plot(xc, C, lw=<span class=hljs-number >2</span>, xlims=(xc[<span class=hljs-number >1</span>], xc[<span class=hljs-keyword >end</span>]), ylims=(<span class=hljs-number >0.0</span>, <span class=hljs-number >1.0</span>),
               xlabel=<span class=hljs-string >&quot;Lx&quot;</span>, ylabel=<span class=hljs-string >&quot;Concentration&quot;</span>, title=<span class=hljs-string >&quot;time = <span class=hljs-subst >$(it*dt)</span>&quot;</span>,
               framestyle=:box, label=<span class=hljs-string >&quot;Concentration&quot;</span>))
<span class=hljs-keyword >end</span></code></pre> <ul> <li><p>Make sure to update the arrays <code>dCdt</code> and <code>C</code> using the <a href="https://docs.julialang.org/en/v1/manual/functions/#man-vectorized">dot syntax</a> for vectorised functions.</p> <li><p>The <code>display&#40;&#41;</code> function will force to update the figure within the loop. Note that in Jupyter notebooks, you can use following syntax to avoid the creation of a new figure at each step.</p> </ul> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> IJulia
IJulia.clear_output(<span class=hljs-literal >true</span>)
display(plot(...))</code></pre> <p>👉 Your turn. Let&#39;s implement the reaction physics.</p> <p>After the time loop, we can also display the initial concentration we stored <code>Ci</code> and the equilibrium concentration <code>Ceq</code>:</p> <pre><code class="julia hljs">plot!(xc, Ci, lw=<span class=hljs-number >2</span>, label=<span class=hljs-string >&quot;C initial&quot;</span>)
display(plot!(xc, Ceq*ones(nx), lw=<span class=hljs-number >2</span>, label=<span class=hljs-string >&quot;Ceq&quot;</span>))</code></pre> <p>Note that calling further instances of <code>plot&#33;&#40;&#41;</code> will act as &quot;hold-on&quot; and allow to display multiple objects on top of each other.</p> <p>We may want to write a single &quot;monolithic&quot; <code>reaction_1D.jl</code> code to perform these steps that looks as following</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> Plots

<span class=hljs-meta >@views</span> <span class=hljs-keyword >function</span> reaction_1D()
    <span class=hljs-comment ># Physics</span>
    Lx   = <span class=hljs-number >10.0</span>
    ξ    = <span class=hljs-number >10.0</span>
    Ceq  = <span class=hljs-number >0.5</span>
    ttot = <span class=hljs-number >20.0</span>
    <span class=hljs-comment ># Numerics</span>
    nx   = <span class=hljs-number >128</span>
    <span class=hljs-comment ># Derived numerics</span>
    dx   = Lx/nx
    dt   = ξ/<span class=hljs-number >2.0</span>
    nt   = cld(ttot, dt)
    xc   = <span class=hljs-built_in >LinRange</span>(dx/<span class=hljs-number >2</span>, Lx-dx/<span class=hljs-number >2</span>, nx)
    <span class=hljs-comment ># Array initialisation</span>
    C    =  rand(<span class=hljs-built_in >Float64</span>, nx)
    Ci   =  copy(C)
    dCdt = zeros(<span class=hljs-built_in >Float64</span>, nx)
    <span class=hljs-comment ># Time loop</span>
    <span class=hljs-keyword >for</span> it = <span class=hljs-number >1</span>:nt
        <span class=hljs-comment >#dCdt = ...</span>
        <span class=hljs-comment >#C    = ...</span>
        <span class=hljs-comment >#display(plot(xc, C, lw=2, xlims=(xc[1], xc[end]), ylims=(0.0, 1.0),</span>
                     <span class=hljs-comment >#xlabel=&quot;Lx&quot;, ylabel=&quot;Concentration&quot;, title=&quot;time = $(it*dt)&quot;,</span>
                     <span class=hljs-comment >#framestyle=:box, label=&quot;Concentration&quot;))</span>
    <span class=hljs-keyword >end</span>
    <span class=hljs-comment >#plot!(xc, Ci, lw=2, label=&quot;C initial&quot;)</span>
    <span class=hljs-comment >#display(plot!(xc, Ceq*ones(nx), lw=2, label=&quot;Ceq&quot;))</span>
    <span class=hljs-keyword >return</span>
<span class=hljs-keyword >end</span>

reaction_1D()</code></pre> <p>Let&#39;s execute it and visualise output</p> <p>So, excellent, we have our first 1D ODE solver up and running in Julia :-&#41;</p> <p>👉 <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/scripts/">Download the <code>reaction_1D.jl</code> script</a></p> <h2 id=pdes_-_diffusion ><a href="#pdes_-_diffusion" class=header-anchor >PDEs - diffusion</a></h2> <p>From reactions to diffusion and advection - involving gradients &#40;neighbouring cells&#41;.</p> <p>Starting from the reaction script that we just finalised, we will now do as few as possible changes to solve the diffusion equation.</p> <p>The <a href="https://en.wikipedia.org/wiki/Diffusion_equation">diffusion equation</a> was introduced by Fourier in 1822 to understand heat distribution &#40;<a href="https://en.wikipedia.org/wiki/Heat_equation">heat equation</a>&#41; in various materials.</p> <p>Diffusive processes were also employed by Fick in 1855 with application to chemical and particle diffusion &#40;<a href="https://en.wikipedia.org/wiki/Fick&#37;27s_laws_of_diffusion">Fick&#39;s law</a>&#41;.</p> <p>The diffusion equation is often reported as a second order parabolic PDE, here for a multivariable function <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo stretchy=false >(</mo><mi>x</mi><mo separator=true >,</mo><mi>t</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">C(x,t)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=mopen >(</span><span class="mord mathnormal">x</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">t</span><span class=mclose >)</span></span></span></span> showing derivatives in both temporal <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">∂t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span></span> and spatial <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >∂</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">∂x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">x</span></span></span></span> derivatives &#40;here for the 1D case&#41;</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>C</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mi>D</mi><mfrac><mrow><msup><mi mathvariant=normal >∂</mi><mn>2</mn></msup><mi>C</mi></mrow><mrow><mi mathvariant=normal >∂</mi><msup><mi>x</mi><mn>2</mn></msup></mrow></mfrac><mtext> </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex"> \frac{∂C}{∂t} = D\frac{∂^2 C}{∂ x^2}~, </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.177108em;vertical-align:-0.686em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.491108em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace nobreak"> </span><span class=mpunct >,</span></span></span></span></span> <p>where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span> is the diffusion coefficient.</p> <p>The second order formulation is only possible if the diffusion coefficient D is a single value valid in all the considered domain.</p> <p>A more general description allowing for non-uniform, non-linear diffusion coefficient combines a diffusive flux:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>q</mi><mo>=</mo><mo>−</mo><mi>D</mi><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>C</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>x</mi></mrow></mfrac><mtext> </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex"> q = -D\frac{∂C}{∂x}~,</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord >−</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace nobreak"> </span><span class=mpunct >,</span></span></span></span></span> <p>and a conservation or flux balance equations:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>C</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mo>−</mo><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>q</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>x</mi></mrow></mfrac><mtext> </mtext><mi mathvariant=normal >.</mi></mrow><annotation encoding="application/x-tex"> \frac{∂C}{∂t} = -\frac{∂q}{∂x}~. </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.0574399999999997em;vertical-align:-0.686em;"></span><span class=mord >−</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace nobreak"> </span><span class=mord >.</span></span></span></span></span> <p>To discretise the diffusion equation, we will keep the explicit forward Euler method as temporal discretisation and use <a href="https://en.wikipedia.org/wiki/Finite_difference">finite-differences</a> for the spatial discretisation.</p> <p>Finite-differences discretisation on regular staggered grid allows for concise and performance oriented algorithms, because only neighbouring cell access is needed to evaluate gradient and data alignment is natively pretty optimal.</p> <p>A long story short, we will approximate the gradient of concentration <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span> over a distance <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >∂</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">∂x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">x</span></span></span></span>, a first derivative <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>C</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>x</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{∂C}{∂x}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.2251079999999999em;vertical-align:-0.345em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8801079999999999em;"><span style="top:-2.6550000000000002em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight">x</span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>, we will perform following discrete operation</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><msub><mi>C</mi><mrow><mi>x</mi><mo>+</mo><mi>d</mi><mi>x</mi></mrow></msub><mo>−</mo><msub><mi>C</mi><mi>x</mi></msub></mrow><mrow><mi>d</mi><mi>x</mi></mrow></mfrac><mtext> </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex"> \frac{C_{x+dx} - C_{x}}{dx}~, </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.04633em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.36033em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">d</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.208331em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace nobreak"> </span><span class=mpunct >,</span></span></span></span></span> <p>where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">dx</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">x</span></span></span></span> is the discrete size of the cell.</p> <p>The same reasoning also applies to the flux balance equation.</p> <p>We can use Julia&#39;s <code>diff&#40;&#41;</code> operator to apply the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mrow><mi>x</mi><mo>+</mo><mi>d</mi><mi>x</mi></mrow></msub><mo>−</mo><msub><mi>C</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex"> C_{x+dx} - C_{x} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.891661em;vertical-align:-0.208331em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.208331em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>,</p> <pre><code class="julia hljs">C[ix+<span class=hljs-number >1</span>] - C[ix]</code></pre>
<p>in a vectorised fashion to our entire <code>C</code> vector as</p>
<pre><code class="julia hljs">diff(C)</code></pre>
<p>So, we are ready to solve the 1D diffusion equation.</p>
<p>Starting from the reaction code, turn <code>ξ</code> into <code>D&#61;1.0</code>, the diffusion coefficient, remove <code>C_eq</code>, set total simulation time <code>ttot &#61; 2.0</code></p>
<pre><code class="julia hljs"><span class=hljs-comment ># Physics</span>
Lx   = <span class=hljs-number >10.0</span>
D    = <span class=hljs-number >1.0</span>
ttot = <span class=hljs-number >2.0</span></code></pre>
<p>The only change in the <code># Derived numerics</code> section is the diffusive stable time step definition, to comply with the <a href="https://en.wikipedia.org/wiki/Courant–Friedrichs–Lewy_condition">CFL stability condition</a> for explicit time integration</p>
<pre><code class="julia hljs"><span class=hljs-comment ># Derived numerics</span>
dt   = dx^<span class=hljs-number >2</span>/D/<span class=hljs-number >2.1</span></code></pre>
<p>In the <code># Array initialisation</code> section, we need a new object to hold the diffusive flux in x direction <code>qx</code></p>
<pre><code class="julia hljs">dCdt = zeros(<span class=hljs-built_in >Float64</span>, nx) <span class=hljs-comment ># wrong size - will fail because of staggering</span>
qx   = zeros(<span class=hljs-built_in >Float64</span>, nx) <span class=hljs-comment ># wrong size - will fail because of staggering</span></code></pre>
<p>Wait... what about the staggering ?</p>
<p>No surprise <code>C .&#61; diff&#40;C&#41;</code> won&#39;t work ...</p>
<p>👉 Your turn. Let&#39;s implement our first diffusion solver trying to think about how to solve the staggering issue.</p>
<p>The initialisation steps of the diffusion code should contain</p>
<pre><code class="julia hljs"><span class=hljs-comment ># Physics</span>
Lx   = <span class=hljs-number >10.0</span>
D    = <span class=hljs-number >1.0</span>
ttot = <span class=hljs-number >2.0</span>
<span class=hljs-comment ># Numerics</span>
nx   = <span class=hljs-number >12</span>
nout = <span class=hljs-number >10</span>
<span class=hljs-comment ># Derived numerics</span>
dx   = Lx/nx
dt   = dx^<span class=hljs-number >2</span>/D/<span class=hljs-number >2.1</span>
nt   = cld(ttot, dt)
xc   = <span class=hljs-built_in >LinRange</span>(dx/<span class=hljs-number >2</span>, Lx-dx/<span class=hljs-number >2</span>, nx)
<span class=hljs-comment ># Array initialisation</span>
C    =  rand(<span class=hljs-built_in >Float64</span>, nx)
Ci   =  copy(C)
dCdt = zeros(<span class=hljs-built_in >Float64</span>, nx-<span class=hljs-number >2</span>)
qx   = zeros(<span class=hljs-built_in >Float64</span>, nx-<span class=hljs-number >1</span>);</code></pre>
<p>Followed by the 3 physics computations &#40;lines&#41; in the time loop</p>
<pre><code class="julia hljs"><span class=hljs-comment ># Time loop</span>
<span class=hljs-keyword >for</span> it = <span class=hljs-number >1</span>:nt
    qx         .= .-D.*diff(C )./dx
    dCdt       .= .-   diff(qx)./dx
    C[<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>] .= C[<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>] .+ dt.*dCdt
    <span class=hljs-comment ># Visualisation</span>
<span class=hljs-keyword >end</span></code></pre>
<p>One can examine the size of the various vectors ...</p>
<pre><code class="julia hljs"><span class=hljs-comment ># check sizes and staggering</span>
<span class=hljs-meta >@show</span> size(qx)
<span class=hljs-meta >@show</span> size(dCdt)
<span class=hljs-meta >@show</span> size(C)
<span class=hljs-meta >@show</span> size(C[<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>]);</code></pre>
<p>... and visualise it</p>
<pre><code class="julia hljs"><span class=hljs-keyword >using</span> Plots
 plot(xc               , C   , label=<span class=hljs-string >&quot;Concentration&quot;</span>, linewidth=:<span class=hljs-number >1.0</span>, markershape=:circle, markersize=<span class=hljs-number >5</span>, framestyle=:box)
plot!(xc[<span class=hljs-number >1</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>].+dx/<span class=hljs-number >2</span>, qx  , label=<span class=hljs-string >&quot;flux of concentration&quot;</span>, linewidth=:<span class=hljs-number >1.0</span>, markershape=:circle, markersize=<span class=hljs-number >5</span>, framestyle=:box)
plot!(xc[<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>]      , dCdt, label=<span class=hljs-string >&quot;rate of change&quot;</span>, linewidth=:<span class=hljs-number >1.0</span>, markershape=:circle, markersize=<span class=hljs-number >5</span>, framestyle=:box)</code></pre>
<p>Note: plotting and visualisation is slow. A convenient workaround is to only visualise or render the figure every <code>nout</code> iteration within the time loop</p>
<pre><code class="julia hljs"><span class=hljs-keyword >if</span> it % nout == <span class=hljs-number >0</span>
    plot()
<span class=hljs-keyword >end</span></code></pre>
<p>👉 <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/scripts/">Download the <code>diffusion_1D.jl</code> script</a></p>
<h2 id=pdes_-_advection ><a href="#pdes_-_advection" class=header-anchor >PDEs - advection</a></h2>
<blockquote>
<p>Advection is a partial differential equation that governs the motion of a conserved scalar field as it is advected by a known velocity vector field. <a href="https://en.wikipedia.org/wiki/Advection"><em>Wikipedia</em></a></p>
</blockquote>
<p>We will here briefly discuss advection of a quantity <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span> by a constant velocity <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">v_x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> in the one-dimensional x-direction.</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>C</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mo>−</mo><mfrac><mrow><msub><mi>v</mi><mi>x</mi></msub><mtext> </mtext><mi mathvariant=normal >∂</mi><mi>C</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>x</mi></mrow></mfrac><mtext> </mtext><mi mathvariant=normal >.</mi></mrow><annotation encoding="application/x-tex"> \frac{∂C}{∂t} = -\frac{v_x ~ ∂C}{∂x} ~.</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord >−</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace nobreak"> </span><span class=mord >.</span></span></span></span></span>
<p>In case the flow is incompressible &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >∇</mi><mo>⋅</mo><mi>v</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">∇⋅v = 0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class=mord >∇</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⋅</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span></span></span></span> – here <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi mathvariant=normal >∂</mi><msub><mi>v</mi><mi>x</mi></msub></mrow><mrow><mi mathvariant=normal >∂</mi><mi>x</mi></mrow></mfrac><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\frac{∂v_x}{∂x}=0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.2412079999999999em;vertical-align:-0.345em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8962079999999999em;"><span style="top:-2.6550000000000002em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight">x</span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span></span></span></span>&#41;, the advection equation can be rewritten as</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>C</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mo>−</mo><msub><mi>v</mi><mi>x</mi></msub><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>C</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>x</mi></mrow></mfrac><mtext> </mtext><mi mathvariant=normal >.</mi></mrow><annotation encoding="application/x-tex"> \frac{∂C}{∂t} = -v_x \frac{∂C}{∂x} ~.</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord >−</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace nobreak"> </span><span class=mord >.</span></span></span></span></span>
<p>Let&#39;s once more start from the simple 1D reaction code, modifying it to implement the advection equation.</p>
<p>Starting from the reaction code, turn <code>ξ</code> into <code>vx&#61;1.0</code>, the advection velocity, remove <code>C_eq</code>, set total simulation time <code>ttot &#61; 5.0</code></p>
<pre><code class="julia hljs"><span class=hljs-comment ># Physics</span>
Lx   = <span class=hljs-number >10.0</span>
vx   = <span class=hljs-number >1.0</span>
ttot = <span class=hljs-number >5.0</span></code></pre>
<p>The only change in the <code># Derived numerics</code> section is the stable advection time step definition, to comply with the <a href="https://en.wikipedia.org/wiki/Courant–Friedrichs–Lewy_condition">CFL stability condition</a> for explicit time integration.</p>
<pre><code class="julia hljs"><span class=hljs-comment ># Derived numerics</span>
dt   = dx/vx</code></pre>
<p>In the <code># Array initialisation</code> section, initialise the quantity <code>C</code> as a Gaussian profile of amplitude 1, standard deviation 1, with centre located at <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>=</mo><mn>0.3</mn><mi>L</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">c = 0.3 Lx</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">c</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class=mord >0</span><span class=mord >.</span><span class=mord >3</span><span class="mord mathnormal">L</span><span class="mord mathnormal">x</span></span></span></span>.</p>
<pre><code class="julia hljs">C = exp.( ... )</code></pre>
<div class=note ><div class=title >💡 Note</div>
<div class=messg >Gaussian distribution as function of coordinate <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">x_c</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo>=</mo><mi>exp</mi><mo>⁡</mo><mo stretchy=false >(</mo><mi>x</mi><mi>c</mi><mo>−</mo><mi>c</mi><msup><mo stretchy=false >)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex"> C = \exp(xc - c)^2 </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mop >exp</span><span class=mopen >(</span><span class="mord mathnormal">x</span><span class="mord mathnormal">c</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathnormal">c</span><span class=mclose ><span class=mclose >)</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></div></div>
<p>One should also pay attention regarding the correct initialisation of <code>dCdt</code> in terms of vector dimension, since the rate of change of <code>C</code>, <code>dCdt</code>, is the derivative of <code>C</code>.</p>
<p>Defining <code>dCdt</code> as following</p>
<pre><code class="julia hljs">dCdt     .= .-vx.*diff(C)./dx</code></pre>
<p>implements the right and side of the 1D advection equation.</p>
<p>Now, the question is how to add <code>dCdt</code> to <code>C</code> within the update rule ?</p>
<p>3 &#40;main&#41; possibilities exist.</p>
<p>👉 Your turn. Try it out yourself and motivate your best choice.</p>
<p>Here we go, an upwind approach is needed to implement a stable advection algorithm</p>
<pre><code class="julia hljs">C[<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>]   .= C[<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>]   .+ dt.*dCdt <span class=hljs-comment ># if vx&gt;0</span>
C[<span class=hljs-number >1</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>] .= C[<span class=hljs-number >1</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>] .+ dt.*dCdt <span class=hljs-comment ># if vx&lt;0</span></code></pre>
<p>👉 <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/scripts/">Download the <code>advection_1D.jl</code> script</a></p>
<h2 id=wrapping-up ><a href="#wrapping-up" class=header-anchor >Wrapping-up</a></h2>
<ul>
<li><p>We implemented and solved PDEs for reaction, diffusion and advection processes in 1D</p>

<li><p>We used conservative staggered grid finite-differences, explicit forward Euler time stepping and upwind scheme &#40;advection&#41;.</p>

</ul>
<p>Note that this is far from being the only way to tackle numerical solutions to these PDEs. In this course, we will stick to those concepts as they will allow for efficient GPU &#40;parallel&#41; implementations.</p>

<p><a href="#content">⤴ <em><strong>back to Content</strong></em></a></p>
<h1 id=getting_started_on_github ><a href="#getting_started_on_github" class=header-anchor >Getting started on GitHub</a></h1>

<p><a href="#content">⤴ <em><strong>back to Content</strong></em></a></p>
<h1 id=exercises_-_lecture_2 ><a href="#exercises_-_lecture_2" class=header-anchor >Exercises - lecture 2</a></h1>
<h2 id=exercise_1_-_many_volcanic_bomb ><a href="#exercise_1_-_many_volcanic_bomb" class=header-anchor >Exercise 1 - <strong>Many volcanic bomb</strong></a></h2>
<p>👉 <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/exercise-notebooks/notebooks/lecture2_ex1.ipynb">Download the notebook to get started with this exercise&#33;</a></p>
<p>The goal of this exercise is to consolidate:</p>
<ul>
<li><p>vectorisation and element-wise operations using <code>.</code></p>

<li><p>random numbers</p>

<li><p>array initialisation</p>

<li><p>conditional statement</p>

</ul>
<p>The goal is to extend the volcanic bomb calculator &#40;exercise 4, lecture 1&#41; to handle <code>nb</code> bombs.</p>
<p>To do so, start from the script you wrote to predict the trajectory of a single volcanic bomb and extend it to handle <code>nb</code> bombs.</p>
<p>Declare a new variable for the number of volcanic bombs</p>
<pre><code class="julia hljs">nb = <span class=hljs-number >5</span> <span class=hljs-comment ># number of volcanic bombs</span></code></pre>
<p>Then, replace the vertical angle of ejection α to randomly vary between 60° and 120° with respect to the horizon for each bomb. Keep the magnitude of the ejection velocity as before, i.e. <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mo>=</mo><mn>120</mn></mrow><annotation encoding="application/x-tex">V=120</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >1</span><span class=mord >2</span><span class=mord >0</span></span></span></span> m/s.</p>
<div class=note ><div class=title >💡 Note</div>
<div class=messg ><ul>
<li><p>use the <code>randn&#40;&#41;</code> function to generate random numbers in the range &#91;-1, 1&#93;</p>

</ul></div></div>
<p>All bombs have the same initial location <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><mi>x</mi><mo>=</mo><mn>0</mn><mo separator=true >,</mo><mi>y</mi><mo>=</mo><mn>480</mn><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">(x=0, y=480)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathnormal">x</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class=mord >0</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >4</span><span class=mord >8</span><span class=mord >0</span><span class=mclose >)</span></span></span></span> as before.</p>
<p>Implement the necessary modifications in the time loop in order to update the position of all volcanic bombs correctly.</p>
<p>Ensure the bombs stop their motion once they hit the ground &#40;at position <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">y=0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span></span></span></span>&#41;.</p>
<h3 id=question_1 ><a href="#question_1" class=header-anchor >Question 1</a></h3>
<p>Report the total time it takes for the last, out of 5, volcanic bombs to hit the ground and provide a figure that visualise the bombs&#39; overall trajectories.</p>
<h3 id=question_2 ><a href="#question_2" class=header-anchor >Question 2</a></h3>
<p>Repeat the exercise 1 but vectorise all your code, i.e. make use of broadcasting capabilities in Julia &#40;using <code>.</code> operator&#41; to only have a single loop for advancing in time.</p>

<p><a href="#content">⤴ <em><strong>back to Content</strong></em></a></p>
<hr />
<div class=page-foot >
  <div class=copyright >
    <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/"><b>Edit this page on <img class=github-logo  src="https://unpkg.com/ionicons@5.1.2/dist/svg/logo-github.svg"></b></a><br>
    Last modified: September 27, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div>
    </div>