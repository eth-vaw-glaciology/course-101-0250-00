<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/course-101-0250-00/libs/katex/katex.min.css"> <link rel=stylesheet  href="/course-101-0250-00/libs/highlight/github.min.css"> <link rel=stylesheet  href="/course-101-0250-00/css/franklin.css"> <link rel=stylesheet  href="/course-101-0250-00/css/poole_hyde.css"> <link rel=stylesheet  href="/course-101-0250-00/css/custom.css"> <style> html {font-size: 17px;} .franklin-content {position: relative; padding-left: 8%; padding-right: 5%; line-height: 1.35em;} @media (min-width: 940px) { .franklin-content {width: 100%; margin-left: auto; margin-right: auto;} } @media (max-width: 768px) { .franklin-content {padding-left: 6%; padding-right: 6%;} } </style> <link rel=icon  href="/course-101-0250-00/assets/favicon.png"> <title>Lecture 4</title> <style> .content {max-width: 50rem} </style> <div class=sidebar > <div class="container sidebar-sticky"> <div class=sidebar-about > <img src="/course-101-0250-00/assets/vaw_logo.png" style="width: 180px; height: auto; display: inline"> <div style="font-weight: margin-bottom: 0.5em"><a href="/course-101-0250-00/"> Fall 2021</a> <span style="opacity: 0.7;">| <a href="http://www.vvz.ethz.ch/Vorlesungsverzeichnis/lerneinheit.view?semkez=2021W&ansicht=KATALOGDATEN&lerneinheitId=155538&lang=en"> ETHZ 101-0250-00</a></span></div> <br> <h1><a href="/course-101-0250-00/">Solving partial differential equations in parallel on GPUs</a></h1> <div style="line-height:18px; font-size: 15px; opacity: 0.85">by <a href="https://vaw.ethz.ch/en/people/person-detail.MjcwOTYw.TGlzdC8xOTYxLDE1MTczNjI1ODA=.html">Ludovic RÃ¤ss</a>, <a href="https://vaw.ethz.ch/en/personen/person-detail.html?persid=124402">Mauro Werder</a> & <a href="https://www.cscs.ch/about/staff/">Samuel Omlin</a> </div> </div> <br> <style> </style> <nav class=sidebar-nav  style="opacity: 0.9"> <a class="sidebar-nav-item " href="/course-101-0250-00/"><b>Welcome</b></a> <a class="sidebar-nav-item " href="/course-101-0250-00/logistics/">Logistics</a> <a class="sidebar-nav-item " href="/course-101-0250-00/homework/">Homework</a> <a class="sidebar-nav-item " href="/course-101-0250-00/software_install/">Software install</a> <a class="sidebar-nav-item " href="/course-101-0250-00/extras/">Extras</a> <br> <div class=course-section >Part 1 - Introduction</div> <a class="sidebar-nav-item " href="/course-101-0250-00/lecture1/">Lecture 1</a> <a class="sidebar-nav-item " href="/course-101-0250-00/lecture2/">Lecture 2</a> <a class="sidebar-nav-item " href="/course-101-0250-00/lecture3/">Lecture 3</a> <a class="sidebar-nav-item active" href="/course-101-0250-00/lecture4/">Lecture 4</a> <div class=course-section >Part 2 - Solving PDEs on GPUs</div> <div class=course-section >Part 3 - Projects</div> </nav> </div> </div> <div class="content container"> <div class=franklin-content > <h1 id=lecture_4 ><a href="#lecture_4" class=header-anchor >Lecture 4</a></h1> <blockquote> <p><strong>Agenda</strong><br />ðŸ“š Implicit and nonlinear solutions<br />ðŸ’» Julia&#39;s <code>Project</code> environment<br />ðŸš§ Exercises:</p> <ul> <li><p>nonlinear diffusion 2D</p> <li><p>Laplacian vs damped Laplacian</p> <li><p>steady-state implicit nonlinear diffusion 1D &amp; 2D</p> </ul> </blockquote> <p><hr /> </p> <p><a id=content  class=anchor ></a> <strong>Content</strong></p> <div class=franklin-toc ><ol><li><a href="#lecture_4">Lecture 4</a><li><a href="#nonlinear_and_implicit_solutions">Nonlinear and implicit solutions</a><ol><li><a href="#nonlinear_solutions">Nonlinear solutions</a><li><a href="#steady-state_and_implicit_iterative_solutions">Steady-state and implicit iterative solutions</a><li><a href="#steady-state">Steady-state</a><li><a href="#implicit_solutions">Implicit solutions</a></ol><li><a href="#exercises_-_lecture_4">Exercises - lecture 4</a></ol></div> <p><a href="#exercises_-_lecture_4"><em>ðŸ‘‰ get started with exercises</em></a></p> <hr /> <h1 id=nonlinear_and_implicit_solutions ><a href="#nonlinear_and_implicit_solutions" class=header-anchor >Nonlinear and implicit solutions</a></h1> <h3 id=the_goal_of_this_lecture_4_is_to_explore ><a href="#the_goal_of_this_lecture_4_is_to_explore" class=header-anchor >The goal of this lecture 4 is to explore:</a></h3> <ul> <li><p>Nonlinear solutions</p> <li><p>Steady-state and implicit iterative solutions</p> </ul> <h3 id=building_upon ><a href="#building_upon" class=header-anchor >Building upon:</a></h3> <ul> <li><p>The diffusion equation</p> <li><p>Spatial discretisation: 1D and 2D</p> <li><p>Finite-differences and staggered grids</p> </ul> <h2 id=nonlinear_solutions ><a href="#nonlinear_solutions" class=header-anchor >Nonlinear solutions</a></h2> <p>Until now we investigated linear and transient processes using a forward Euler explicit time integration.</p> <p>However many interesting application may exhibit nonlinear behaviours, e.g.,</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><mi mathvariant=normal >âˆ‚</mi><mi>H</mi></mrow><mrow><mi mathvariant=normal >âˆ‚</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mfrac><mi mathvariant=normal >âˆ‚</mi><mrow><mi mathvariant=normal >âˆ‚</mi><mi>x</mi></mrow></mfrac><mrow><mo fence=true >(</mo><msup><mi>H</mi><mi>n</mi></msup><mfrac><mrow><mi mathvariant=normal >âˆ‚</mi><mi>H</mi></mrow><mrow><mi mathvariant=normal >âˆ‚</mi><mi>x</mi></mrow></mfrac><mo fence=true >)</mo></mrow><mtext> </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex">\frac{âˆ‚H}{âˆ‚t}=\frac{âˆ‚}{âˆ‚x}\left(H^n\frac{âˆ‚H}{âˆ‚x}\right)~,</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span><span class=vlist-s >â€‹</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span></span></span></span><span class=vlist-s >â€‹</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span><span class=vlist-s >â€‹</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace nobreak"> </span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span></span></span></span></span> <p>where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span> could be the ice thickness and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span> power-law exponent, as in depth-integrated or shallow approximation &#40;SIA&#41;.</p> <p><img src="../assets/literate_figures/diffusion_nl_1D_1.gif" alt=SIA  /></p> <blockquote> <p>So-called depth-integrated or shallow approximation equations are, e.g., the shallow ice equations or the <a href="https://en.wikipedia.org/wiki/Shallow_water_equations">shallow water equations</a></p> </blockquote> <p>Adding nonlinearities in the explicit time integration approach discussed until now is fairly straight forward.</p> <p>So let&#39;s turn the <a href="/course-101-0250-00/lecture2/#pdes_-_diffusion">linear 1D diffusion from lecture 2</a> into a shallow ice-like as push-up exercise.</p> <p>ðŸ‘‰ <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/scripts/">Download the <code>diffusion_1D.jl</code> script</a> to get you started.</p> <p>We want to modify the linear 1D diffusion equation</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><mi mathvariant=normal >âˆ‚</mi><mi>C</mi></mrow><mrow><mi mathvariant=normal >âˆ‚</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mo>âˆ’</mo><mfrac><mi mathvariant=normal >âˆ‚</mi><mrow><mi mathvariant=normal >âˆ‚</mi><mi>x</mi></mrow></mfrac><mrow><mo fence=true >(</mo><mo>âˆ’</mo><mi>D</mi><mfrac><mrow><mi mathvariant=normal >âˆ‚</mi><mi>H</mi></mrow><mrow><mi mathvariant=normal >âˆ‚</mi><mi>x</mi></mrow></mfrac><mo fence=true >)</mo></mrow><mtext> </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex">\frac{âˆ‚C}{âˆ‚t}=-\frac{âˆ‚}{âˆ‚x}\left(-D\frac{âˆ‚H}{âˆ‚x}\right)~,</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span><span class=vlist-s >â€‹</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class=mord >âˆ’</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span></span></span></span><span class=vlist-s >â€‹</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=mord >âˆ’</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span><span class=vlist-s >â€‹</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace nobreak"> </span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span></span></span></span></span> <p>into</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><mi mathvariant=normal >âˆ‚</mi><mi>H</mi></mrow><mrow><mi mathvariant=normal >âˆ‚</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mo>âˆ’</mo><mfrac><mi mathvariant=normal >âˆ‚</mi><mrow><mi mathvariant=normal >âˆ‚</mi><mi>x</mi></mrow></mfrac><mrow><mo fence=true >(</mo><mo>âˆ’</mo><msub><mi>D</mi><mi>H</mi></msub><mfrac><mrow><mi mathvariant=normal >âˆ‚</mi><mi>H</mi></mrow><mrow><mi mathvariant=normal >âˆ‚</mi><mi>x</mi></mrow></mfrac><mo fence=true >)</mo></mrow><mtext> </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex">\frac{âˆ‚H}{âˆ‚t}=-\frac{âˆ‚}{âˆ‚x}\left(-D_H\frac{âˆ‚H}{âˆ‚x}\right)~,</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span><span class=vlist-s >â€‹</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class=mord >âˆ’</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span></span></span></span><span class=vlist-s >â€‹</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=mord >âˆ’</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.08125em;">H</span></span></span></span><span class=vlist-s >â€‹</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span><span class=vlist-s >â€‹</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace nobreak"> </span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span></span></span></span></span> <p>where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mi>H</mi></msub><mo>=</mo><mo stretchy=false >(</mo><msub><mi>D</mi><mn>0</mn></msub><mtext> </mtext><mi>H</mi><msup><mo stretchy=false >)</mo><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">D_H = (D_0~H)^n</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.08125em;">H</span></span></span></span><span class=vlist-s >â€‹</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >â€‹</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class=mclose ><span class=mclose >)</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span>, the effective diffusion coefficient, and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span> the, e.g., ice thickness.</p> <p>Starting from the linear 1D diffusion code, we need to</p> <ul> <li><p>change <code>C</code> to <code>H</code></p> <li><p>implement the <code>H</code>-dependent diffusion coefficient</p> <li><p>update <code>dt</code> definition</p> </ul> <p>Using the following parameters:</p> <pre><code class="julia hljs">D0   = <span class=hljs-number >5.0</span>
n    = <span class=hljs-number >5</span></code></pre> <p>ðŸ’» Let&#39;s get started ðŸš€</p> <div class=note ><div class=title >ðŸ’¡ Note</div> <div class=messg >Think about the staggering of the <code>H</code>-dependent effective diffusion coefficient. Since D is no longer constant, special care is needed for the time step definition <code>dt</code>.</div></div> <h2 id=steady-state_and_implicit_iterative_solutions ><a href="#steady-state_and_implicit_iterative_solutions" class=header-anchor >Steady-state and implicit iterative solutions</a></h2> <p>Let&#39;s now discuss how to implement steady-state and implicit iterative solvers.</p> <p>But why ?</p> <ul> <li><p>One may only be interested in the final distribution, the &quot;steady-state&quot;</p> <li><p>Strong nonlinearities may not be captured with sufficient accuracy in explicit time integration</p> </ul> <h2 id=steady-state ><a href="#steady-state" class=header-anchor >Steady-state</a></h2> <p>Let&#39;s assume we are interested in a steady-state reached by a time-dependent diffusive processes</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><mi mathvariant=normal >âˆ‚</mi><mi>C</mi></mrow><mrow><mi mathvariant=normal >âˆ‚</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mi>D</mi><mtext> </mtext><msup><mi mathvariant=normal >âˆ‡</mi><mn>2</mn></msup><mi>C</mi><mtext> </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex">\frac{âˆ‚C}{âˆ‚t}=D~âˆ‡^2C~,</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span><span class=vlist-s >â€‹</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.0585479999999998em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace nobreak"> </span><span class=mord ><span class=mord >âˆ‡</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace nobreak"> </span><span class=mpunct >,</span></span></span></span></span> <p>for time <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>â†’</mo><mi mathvariant=normal >âˆž</mi></mrow><annotation encoding="application/x-tex">tâ†’âˆž</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >â†’</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class=mord >âˆž</span></span></span></span> &#40;or <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >âˆ‚</mi><mi>t</mi><mo>â†’</mo><mi mathvariant=normal >âˆž</mi></mrow><annotation encoding="application/x-tex">âˆ‚tâ†’âˆž</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">t</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >â†’</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class=mord >âˆž</span></span></span></span>&#41;. This parabolic PDE then turn into an elliptic PDE as <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >âˆ‚</mi><mi>C</mi><mi mathvariant=normal >/</mi><mi mathvariant=normal >âˆ‚</mi><mi>t</mi><mo>â†’</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">âˆ‚C/âˆ‚t â†’ 0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=mord >/</span><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">t</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >â†’</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span></span></span></span>,</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mn>0</mn><mo>=</mo><mi>D</mi><mtext> </mtext><msup><mi mathvariant=normal >âˆ‡</mi><mn>2</mn></msup><mi>C</mi><mtext> </mtext><mi mathvariant=normal >.</mi></mrow><annotation encoding="application/x-tex">0=D~âˆ‡^2C~.</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8641079999999999em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace nobreak"> </span><span class=mord ><span class=mord >âˆ‡</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace nobreak"> </span><span class=mord >.</span></span></span></span></span> <p>How to solve <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>=</mo><mi>D</mi><mtext> </mtext><msup><mi mathvariant=normal >âˆ‡</mi><mn>2</mn></msup><mi>C</mi></mrow><annotation encoding="application/x-tex">0=D~âˆ‡^2C</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace nobreak"> </span><span class=mord ><span class=mord >âˆ‡</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span> ?</p> <h4 id=solution_1 ><a href="#solution_1" class=header-anchor >Solution 1</a></h4> <p>Use a direct sparse solver approach: build a system of linear equations in the form <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mtext> </mtext><mi>x</mi><mo>=</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">A~x=b</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span><span class="mspace nobreak"> </span><span class="mord mathnormal">x</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">b</span></span></span></span>, then apply the inverse of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span>, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>A</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">A^{-1}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8141079999999999em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal">A</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span>, on <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">b</span></span></span></span> to retrieve <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>, the solution vector &#40;you may be familiar with <code>x &#61; A \ b</code>&#41;.</p> <h4 id=solution_2 ><a href="#solution_2" class=header-anchor >Solution 2</a></h4> <p>Use an iterative matrix-free approach: introduce &#40;or bring back&#41; the transient term &#40;from explicit time integration&#41; <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >âˆ‚</mi><mi>A</mi><mi mathvariant=normal >/</mi><mi mathvariant=normal >âˆ‚</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">âˆ‚A/âˆ‚t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">A</span><span class=mord >/</span><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">t</span></span></span></span> such that <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >âˆ‚</mi><mi>A</mi><mi mathvariant=normal >/</mi><mi mathvariant=normal >âˆ‚</mi><mi>t</mi><mo>=</mo><mi>b</mi><mo>âˆ’</mo><mi>A</mi><mtext> </mtext><mi>x</mi></mrow><annotation encoding="application/x-tex">âˆ‚A/âˆ‚t=b - A~x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">A</span><span class=mord >/</span><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">t</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">b</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >âˆ’</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span><span class="mspace nobreak"> </span><span class="mord mathnormal">x</span></span></span></span> and use it to iteratively reach the steady state, i.e. when <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >âˆ‚</mi><mi>A</mi><mi mathvariant=normal >/</mi><mi mathvariant=normal >âˆ‚</mi><mi>t</mi><mo>â†’</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">âˆ‚A/âˆ‚tâ†’0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">A</span><span class=mord >/</span><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">t</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >â†’</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span></span></span></span>.</p> <h3 id=pros_and_cons_non-exhaustive ><a href="#pros_and_cons_non-exhaustive" class=header-anchor >Pros and cons &#40;non-exhaustive&#41;</a></h3> <h4 id=solution_1__2 ><a href="#solution_1__2" class=header-anchor >Solution 1</a></h4> <ul> <li><p>&#43;unconditionally stable</p> <li><p>&#43;insensitive to variation in material parameters &#40;e.g. <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>&#41;</p> <li><p>&#43;fast for &quot;few&quot; degrees of freedom &#40;dofs&#41;</p> <li><p>-nonlinear growth of memory usage</p> <li><p>-slow or impossible to apply to large systems &#40;many dofs&#41;</p> <li><p>-complex to implement</p> </ul> <h3 id=pros_and_cons_non-exhaustive__2 ><a href="#pros_and_cons_non-exhaustive__2" class=header-anchor >Pros and cons &#40;non-exhaustive&#41;</a></h3> <h4 id=solution_2__2 ><a href="#solution_2__2" class=header-anchor >Solution 2</a></h4> <ul> <li><p>&#43;unconditionally stable for physical time &#40;in the residual&#41;</p> <li><p>&#43;simple to implement</p> <li><p>&#43;low memory usage linearly growing with problem size</p> <li><p>-somewhat sensitive to variation in material parameters</p> <li><p>-needs tuning of numerical parameters &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >âˆ‚</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">âˆ‚t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">t</span></span></span></span>&#41;</p> <li><p>ðŸ‘‰ <strong>needs second order implementation</strong></p> </ul> <h3 id=investigating_solution_2 ><a href="#investigating_solution_2" class=header-anchor >Investigating <strong>solution 2</strong>:</a></h3> <ul> <li><p>the limitations from the &quot;naive&quot; first order implementation and,</p> <li><p>the second order implementation and its benefits.</p> </ul> <p>We will first implement</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mn>0</mn><mo>=</mo><mi>D</mi><mtext> </mtext><msup><mi mathvariant=normal >âˆ‡</mi><mn>2</mn></msup><mi>A</mi><mtext> </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex">0=D~âˆ‡^2A~,</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.0585479999999998em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace nobreak"> </span><span class=mord ><span class=mord >âˆ‡</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">A</span><span class="mspace nobreak"> </span><span class=mpunct >,</span></span></span></span></span> <p>which we will use as &quot;smoother&quot;, applying it to diffuse away initial random noise distribution.</p> <p>ðŸ’» Let&#39;s get started implementing the 2D Laplacian</p> <pre><code class="julia hljs"><span class=hljs-comment ># Laplacian 2D</span>
<span class=hljs-keyword >using</span> Plots

<span class=hljs-meta >@views</span> <span class=hljs-keyword >function</span> laplacian2D()

    <span class=hljs-keyword >return</span>
<span class=hljs-keyword >end</span>

<span class=hljs-meta >@time</span> laplacian2D()</code></pre> <p>We can add the following model configuration</p> <pre><code class="julia hljs">fact    = <span class=hljs-number >1</span>
<span class=hljs-comment ># Physics</span>
lx, ly  = <span class=hljs-number >10</span>, <span class=hljs-number >10</span>
D       = <span class=hljs-number >1</span>
<span class=hljs-comment ># Numerics</span>
nx, ny  = fact*<span class=hljs-number >50</span>, fact*<span class=hljs-number >50</span>
dx, dy  = lx/nx, ly/ny
niter   = <span class=hljs-number >20</span>*nx
dt      = dx^<span class=hljs-number >2</span>/D/<span class=hljs-number >4.1</span></code></pre> <p>and</p> <pre><code class="julia hljs"><span class=hljs-comment ># Initial conditions</span>
A       = ...
dAdt    = ...
A[...] .= rand(...)</code></pre> <p>To display the initial condition:</p> <pre><code class="julia hljs">display(heatmap(A&#x27;, aspect_ratio=<span class=hljs-number >1</span>, xlims=(<span class=hljs-number >1</span>,nx), ylims=(<span class=hljs-number >1</span>,ny)))</code></pre>
<p><img src="../assets/literate_figures/init_rnd.png" alt=init_rnd  /></p>
<p>Second, we can implement the time loop.</p>
<p><em>But, is it iteration loop or time loop?</em></p>
<p>If we were to solve a physical transient problem &#40;parabolic PDE&#41;, this would be the physical time loop.</p>
<p>However, we are here interested in minimising the residual function <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mtext>Â </mtext><msup><mi mathvariant=normal >âˆ‡</mi><mn>2</mn></msup><mi>A</mi></mrow><annotation encoding="application/x-tex">D~âˆ‡^2A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace nobreak">Â </span><span class=mord ><span class=mord >âˆ‡</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">A</span></span></span></span> &#40;such that <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >âˆ‚</mi><mi>A</mi><mi mathvariant=normal >/</mi><mi mathvariant=normal >âˆ‚</mi><mi>t</mi><mo>â†’</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">âˆ‚A/âˆ‚tâ†’0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">A</span><span class=mord >/</span><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">t</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >â†’</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span></span></span></span>&#41;. Thus, we are speaking about <strong>iterations or pseudo-time &#40;i.e. numerics&#41;</strong>.</p>
<p>This means that actually, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span></span></span></span> has the meaning of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï„</mi></mrow><annotation encoding="application/x-tex">Ï„</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.1132em;">Ï„</span></span></span></span>, pseudo-time or numerics.</p>
<pre><code class="julia hljs">errv = [] <span class=hljs-comment ># storage for error</span>
<span class=hljs-comment ># iteration loop</span>
<span class=hljs-keyword >for</span> it = <span class=hljs-number >1</span>:niter
   dAdt[...] .= ...
   A                     .= ...
    <span class=hljs-keyword >if</span> it % nx == <span class=hljs-number >0</span>
        err = maximum(abs.(A)); push!(errv, err)
       <span class=hljs-comment ># visualisation (error evol plot + heatmap(A))</span>
    <span class=hljs-keyword >end</span>
<span class=hljs-keyword >end</span></code></pre>
<p>Hint for visualisation</p>
<pre><code class="julia hljs">p1=plot(nx:nx:it,log10.(errv), linewidth=<span class=hljs-number >3</span>, markersize=<span class=hljs-number >4</span>,
        markershape=:circle, framestyle=:box, legend=<span class=hljs-literal >false</span>,
        xlabel=<span class=hljs-string >&quot;iter&quot;</span>, ylabel=<span class=hljs-string >&quot;log10(max(|A|))&quot;</span>, title=<span class=hljs-string >&quot;iter=<span class=hljs-variable >$it</span>&quot;</span>)
p2=heatmap(A&#x27;, aspect_ratio=<span class=hljs-number >1</span>, xlims=(<span class=hljs-number >1</span>,nx), ylims=(<span class=hljs-number >1</span>,ny),
           title=<span class=hljs-string >&quot;max(|A|)=<span class=hljs-subst >$(round(err,sigdigits=<span class=hljs-number >3</span>)</span>)&quot;</span>)
display(plot(p1,p2, dpi=<span class=hljs-number >150</span>))</code></pre>
<p>Running the <code>Laplacian.jl</code> code with <code>nx, ny &#61; 50, 50</code> &#40;thus <code>niter &#61; 1000</code>&#41; produces the following output</p>
<p><img src="../assets/literate_figures/Laplacian2D.png" alt=Laplacian2D  /></p>
<p>So over 2000 iterations, the magnitude of the error &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>max</mi><mo>â¡</mo><mo stretchy=false >(</mo><mi mathvariant=normal >âˆ£</mi><mi>A</mi><mi mathvariant=normal >âˆ£</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">\max(|A|)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mop >max</span><span class=mopen >(</span><span class=mord >âˆ£</span><span class="mord mathnormal">A</span><span class=mord >âˆ£</span><span class=mclose >)</span></span></span></span>&#41; only dropped about 1/2 an order of magnitude.</p>
<p>How can we improve this ?</p>
<p>ðŸ‘‰ <strong>One needs a second order implementation</strong></p>
<p>The goal is to reach a steady-state, we seek the left-hand-side of the &quot;numerical&quot; parabolic equation</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><mi mathvariant=normal >âˆ‚</mi><mi>A</mi></mrow><mrow><mi mathvariant=normal >âˆ‚</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mi>D</mi><mtext>Â </mtext><msup><mi mathvariant=normal >âˆ‡</mi><mn>2</mn></msup><mi>A</mi><mtext>Â </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex">\frac{âˆ‚A}{âˆ‚t}=D~âˆ‡^2A~,</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">A</span></span></span></span><span class=vlist-s >â€‹</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.0585479999999998em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace nobreak">Â </span><span class=mord ><span class=mord >âˆ‡</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">A</span><span class="mspace nobreak">Â </span><span class=mpunct >,</span></span></span></span></span>
<p>to vanish upon convergence, i.e., <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >âˆ‚</mi><mi>A</mi><mi mathvariant=normal >/</mi><mi mathvariant=normal >âˆ‚</mi><mi>t</mi><mo>â†’</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">âˆ‚A/âˆ‚tâ†’0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">A</span><span class=mord >/</span><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">t</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >â†’</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span></span></span></span>. To this end, we are free to any additional terms as long as they will also tend towards 0 with iterations.</p>
<p>We could thus add a second order term:</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><msup><mi mathvariant=normal >âˆ‚</mi><mn>2</mn></msup><mi>A</mi></mrow><mrow><mi mathvariant=normal >âˆ‚</mi><msup><mi>t</mi><mn>2</mn></msup></mrow></mfrac><mo>+</mo><mi>Î±</mi><mfrac><mrow><mi mathvariant=normal >âˆ‚</mi><mi>A</mi></mrow><mrow><mi mathvariant=normal >âˆ‚</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mi>D</mi><mtext>Â </mtext><msup><mi mathvariant=normal >âˆ‡</mi><mn>2</mn></msup><mi>A</mi><mtext>Â </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex">\frac{âˆ‚^2A}{âˆ‚t^2} + Î± \frac{âˆ‚A}{âˆ‚t}=D~âˆ‡^2A~,</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.177108em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.491108em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class=mord ><span class="mord mathnormal">t</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">A</span></span></span></span><span class=vlist-s >â€‹</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">A</span></span></span></span><span class=vlist-s >â€‹</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.0585479999999998em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace nobreak">Â </span><span class=mord ><span class=mord >âˆ‡</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">A</span><span class="mspace nobreak">Â </span><span class=mpunct >,</span></span></span></span></span>
<p>where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î±</mi></mrow><annotation encoding="application/x-tex">Î±</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span></span></span></span> is a numerical parameter to optimise.</p>
<p>Adding specifically this second order term makes the parabolic PDE to switch to an hyperbolic system, i.e., as for acoustic wave propagation.</p>
<p>Even better, we actually have now a <strong>damped wave equation</strong>&#33;</p>
<p><em>So what&#39;s exciting about it?</em></p>
<p>The first order method, a diffusion-like process &#40;parabolic PDE&#41;, converges really slowly because the speed at which information travels during smoothing steps is limited by the diffusive CFL, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi mathvariant=normal >/</mi><mi>d</mi><msup><mi>x</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">1/dx^2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.064108em;vertical-align:-0.25em;"></span><span class=mord >1</span><span class=mord >/</span><span class="mord mathnormal">d</span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>. This limitation will also make the method scale <strong>quadratically</strong> with numerical resolution increase.</p>
<p>A non-damped wave equation &#40;hyperbolic PDE&#41; has the advantage of information travelling at <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi mathvariant=normal >/</mi><mi>d</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">1/dx</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >1</span><span class=mord >/</span><span class="mord mathnormal">d</span><span class="mord mathnormal">x</span></span></span></span>, and thus the method scales <strong>linearly</strong> with numerical resolution increase. However, it would never converge.</p>
<p>The second order method is actually a damped wave equation; the damping introduces a dissipative term that will make it reach a steady state.</p>
<p>We can now tune the damping parameter to minimise the iteration count, finding the sweet spot between slowly converging diffusion and non-dissipative waves.</p>
<p>ðŸ’» Let&#39;s try it out. Starting from the <code>Laplacian.jl</code> script we just made, we&#39;ll turn it into a <code>Laplacian_damped.jl</code>.</p>
<p>Changes include now the addition of an <code>order</code> flag, damping term, a wave-like time step definition</p>
<pre><code class="julia hljs">order   = <span class=hljs-number >2</span>
dmp     = <span class=hljs-number >2.0</span>/nx
dt      = dx/sqrt(D)/<span class=hljs-number >2.1</span></code></pre>
<p>and the second order pseudo-physics</p>
<pre><code class="julia hljs">dAdt[<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>,<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>] .= ... *(<span class=hljs-number >1</span>-dmp)*(order-<span class=hljs-number >1</span>) +
A                     .= ...</code></pre>
<p>Running the <code>Laplacian_damped.jl</code> code with <code>nx, ny &#61; 50, 50</code> &#40;thus <code>niter &#61; 1000</code>&#41; produces the following output</p>
<p><img src="../assets/literate_figures/Laplacian2D_damped.png" alt="Laplacian2D damped" /></p>
<p>So over 2000 iterations, the magnitude of the error &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>max</mi><mo>â¡</mo><mo stretchy=false >(</mo><mi mathvariant=normal >âˆ£</mi><mi>A</mi><mi mathvariant=normal >âˆ£</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">\max(|A|)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mop >max</span><span class=mopen >(</span><span class=mord >âˆ£</span><span class="mord mathnormal">A</span><span class=mord >âˆ£</span><span class=mclose >)</span></span></span></span>&#41; now dropped about 8 orders of magnitude.</p>
<p>This is massive improvement over the first order method for minor changes in code ðŸ™‚</p>
<p>Also the second order method</p>
<ul>
<li><p>only adds 1 array read &#40;<code>dAdt</code>&#41;, and</p>

<li><p>is fully local &#40;no global reduction is needed&#41;</p>

</ul>
<p>Finally, we can verify that the second order method iteration count scales linearly with increase in numerical grid resolution.</p>
<h2 id=implicit_solutions ><a href="#implicit_solutions" class=header-anchor >Implicit solutions</a></h2>
<p>A couple of words about implicit, which is actually minimising all terms in the residual such that one has a &quot;steady-state&quot; to converge.</p>

<p><a href="#content">â¤´ <em><strong>back to Content</strong></em></a></p>
<h1 id=exercises_-_lecture_4 ><a href="#exercises_-_lecture_4" class=header-anchor >Exercises - lecture 4</a></h1>
<div class=page-foot >
  <div class=copyright >
    <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/"><b>Edit this page on <img class=github-logo  src="https://unpkg.com/ionicons@5.1.2/dist/svg/logo-github.svg"></b></a><br>
    Last modified: October 11, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div>
    </div>