<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/course-101-0250-00/libs/katex/katex.min.css"> <link rel=stylesheet  href="/course-101-0250-00/libs/highlight/github.min.css"> <link rel=stylesheet  href="/course-101-0250-00/css/franklin.css"> <link rel=stylesheet  href="/course-101-0250-00/css/poole_hyde.css"> <link rel=stylesheet  href="/course-101-0250-00/css/custom.css"> <style> html {font-size: 17px;} .franklin-content {position: relative; padding-left: 8%; padding-right: 5%; line-height: 1.35em;} @media (min-width: 940px) { .franklin-content {width: 100%; margin-left: auto; margin-right: auto;} } @media (max-width: 768px) { .franklin-content {padding-left: 6%; padding-right: 6%;} } </style> <link rel=icon  href="/course-101-0250-00/assets/favicon.png"> <title>Lecture 4</title> <style> .content {max-width: 50rem} </style> <div class=sidebar > <div class="container sidebar-sticky"> <div class=sidebar-about > <img src="/course-101-0250-00/assets/vaw_logo.png" style="width: 180px; height: auto; display: inline"> <div style="font-weight: margin-bottom: 0.5em"><a href="/course-101-0250-00/"> Fall 2021</a> <span style="opacity: 0.7;">| <a href="http://www.vvz.ethz.ch/Vorlesungsverzeichnis/lerneinheit.view?semkez=2021W&ansicht=KATALOGDATEN&lerneinheitId=155538&lang=en"> ETHZ 101-0250-00</a></span></div> <br> <h1><a href="/course-101-0250-00/">Solving partial differential equations in parallel on GPUs</a></h1> <div style="line-height:18px; font-size: 15px; opacity: 0.85">by <a href="https://vaw.ethz.ch/en/people/person-detail.MjcwOTYw.TGlzdC8xOTYxLDE1MTczNjI1ODA=.html">Ludovic Räss</a>, <a href="https://vaw.ethz.ch/en/personen/person-detail.html?persid=124402">Mauro Werder</a> & <a href="https://www.cscs.ch/about/staff/">Samuel Omlin</a> </div> </div> <br> <style> </style> <nav class=sidebar-nav  style="opacity: 0.9"> <a class="sidebar-nav-item " href="/course-101-0250-00/"><b>Welcome</b></a> <a class="sidebar-nav-item " href="/course-101-0250-00/logistics/">Logistics</a> <a class="sidebar-nav-item " href="/course-101-0250-00/homework/">Homework</a> <a class="sidebar-nav-item " href="/course-101-0250-00/software_install/">Software install</a> <a class="sidebar-nav-item " href="/course-101-0250-00/extras/">Extras</a> <br> <div class=course-section >Part 1 - Introduction</div> <a class="sidebar-nav-item " href="/course-101-0250-00/lecture1/">Lecture 1 - Why Julia GPU</a> <a class="sidebar-nav-item " href="/course-101-0250-00/lecture2/">Lecture 2 - ODEs & PDEs</a> <a class="sidebar-nav-item " href="/course-101-0250-00/lecture3/">Lecture 3 - Acoustic waves</a> <a class="sidebar-nav-item active" href="/course-101-0250-00/lecture4/">Lecture 4 - Implicit & nonlinear</a> <div class=course-section >Part 2 - Solving PDEs on GPUs</div> <a class="sidebar-nav-item " href="/course-101-0250-00/lecture5/">Lecture 5 - Parallel computing</a> <a class="sidebar-nav-item " href="/course-101-0250-00/lecture6/">Lecture 6 - GPU computing & perf</a> <a class="sidebar-nav-item " href="/course-101-0250-00/lecture7/">Lecture 7 - XPU computing</a> <a class="sidebar-nav-item " href="/course-101-0250-00/lecture8/">Lecture 8 - Julia MPI & multi-XPU</a> <a class="sidebar-nav-item " href="/course-101-0250-00/lecture9/">Lecture 9 - Advanced optimisations</a> <div class=course-section >Part 3 - Projects</div> <a class="sidebar-nav-item " href="/course-101-0250-00/lecture10/">Lecture 10 - Final projects</a> <br> <br> </nav> </div> </div> <div class="content container"> <div class=franklin-content > <h1 id=lecture_4 ><a href="#lecture_4" class=header-anchor >Lecture 4</a></h1> <blockquote> <p><strong>Agenda</strong><br />📚 Implicit and nonlinear solutions<br />💻 Julia&#39;s <code>Project</code> environment<br />🚧 Exercises:</p> <ul> <li><p>nonlinear diffusion 2D</p> <li><p>Laplacian vs damped Laplacian</p> <li><p>steady-state implicit nonlinear diffusion 1D &amp; 2D</p> </ul> </blockquote> <p><hr /> </p> <p><a id=content  class=anchor ></a> <strong>Content</strong></p> <div class=franklin-toc ><ol><li><a href="#lecture_4">Lecture 4</a><li><a href="#nonlinear_and_implicit_solutions">Nonlinear and implicit solutions</a><ol><li><a href="#nonlinear_solutions">Nonlinear solutions</a><li><a href="#steady-state_and_implicit_iterative_solutions">Steady-state and implicit iterative solutions</a><li><a href="#steady-state">Steady-state</a><li><a href="#implicit_solutions">Implicit solutions</a></ol><li><a href="#julias_project_environment">Julia&#39;s Project environment</a><li><a href="#exercises_-_lecture_4">Exercises - lecture 4</a><ol><li><a href="#exercise_1_-_nonlinear_diffusion_in_2d">Exercise 1 - <strong>Nonlinear diffusion in 2D</strong></a><li><a href="#exercise_2_-_damped_laplacian">Exercise 2 - <strong>Damped Laplacian</strong></a><li><a href="#exercise_3_-_nonlinear_steady-state_diffusion_1d">Exercise 3 - <strong>Nonlinear steady-state diffusion 1D</strong></a><li><a href="#exercise_4_-_nonlinear_steady-state_diffusion_2d">Exercise 4 - <strong>Nonlinear steady-state diffusion 2D</strong></a></ol></ol></div> <p><a href="#exercises_-_lecture_4"><em>👉 get started with exercises</em></a></p> <hr /> <h1 id=nonlinear_and_implicit_solutions ><a href="#nonlinear_and_implicit_solutions" class=header-anchor >Nonlinear and implicit solutions</a></h1> <h3 id=the_goal_of_this_lecture_4_is_to_explore ><a href="#the_goal_of_this_lecture_4_is_to_explore" class=header-anchor >The goal of this lecture 4 is to explore:</a></h3> <ul> <li><p>Nonlinear solutions</p> <li><p>Steady-state and implicit iterative solutions</p> </ul> <h3 id=building_upon ><a href="#building_upon" class=header-anchor >Building upon:</a></h3> <ul> <li><p>The diffusion equation</p> <li><p>Spatial discretisation: 1D and 2D</p> <li><p>Finite-differences and staggered grids</p> </ul> <h2 id=nonlinear_solutions ><a href="#nonlinear_solutions" class=header-anchor >Nonlinear solutions</a></h2> <p>Until now we investigated linear and transient processes using a forward Euler explicit time integration.</p> <p>However many interesting application may exhibit nonlinear behaviours, e.g.,</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>H</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mfrac><mi mathvariant=normal >∂</mi><mrow><mi mathvariant=normal >∂</mi><mi>x</mi></mrow></mfrac><mrow><mo fence=true >(</mo><msup><mi>H</mi><mi>n</mi></msup><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>H</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>x</mi></mrow></mfrac><mo fence=true >)</mo></mrow><mtext> </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex">\frac{∂H}{∂t}=\frac{∂}{∂x}\left(H^n\frac{∂H}{∂x}\right)~,</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace nobreak"> </span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span></span></span></span></span> <p>where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span> could be the ice thickness and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span> a power-law exponent &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>3</mn><mo>−</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">n=3-5</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.72777em;vertical-align:-0.08333em;"></span><span class=mord >3</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >5</span></span></span></span>&#41;, as in depth-integrated or shallow ice approximation &#40;SIA&#41; models:</p> <p><img src="../assets/literate_figures/diffusion_nl_1D_1.gif" alt=SIA  /></p> <blockquote> <p>So-called depth-integrated or shallow approximation equations are, e.g., the shallow ice equations or the <a href="https://en.wikipedia.org/wiki/Shallow_water_equations">shallow water equations</a></p> </blockquote> <p>Adding nonlinearities in the explicit time integration approach is fairly straight forward.</p> <p>Let&#39;s turn the <a href="/course-101-0250-00/lecture2/#pdes_-_diffusion">linear 1D diffusion from lecture 2</a> into a shallow ice-like solver as push-up exercise.</p> <p>👉 <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/scripts/">Download the <code>diffusion_1D.jl</code> script</a> to get you started.</p> <p>We want to modify the linear 1D diffusion equation</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>C</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mo>−</mo><mfrac><mi mathvariant=normal >∂</mi><mrow><mi mathvariant=normal >∂</mi><mi>x</mi></mrow></mfrac><mrow><mo fence=true >(</mo><mo>−</mo><mi>D</mi><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>H</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>x</mi></mrow></mfrac><mo fence=true >)</mo></mrow><mtext> </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex">\frac{∂C}{∂t}=-\frac{∂}{∂x}\left(-D\frac{∂H}{∂x}\right)~,</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class=mord >−</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=mord >−</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace nobreak"> </span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span></span></span></span></span> <p>into</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>H</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mo>−</mo><mfrac><mi mathvariant=normal >∂</mi><mrow><mi mathvariant=normal >∂</mi><mi>x</mi></mrow></mfrac><mrow><mo fence=true >(</mo><mo>−</mo><msub><mi>D</mi><mi>H</mi></msub><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>H</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>x</mi></mrow></mfrac><mo fence=true >)</mo></mrow><mtext> </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex">\frac{∂H}{∂t}=-\frac{∂}{∂x}\left(-D_H\frac{∂H}{∂x}\right)~,</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class=mord >−</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=mord >−</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.08125em;">H</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace nobreak"> </span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span></span></span></span></span> <p>where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mi>H</mi></msub><mo>=</mo><mo stretchy=false >(</mo><msub><mi>D</mi><mn>0</mn></msub><mtext> </mtext><mi>H</mi><msup><mo stretchy=false >)</mo><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">D_H = (D_0~H)^n</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.08125em;">H</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class=mclose ><span class=mclose >)</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span> is the effective diffusion coefficient, and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span> the, e.g., the ice thickness.</p> <p>Starting from the linear 1D diffusion code, we need to:</p> <ul> <li><p>change <code>C</code> to <code>H</code></p> <li><p>implement the <code>H</code>-dependent diffusion coefficient</p> <li><p>update <code>dt</code> definition</p> </ul> <p>Using the following parameters:</p> <pre><code class="julia hljs">D0   = <span class=hljs-number >5.0</span>
n    = <span class=hljs-number >5</span></code></pre> <p>💻 Let&#39;s get started 🚀</p> <p><div class=note ><div class=title >💡 Note</div> <div class=messg >Think about the staggering of the <code>H</code>-dependent effective diffusion coefficient. Since D is no longer constant, special care is needed for the time step definition <code>dt</code>.</div></div> The effective diffusion coefficient and time step definition can be implement as</p> <pre><code class="julia hljs">D  .= (D0.*H).^n
dt  = dx^<span class=hljs-number >2</span>/maximum(D)/<span class=hljs-number >2.1</span>
qx .= .-av(D)</code></pre> <p>where <code>dt</code> must be placed inside the time loop and <code>av</code> is the averaging function defined as</p> <pre><code class="julia hljs"><span class=hljs-meta >@views</span> av(A) = <span class=hljs-number >0.5</span>.*(A[<span class=hljs-number >1</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>].+A[<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>])</code></pre>
<p>👉 <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/scripts/">Download the <code>diffusion_nl_1D.jl</code> script.</a></p>
<h2 id=steady-state_and_implicit_iterative_solutions ><a href="#steady-state_and_implicit_iterative_solutions" class=header-anchor >Steady-state and implicit iterative solutions</a></h2>
<p>Let&#39;s now discuss how to implement steady-state and implicit iterative solvers.</p>
<p><em>But why?</em></p>
<ul>
<li><p>One may only be interested in the final distribution, or &quot;steady-state&quot;.</p>

<li><p>Strong nonlinearities may not be captured with sufficient accuracy in explicit time integration.</p>

</ul>
<h2 id=steady-state ><a href="#steady-state" class=header-anchor >Steady-state</a></h2>
<p>Let&#39;s assume we are interested in a steady-state reached by a time-dependent diffusive processes</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>A</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mi>D</mi><mtext> </mtext><msup><mi mathvariant=normal >∇</mi><mn>2</mn></msup><mi>A</mi><mtext> </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex">\frac{∂A}{∂t}=D~∇^2A~,</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">A</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.0585479999999998em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace nobreak"> </span><span class=mord ><span class=mord >∇</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">A</span><span class="mspace nobreak"> </span><span class=mpunct >,</span></span></span></span></span>
<p>for time <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>→</mo><mi mathvariant=normal >∞</mi></mrow><annotation encoding="application/x-tex">t→∞</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class=mord >∞</span></span></span></span> &#40;or <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >∂</mi><mi>t</mi><mo>→</mo><mi mathvariant=normal >∞</mi></mrow><annotation encoding="application/x-tex">∂t→∞</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class=mord >∞</span></span></span></span>&#41;. This parabolic PDE then turns into an elliptic PDE as <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >∂</mi><mi>A</mi><mi mathvariant=normal >/</mi><mi mathvariant=normal >∂</mi><mi>t</mi><mo>→</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">∂A/∂t → 0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">A</span><span class=mord >/</span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span></span></span></span>,</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mn>0</mn><mo>=</mo><mi>D</mi><mtext> </mtext><msup><mi mathvariant=normal >∇</mi><mn>2</mn></msup><mi>A</mi><mtext> </mtext><mi mathvariant=normal >.</mi></mrow><annotation encoding="application/x-tex">0=D~∇^2A~.</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8641079999999999em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace nobreak"> </span><span class=mord ><span class=mord >∇</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">A</span><span class="mspace nobreak"> </span><span class=mord >.</span></span></span></span></span>
<p>How to solve <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>=</mo><mi>D</mi><mtext> </mtext><msup><mi mathvariant=normal >∇</mi><mn>2</mn></msup><mi>A</mi></mrow><annotation encoding="application/x-tex">0=D~∇^2 A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace nobreak"> </span><span class=mord ><span class=mord >∇</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">A</span></span></span></span> ?</p>
<h4 id=solution_1 ><a href="#solution_1" class=header-anchor >Solution 1</a></h4>
<p>Use a direct sparse solver approach: build a system of linear equations in the form <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mtext> </mtext><mi>a</mi><mo>=</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">K~a=b</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mspace nobreak"> </span><span class="mord mathnormal">a</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">b</span></span></span></span>, where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span></span></span></span> is the solution vector &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span> from the Laplacian notation&#41; and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> the finite-difference coefficient matrix &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mtext> </mtext><msup><mi mathvariant=normal >∇</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">D~∇^2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace nobreak"> </span><span class=mord ><span class=mord >∇</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>&#41;, then apply the inverse of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span>, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>K</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">K^{-1}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8141079999999999em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span>, on <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">b</span></span></span></span> to retrieve <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span></span></span></span> &#40;you may be familiar with <code>a &#61; K \ b</code>&#41;.</p>
<h4 id=solution_2 ><a href="#solution_2" class=header-anchor >Solution 2</a></h4>
<p>Use an iterative matrix-free approach: introduce &#40;or bring back&#41; the transient term &#40;from explicit time integration&#41; <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >∂</mi><mi>a</mi><mi mathvariant=normal >/</mi><mi mathvariant=normal >∂</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">∂a/∂t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">a</span><span class=mord >/</span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span></span> such that <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >∂</mi><mi>a</mi><mi mathvariant=normal >/</mi><mi mathvariant=normal >∂</mi><mi>t</mi><mo>=</mo><mi>b</mi><mo>−</mo><mi>K</mi><mtext> </mtext><mi>a</mi></mrow><annotation encoding="application/x-tex">∂a/∂t=b - K~a</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">a</span><span class=mord >/</span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">b</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mspace nobreak"> </span><span class="mord mathnormal">a</span></span></span></span> and use it to iteratively reach the steady state, i.e. when <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >∂</mi><mi>a</mi><mi mathvariant=normal >/</mi><mi mathvariant=normal >∂</mi><mi>t</mi><mo>→</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">∂a/∂t→0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">a</span><span class=mord >/</span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span></span></span></span>.</p>
<h4 id=pros_and_cons_solution_1_non-exhaustive ><a href="#pros_and_cons_solution_1_non-exhaustive" class=header-anchor >Pros and cons Solution 1 <em>&#40;non-exhaustive&#41;</em></a></h4>
<ul>
<li><p>&#43;unconditionally stable</p>

<li><p>&#43;insensitive to variation in material parameters &#40;e.g. <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>&#41;</p>

<li><p>&#43;fast for &quot;few&quot; degrees of freedom &#40;dofs&#41;</p>

<li><p>-nonlinear growth of memory usage</p>

<li><p>-slow or impossible to apply to large systems &#40;many dofs&#41;</p>

<li><p>-complex to implement</p>

</ul>
<h4 id=pros_and_cons_solution_2_non-exhaustive ><a href="#pros_and_cons_solution_2_non-exhaustive" class=header-anchor >Pros and cons Solution 2 <em>&#40;non-exhaustive&#41;</em></a></h4>
<ul>
<li><p>&#43;unconditionally stable for physical time &#40;in the residual&#41;</p>

<li><p>&#43;simple to implement</p>

<li><p>&#43;low memory usage linearly growing with problem size</p>

<li><p>-somewhat sensitive to variation in material parameters</p>

<li><p>-needs tuning of numerical parameters &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">∂t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span></span>&#41;</p>

<li><p>👉 <strong>needs second order implementation</strong></p>

</ul>
<h3 id=investigating_solution_2 ><a href="#investigating_solution_2" class=header-anchor >Investigating <em>Solution 2</em>:</a></h3>
<ul>
<li><p>the limitations from the &quot;naive&quot; first order implementation</p>

<li><p>the second order implementation and its benefits.</p>

</ul>
<p>We will first implement</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mn>0</mn><mo>=</mo><mi>D</mi><mtext> </mtext><msup><mi mathvariant=normal >∇</mi><mn>2</mn></msup><mi>A</mi><mtext> </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex">0=D~∇^2A~,</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.0585479999999998em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace nobreak"> </span><span class=mord ><span class=mord >∇</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">A</span><span class="mspace nobreak"> </span><span class=mpunct >,</span></span></span></span></span>
<p>which we will use as &quot;smoother&quot;, applying it to diffuse away initial random noise distribution.</p>
<p>💻 Let&#39;s get started implementing the 2D Laplacian</p>
<pre><code class="julia hljs"><span class=hljs-comment ># Laplacian 2D</span>
<span class=hljs-keyword >using</span> Plots

<span class=hljs-meta >@views</span> <span class=hljs-keyword >function</span> laplacian2D()

    <span class=hljs-keyword >return</span>
<span class=hljs-keyword >end</span>

<span class=hljs-meta >@time</span> laplacian2D()</code></pre>
<p>We can use the following model configuration</p>
<pre><code class="julia hljs">fact    = <span class=hljs-number >1</span>
<span class=hljs-comment ># Physics</span>
lx, ly  = <span class=hljs-number >10</span>, <span class=hljs-number >10</span>
D       = <span class=hljs-number >1</span>
<span class=hljs-comment ># Numerics</span>
nx, ny  = fact*<span class=hljs-number >50</span>, fact*<span class=hljs-number >50</span>
dx, dy  = lx/nx, ly/ny
niter   = <span class=hljs-number >20</span>*nx
dt      = dx^<span class=hljs-number >2</span>/D/<span class=hljs-number >4.1</span></code></pre>
<p>and initial conditions</p>
<pre><code class="julia hljs"><span class=hljs-comment ># Initial conditions</span>
A       = zeros(<span class=hljs-built_in >Float64</span>, nx,ny)
dAdt    = zeros(<span class=hljs-built_in >Float64</span>, nx,ny)
A[<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>,<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>] .= rand(nx-<span class=hljs-number >2</span>,ny-<span class=hljs-number >2</span>)</code></pre>
<p>To display the initial condition:</p>
<pre><code class="julia hljs">display(heatmap(A&#x27;, aspect_ratio=<span class=hljs-number >1</span>, xlims=(<span class=hljs-number >1</span>,nx), ylims=(<span class=hljs-number >1</span>,ny)))</code></pre>
<p><img src="../assets/literate_figures/init_rnd.png" alt=init_rnd  /></p>
<p>Second, we can implement the time loop.</p>
<p><em>But, is it iteration loop or time loop?</em></p>
<p>If we were to solve a physical transient problem &#40;parabolic PDE&#41;, this would be the physical time loop.</p>
<p>However, we are here interested in minimising the residual function <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mtext> </mtext><msup><mi mathvariant=normal >∇</mi><mn>2</mn></msup><mi>A</mi></mrow><annotation encoding="application/x-tex">D~∇^2A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace nobreak"> </span><span class=mord ><span class=mord >∇</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">A</span></span></span></span> &#40;such that <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >∂</mi><mi>A</mi><mi mathvariant=normal >/</mi><mi mathvariant=normal >∂</mi><mi>t</mi><mo>→</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">∂A/∂t→0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">A</span><span class=mord >/</span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span></span></span></span>&#41;. Thus, we are speaking about <strong>iterations or pseudo-time &#40;i.e. numerics&#41;</strong>.</p>
<p>This means that actually, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span></span></span></span> has the meaning of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>τ</mi></mrow><annotation encoding="application/x-tex">τ</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span></span></span></span>, pseudo-time or numerics.</p>
<pre><code class="julia hljs">errv = [] <span class=hljs-comment ># storage for error</span>
<span class=hljs-comment ># iteration loop</span>
<span class=hljs-keyword >for</span> it = <span class=hljs-number >1</span>:niter
   dAdt[<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>,<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>] .= D.*( diff(diff(A[:,<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>],dims=<span class=hljs-number >1</span>),dims=<span class=hljs-number >1</span>)/dx^<span class=hljs-number >2</span> .+
                                 diff(diff(A[<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>,:],dims=<span class=hljs-number >2</span>),dims=<span class=hljs-number >2</span>)/dy^<span class=hljs-number >2</span> )
   A                     .= A .+ dt.*dAdt
    <span class=hljs-keyword >if</span> it % nx == <span class=hljs-number >0</span>
        err = maximum(abs.(A)); push!(errv, err)
       p1=plot(nx:nx:it,log10.(errv), linewidth=<span class=hljs-number >3</span>, markersize=<span class=hljs-number >4</span>,
               markershape=:circle, framestyle=:box, legend=<span class=hljs-literal >false</span>,
               xlabel=<span class=hljs-string >&quot;iter&quot;</span>, ylabel=<span class=hljs-string >&quot;log10(max(|A|))&quot;</span>, title=<span class=hljs-string >&quot;iter=<span class=hljs-variable >$it</span>&quot;</span>)
       p2=heatmap(A&#x27;, aspect_ratio=<span class=hljs-number >1</span>, xlims=(<span class=hljs-number >1</span>,nx), ylims=(<span class=hljs-number >1</span>,ny),
                  title=<span class=hljs-string >&quot;max(|A|)=<span class=hljs-subst >$(round(err,sigdigits=<span class=hljs-number >3</span>)</span>)&quot;</span>)
       display(plot(p1,p2, dpi=<span class=hljs-number >150</span>))
    <span class=hljs-keyword >end</span>
<span class=hljs-keyword >end</span></code></pre>
<p>👉 <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/scripts/">Download the <code>Laplacian.jl</code> script</a>.</p>
<p>Running the <code>Laplacian.jl</code> code with <code>nx, ny &#61; 50, 50</code> &#40;thus <code>niter &#61; 1000</code>&#41; produces the following output</p>
<p><img src="../assets/literate_figures/Laplacian2D.png" alt=Laplacian2D  /></p>
<p>So over 1000 iterations, the magnitude of the error &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>max</mi><mo>⁡</mo><mo stretchy=false >(</mo><mi mathvariant=normal >∣</mi><mi>A</mi><mi mathvariant=normal >∣</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">\max(|A|)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mop >max</span><span class=mopen >(</span><span class=mord >∣</span><span class="mord mathnormal">A</span><span class=mord >∣</span><span class=mclose >)</span></span></span></span>&#41; only dropped about 1/2 an order of magnitude.</p>
<p>How can we improve this?</p>
<h4 id=one_needs_a_second_order_implementation ><a href="#one_needs_a_second_order_implementation" class=header-anchor >👉 One needs a second order implementation</a></h4>
<p>The goal is to reach a steady-state, we thus seek the left-hand-side of the &quot;numerical&quot; parabolic equation</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>A</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mi>D</mi><mtext> </mtext><msup><mi mathvariant=normal >∇</mi><mn>2</mn></msup><mi>A</mi><mtext> </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex">\frac{∂A}{∂t}=D~∇^2A~,</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">A</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.0585479999999998em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace nobreak"> </span><span class=mord ><span class=mord >∇</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">A</span><span class="mspace nobreak"> </span><span class=mpunct >,</span></span></span></span></span>
<p>to vanish upon convergence, i.e., <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >∂</mi><mi>A</mi><mi mathvariant=normal >/</mi><mi mathvariant=normal >∂</mi><mi>t</mi><mo>→</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">∂A/∂t→0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">A</span><span class=mord >/</span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span></span></span></span>. To this end, we are free to add any additional terms as long as they will also tend towards 0 with iterations.</p>
<p>We could thus add a second order term:</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><msup><mi mathvariant=normal >∂</mi><mn>2</mn></msup><mi>A</mi></mrow><mrow><mi mathvariant=normal >∂</mi><msup><mi>t</mi><mn>2</mn></msup></mrow></mfrac><mo>+</mo><mi>α</mi><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>A</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mi>D</mi><mtext> </mtext><msup><mi mathvariant=normal >∇</mi><mn>2</mn></msup><mi>A</mi><mtext> </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex">\frac{∂^2A}{∂t^2} + α \frac{∂A}{∂t}=D~∇^2A~,</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.177108em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.491108em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal">t</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">A</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">A</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.0585479999999998em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace nobreak"> </span><span class=mord ><span class=mord >∇</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">A</span><span class="mspace nobreak"> </span><span class=mpunct >,</span></span></span></span></span>
<p>where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">α</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span></span></span> is a numerical parameter to optimise.</p>
<p>Adding specifically this second order term makes the parabolic PDE to switch to an hyperbolic system, e.g., the acoustic wave propagation.</p>
<p>Even better, we actually have now a <strong>damped wave equation</strong>&#33;</p>
<p><em>So what&#39;s exciting about it?</em></p>
<p>The first order method, a diffusion-like process &#40;parabolic PDE&#41;, converges really slowly because the speed at which information travels during smoothing steps is limited by the diffusive CFL, function of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi mathvariant=normal >/</mi><mi>d</mi><msup><mi>x</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">1/dx^2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.064108em;vertical-align:-0.25em;"></span><span class=mord >1</span><span class=mord >/</span><span class="mord mathnormal">d</span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>. This limitation will also make the method scale <strong>quadratically</strong> with numerical resolution increase.</p>
<p>A non-damped wave equation &#40;hyperbolic PDE&#41; features information travelling using the wave CFL, functrion of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi mathvariant=normal >/</mi><mi>d</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">1/dx</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >1</span><span class=mord >/</span><span class="mord mathnormal">d</span><span class="mord mathnormal">x</span></span></span></span>, and thus the method could scale <strong>linearly</strong> with numerical resolution increase. However, it would never converge.</p>
<p>The second order method is actually a damped wave equation; the damping introduces a dissipative term that allows to reach a steady state.</p>
<p>We can now tune the damping parameter to minimise the iteration count, finding the sweet spot between slowly converging diffusion and non-dissipative waves.</p>
<blockquote>
<p>One classical reference to this method can be found in <a href="https://doi.org/10.2307/2002770">Frankel &#40;1950&#41;</a>, reported as <em><strong>the second order Richardson method</strong></em>.<br />In the coming weeks, a preprint will be made available that further discusses the second-order method, also named <em><strong>pseudo-transient method</strong></em>, and the optimal damping parameter selection.</p>
</blockquote>
<p>💻 Let&#39;s try it out. Starting from the <code>Laplacian.jl</code> script we just made, we&#39;ll turn it into a <code>Laplacian_damped.jl</code>.</p>
<p>Changes include now the addition of an <code>order</code> flag, damping term <code>dmp</code>, a wave-like time step definition,</p>
<pre><code class="julia hljs">order   = <span class=hljs-number >2</span>
dmp     = <span class=hljs-number >2.0</span>/nx
dt      = dx/sqrt(D)/<span class=hljs-number >2.1</span></code></pre>
<p>and the second order pseudo-physics</p>
<pre><code class="julia hljs">dAdt[<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>,<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>] .= dAdt[<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>,<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>]*(<span class=hljs-number >1</span>-dmp)*(order-<span class=hljs-number >1</span>) .+
                         dt.*D.*( diff(diff(A[:,<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>],dims=<span class=hljs-number >1</span>),dims=<span class=hljs-number >1</span>)/dx^<span class=hljs-number >2</span> .+
                                  diff(diff(A[<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>,:],dims=<span class=hljs-number >2</span>),dims=<span class=hljs-number >2</span>)/dy^<span class=hljs-number >2</span> )
A                     .= A .+ dt.*dAdt</code></pre>
<p>👉 <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/scripts/">Download the <code>Laplacian_damped.jl</code> script</a>.</p>
<p>Running the <code>Laplacian_damped.jl</code> code with <code>nx, ny &#61; 50, 50</code> &#40;thus <code>niter &#61; 1000</code>&#41; produces the following output</p>
<p><img src="../assets/literate_figures/Laplacian2D_damped.png" alt="Laplacian2D damped" /></p>
<p>Yay, over the same 1000 iterations, the magnitude of the error &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>max</mi><mo>⁡</mo><mo stretchy=false >(</mo><mi mathvariant=normal >∣</mi><mi>A</mi><mi mathvariant=normal >∣</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">\max(|A|)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mop >max</span><span class=mopen >(</span><span class=mord >∣</span><span class="mord mathnormal">A</span><span class=mord >∣</span><span class=mclose >)</span></span></span></span>&#41; now dropped about 8 orders of magnitude.</p>
<p>This is a massive improvement over the first order method for minor changes in code 🙂</p>
<p>Also the second order method:</p>
<ul>
<li><p>only adds 1 array read &#40;<code>dAdt</code>&#41;, and</p>

<li><p>is fully local &#40;no global reduction is needed&#41;</p>

</ul>
<p>Finally, we can verify that the second order method iteration count scales linearly with increase in numerical grid resolution.</p>
<p>Note that various formulations of the second-order implementation exist and lead to a linear scaling of iteration count with resolution increase. A useful and more concise one may be the following one:</p>
<pre><code class="julia hljs">dAdt[<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>,<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>] .= dAdt[<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>,<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>].*(<span class=hljs-number >1</span>-dmp) .+
                         D.*( diff(diff(A[:,<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>],dims=<span class=hljs-number >1</span>),dims=<span class=hljs-number >1</span>)/dx^<span class=hljs-number >2</span> .+
                              diff(diff(A[<span class=hljs-number >2</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>,:],dims=<span class=hljs-number >2</span>),dims=<span class=hljs-number >2</span>)/dy^<span class=hljs-number >2</span> )
A                     .= A .+ dt.*dAdt</code></pre>
<h2 id=implicit_solutions ><a href="#implicit_solutions" class=header-anchor >Implicit solutions</a></h2>
<p>The usage of <em>implicit</em> may be confusing as it often lacks of clear definition and context.</p>
<p>In a physics-based PDE world, an <em>implicit solution</em> most often refers to:</p>
<ul>
<li><p>a time-independent solution &#40;steady-state&#41;, or</p>

<li><p>a time-dependant solution where the spatial derivatives are evaluated for the new time integration layer one is actually solving for.</p>

</ul>
<p>Achieving an implicit solution of following time-dependent diffusive &#40;parabolic&#41; PDE,</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>C</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mi>D</mi><mtext> </mtext><msup><mi mathvariant=normal >∇</mi><mn>2</mn></msup><mi>C</mi><mtext> </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex">\frac{∂C}{∂t}=D~∇^2C~,</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.0585479999999998em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace nobreak"> </span><span class=mord ><span class=mord >∇</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace nobreak"> </span><span class=mpunct >,</span></span></span></span></span>
<p>implies a time discretisation as</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msup><mi>C</mi><mrow><mi>t</mi><mo>+</mo><mtext>∆</mtext><mi>t</mi></mrow></msup><mo>=</mo><msup><mi>C</mi><mi>t</mi></msup><mo>+</mo><mtext>∆</mtext><mi>t</mi><mtext> </mtext><mi>D</mi><mtext> </mtext><msup><mi mathvariant=normal >∇</mi><mn>2</mn></msup><msup><mi>C</mi><mrow><mi>t</mi><mo>+</mo><mtext>∆</mtext><mi>t</mi></mrow></msup><mtext> </mtext><mi mathvariant=normal >.</mi></mrow><annotation encoding="application/x-tex">C^{t+∆t}=C^{t} + ∆t~D~∇^2C^{t+∆t}~.</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.843556em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.843556em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">∆</span><span class="mord mathnormal mtight">t</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.926886em;vertical-align:-0.08333em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.843556em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.8641079999999999em;vertical-align:0em;"></span><span class=mord >∆</span><span class="mord mathnormal">t</span><span class="mspace nobreak"> </span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace nobreak"> </span><span class=mord ><span class=mord >∇</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.843556em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">∆</span><span class="mord mathnormal mtight">t</span></span></span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class=mord >.</span></span></span></span></span>
<p>In the iterative framework we previously discussed, a solution of this physical time-dependent diffusion equation can be achieved by:</p>
<ul>
<li><p>collecting all physical terms in the right-hand-side &#40;spatial and temporal derivatives&#41;,</p>

<li><p>augmenting the system, on the left-hand-side, by a numerical or pseudo-time integration <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >∂</mi><mi>C</mi><mi mathvariant=normal >/</mi><mi mathvariant=normal >∂</mi><mi>τ</mi></mrow><annotation encoding="application/x-tex">∂C/∂τ</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=mord >/</span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span></span></span></span>:</p>

</ul>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>C</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>τ</mi></mrow></mfrac><mo>=</mo><mo>−</mo><mfrac><mrow><mi mathvariant=normal >∂</mi><mi>C</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow></mfrac><mo>+</mo><mi>D</mi><mtext> </mtext><msup><mi mathvariant=normal >∇</mi><mn>2</mn></msup><mi>C</mi><mtext> </mtext><mi mathvariant=normal >.</mi></mrow><annotation encoding="application/x-tex">\frac{∂C}{∂τ}=-\frac{∂C}{∂t} + D~∇^2C~.</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord >−</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.8641079999999999em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace nobreak"> </span><span class=mord ><span class=mord >∇</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace nobreak"> </span><span class=mord >.</span></span></span></span></span>
<p>This system can now be solved using the second order method we previously introduced, the physical time derivative acting as a reaction term with <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>∆</mtext><mi>t</mi></mrow><annotation encoding="application/x-tex">∆t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.61508em;vertical-align:0em;"></span><span class=mord >∆</span><span class="mord mathnormal">t</span></span></span></span> the physical time-step acting as a &quot;reaction rate&quot; analogous:</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msup><mi>C</mi><mrow><mi>τ</mi><mo>+</mo><mtext>∆</mtext><mi>τ</mi></mrow></msup><mo>=</mo><msup><mi>C</mi><mi>τ</mi></msup><mo>+</mo><mtext>∆</mtext><mi>τ</mi><mtext> </mtext><mrow><mo fence=true >(</mo><mo>−</mo><mfrac><mrow><msup><mi>C</mi><mi>τ</mi></msup><mo>−</mo><msup><mi>C</mi><mi>t</mi></msup></mrow><mrow><mtext>∆</mtext><mi>t</mi></mrow></mfrac><mo>+</mo><mtext> </mtext><mi>D</mi><mtext> </mtext><msup><mi mathvariant=normal >∇</mi><mn>2</mn></msup><msup><mi>C</mi><mi>τ</mi></msup><mo fence=true >)</mo></mrow><mtext> </mtext><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex">C^{τ+∆τ}=C^{τ} + ∆τ~\left( -\frac{C^{τ}-C^{t}}{∆t} + ~D~∇^2C^{τ} \right)~,</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.821331em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.821331em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.1132em;">τ</span><span class="mbin mtight">+</span><span class="mord mtight">∆</span><span class="mord mathnormal mtight" style="margin-right:0.1132em;">τ</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.7977219999999999em;vertical-align:-0.08333em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.1132em;">τ</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:2.420586em;vertical-align:-0.95003em;"></span><span class=mord >∆</span><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span><span class="mspace nobreak"> </span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=mord >−</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.470556em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >∆</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.1132em;">τ</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.7935559999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class="mspace nobreak"> </span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace nobreak"> </span><span class=mord ><span class=mord >∇</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.1132em;">τ</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace nobreak"> </span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span></span></span></span></span>
<p>where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>C</mi><mi>τ</mi></msup><mo>=</mo><msup><mi>C</mi><mrow><mi>τ</mi><mo>+</mo><mtext>∆</mtext><mi>τ</mi></mrow></msup><mo>=</mo><msup><mi>C</mi><mrow><mi>t</mi><mo>+</mo><mtext>∆</mtext><mi>t</mi></mrow></msup></mrow><annotation encoding="application/x-tex">C^{τ} = C^{τ+∆τ} = C^{t+∆t}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.1132em;">τ</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.771331em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.771331em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.1132em;">τ</span><span class="mbin mtight">+</span><span class="mord mtight">∆</span><span class="mord mathnormal mtight" style="margin-right:0.1132em;">τ</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.7935559999999999em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.7935559999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">∆</span><span class="mord mathnormal mtight">t</span></span></span></span></span></span></span></span></span></span></span></span> upon convergence, i.e., upon <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >∂</mi><mi>C</mi><mi mathvariant=normal >/</mi><mi mathvariant=normal >∂</mi><mi>τ</mi><mo>→</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">∂C/∂τ → 0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=mord >/</span><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span></span></span></span>.</p>
<p>This approach is also known as the &quot;dual-time stepping&quot;.</p>
<h1 id=julias_project_environment ><a href="#julias_project_environment" class=header-anchor >Julia&#39;s Project environment</a></h1>
<p>On GitHub, make sure to create a new folder for each week&#39;s exercises.</p>
<p>Each week&#39;s folder should be a Julia project, i.e. contain a <code>Project.toml</code> file.</p>
<p>This can be achieved by typing entering the Pkg mode from the Julia REPL in the tatrget folder</p>
<pre><code class="julia-repl hljs"><span class=hljs-meta >julia&gt;</span><span class=language-julia > ]
</span>
<span class=hljs-metap>(@v1.6) pkg&gt;</span> activate .

<span class=hljs-metap>(lectureXX) pkg&gt;</span> add Plots</code></pre>
<p>and adding at least one package.</p>
<p>In addition, it is recommended to have the following structure and content:</p>
<ul>
<li><p>lectureXX</p>
<ul>
<li><p><code>README.md</code></p>

<li><p><code>Project.toml</code></p>

<li><p><code>Manifest.toml</code></p>

<li><p>docs/</p>

<li><p>scripts/</p>

</ul>

</ul>
<p>Codes could be placed in the <code>scripts/</code> folder. Output material to be displayed in the <code>README.md</code> could be placed in the <code>docs/</code> folder.</p>
<p>The <code>Manifest.toml</code> file should be kept local. An automated way of doing so is to add it as entry to a <code>.gitignore</code> file in the root of your repo. Mac users may also add <code>.DS_Store</code> to their <code>.gitignore</code>.</p>

<p><a href="#content">⤴ <em><strong>back to Content</strong></em></a></p>
<h1 id=exercises_-_lecture_4 ><a href="#exercises_-_lecture_4" class=header-anchor >Exercises - lecture 4</a></h1>
<div class=warning ><div class=title >⚠️ Warning&#33;</div>
<div class=messg >Exercises have to be handed in as monolithic Julia scripts &#40;one code per script&#41; and uploaded to your private &#40;shared&#41; GitHub repository, in a <strong>specific folder for each lecture</strong>. The git commit hash &#40;or SHA&#41; of the final push needs to be uploaded on Moodle &#40;<a href="/course-101-0250-00/homework">more</a>&#41;.</div></div>
<h2 id=exercise_1_-_nonlinear_diffusion_in_2d ><a href="#exercise_1_-_nonlinear_diffusion_in_2d" class=header-anchor >Exercise 1 - <strong>Nonlinear diffusion in 2D</strong></a></h2>
<p>👉 See <a href="/course-101-0250-00/logistics/#submission">Logistics</a> for submission details.</p>
<p>The goal of this exercise is to:</p>
<ul>
<li><p>Implement a 2D nonlinear diffusion equation</p>

<li><p>Consolidate the finite-difference discretisation</p>

</ul>
<p>In this first exercise, you will port the shallow ice-like 1D nonlinear diffusion code we did in class to a 2D implementation.</p>
<p>Starting from the 1D nonlinear diffusion equation we discussed in lecture 4, extend the 1D code to a 2D configuration. Use the same parameters for the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>-dimension quantities as the one you already have for the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>-dimension.</p>
<div class=note ><div class=title >💡 Note</div>
<div class=messg >Don&#39;t forget to initialise &#40;pre-allocate&#41; all arrays &#40;vectors&#41; needed in the calculations. You will also need to handle the effective diffusivities in both <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> directions to account for correct staggering.</div></div>
<h3 id=task_1 ><a href="#task_1" class=header-anchor >Task 1</a></h3>
<p>Create a new folder in your GitHub repository for this week&#39;s &#40;lecture 4&#41; exercises. In there, create a new Julia script <code>diffusion_nl_2D.jl</code> for this homework. The script should produce a <code>heatmap&#40;&#41;</code> plot that updates upon time steps, with labelled axes and physical time displayed as title.</p>
<p>Use <code>nx &#61; 128</code> and <code>ny &#61; 129</code> grid points.</p>
<h3 id=task_2 ><a href="#task_2" class=header-anchor >Task 2</a></h3>
<p>Track the maximal ice thickness over time and report it in a plot as function of time.</p>

<p><a href="#content">⤴ <em><strong>back to Content</strong></em></a></p>
<hr />
<h2 id=exercise_2_-_damped_laplacian ><a href="#exercise_2_-_damped_laplacian" class=header-anchor >Exercise 2 - <strong>Damped Laplacian</strong></a></h2>
<p>👉 See <a href="/course-101-0250-00/logistics/#submission">Logistics</a> for submission details.</p>
<p>The goal of this exercise is to:</p>
<ul>
<li><p>Investigate second-order acceleration</p>

<li><p>Derive scaling relation &#40;number of iterations as function of number of grid points&#41;</p>

</ul>
<p>In this exercise you will investigate the scalability of the first and second order iterative schemes discussed during lecture 4.</p>
<p>Start from the <code>Laplacian_damped.jl</code> script we realised in class, which should contain two &quot;switches&quot;:</p>
<ul>
<li><p><code>order</code> &#40;1st or 2nd order scheme&#41;</p>

<li><p><code>fact</code> &#40;factor to multiply the number of grid points&#41;</p>

</ul>
<p>👉 Download the <code>Laplacian_damped.jl</code> script <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/scripts/">here</a> if needed &#40;available after the course&#41;.</p>
<p>Add a copy of the <code>Laplacian_damped.jl</code> script we did in class to your exercise folder. Modify that script to perform systematics to assess the scalability of the damped versus the non-damped Laplacian 2D implementation.</p>
<h3 id=task_1__2 ><a href="#task_1__2" class=header-anchor >Task 1</a></h3>
<p>As first task, modify the iteration exit criteria such that the you can report the iteration count needed for <code>maximum&#40;abs.&#40;A&#41;&#41;</code> to hit an absolute tolerance of <code>ε &#61; 1e-9</code>.</p>
<h3 id=task_2__2 ><a href="#task_2__2" class=header-anchor >Task 2</a></h3>
<p>Using this modified code, realise a scaling experiment where you report the total number of iterations needed to reach <code>ε</code> as function of the number of grid points <code>nx</code>, for <code>nx &#61; 25 * 2 .^ &#40;1:8&#41;</code>. Repeat the experiment for both the damped and non-damped implementation &#40;using e.g. the <code>order</code> flag&#41;.</p>
<h3 id=task_3 ><a href="#task_3" class=header-anchor >Task 3</a></h3>
<p>Report your scaling results on a figure, plotting the number of iterations as function of the number of grid points. Save the figure as <code>png</code> and include it to the lecture 4 <code>README.md</code>. Comment the trends you observe.</p>
<div class=note ><div class=title >💡 Note</div>
<div class=messg >Use <code>&#33;&#91;fig_name&#93;&#40;./&lt;relative-path&gt;/my_fig.png&#41;</code> to insert a figure in the <code>README.md</code>.</div></div>
<h3 id=task_4_optional ><a href="#task_4_optional" class=header-anchor >Task 4 <em>&#40;optional&#41;</em></a></h3>
<p>Investigate the effect of varying the damping parameter <code>dmp</code> on the iteration count, thus on the scaling. Add an additional figure to the <code>README.md</code> and comment about it.</p>

<p><a href="#content">⤴ <em><strong>back to Content</strong></em></a></p>
<hr />
<h2 id=exercise_3_-_nonlinear_steady-state_diffusion_1d ><a href="#exercise_3_-_nonlinear_steady-state_diffusion_1d" class=header-anchor >Exercise 3 - <strong>Nonlinear steady-state diffusion 1D</strong></a></h2>
<p>👉 See <a href="/course-101-0250-00/logistics/#submission">Logistics</a> for submission details.</p>
<p>The goal of this exercise is to:</p>
<ul>
<li><p>Investigate second-order acceleration</p>

<li><p>Implement a fast implicit nonlinear diffusion solver</p>

</ul>
<p>In this exercise you will transform the explicit nonlinear 1D diffusion solver to achieve a steady state solution, and, in a second step, achieve a fast solution relying on the second-order implementation. The model could be applied, e.g., to predict spatial distribution of pollutant in the subsurface.</p>
<p>To get started, save a copy of the <code>diffusion_nl_1D.jl</code> script we did in class &#40;also available <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/scripts/">here</a> after the lecture&#41;, name it <code>diffusion_nl_1D_steady_1.jl</code>, and implement the changes tasked below.</p>
<h3 id=task_1__3 ><a href="#task_1__3" class=header-anchor >Task 1</a></h3>
<p>As first task, adapt the parameters and the implementation. In the <code># Physics</code> section, set the total simulation time <code>ttot &#61; 2e4</code> and move the <code>D0</code> initialisation to the <code># Array initialisation</code> section.</p>
<p>In the <code># Numerics</code> section, add the nonlinear tolerance the solver should converge to, <code>epsi &#61; 1e-10</code>.</p>
<p>Since we are interested in a concentration, rename the quantity to be diffused from <code>H</code> to <code>C</code>, and initialise it as a Gaussian profile centred in <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">x = 0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span></span></span></span> with standard deviation <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">σ=1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >1</span></span></span></span> and amplitude of 0.5.</p>
<p>Initialise the diffusivity <code>D0 &#61; 5</code> in every grid point of the domain. In the region <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >[</mo><mn>0.6</mn><mtext> </mtext><msub><mi>L</mi><mi>x</mi></msub><mo>−</mo><mn>0.8</mn><mtext> </mtext><msub><mi>L</mi><mi>x</mi></msub><mo stretchy=false >]</mo></mrow><annotation encoding="application/x-tex">[0.6~L_x - 0.8~L_x]</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >[</span><span class=mord >0</span><span class=mord >.</span><span class=mord >6</span><span class="mspace nobreak"> </span><span class=mord ><span class="mord mathnormal">L</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >0</span><span class=mord >.</span><span class=mord >8</span><span class="mspace nobreak"> </span><span class=mord ><span class="mord mathnormal">L</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >]</span></span></span></span>, the subsurface is less permeable thus the values of <code>D0&#61;1.5</code>. Also, initialise all arrays that would require it.</p>
<p>Finally, as boundary conditions, fix the concentration in the left &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>x</mi><mi mathvariant=normal >/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">dx/2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">x</span><span class=mord >/</span><span class=mord >2</span></span></span></span>&#41; and right &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mi>x</mi></msub><mo>−</mo><mi>d</mi><mi>x</mi><mi mathvariant=normal >/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">L_x-dx/2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">L</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">x</span><span class=mord >/</span><span class=mord >2</span></span></span></span>&#41; cell centre to 0.5 and 0.1, respectively.</p>
<p>Define the time or iteration loop to, e.g., run from <code>t&#61;0</code> until <code>t&#61;ttot</code>, and to abort if the error drops below <code>epsi</code>. Note that another implementation of your choice of the loop is fine too. Define the error as the <code>maximum&#40;abs.&#40;∆C&#41;&#41;</code>, where <code>∆C</code> is the difference between the values of concentration before and after the update at every iteration or time step &#40;you can use unicode characters in Julia&#41;.</p>
<p>Report graphically the distribution of the concentration <code>C</code> as function of <code>x</code>, adding axes labels and a title reporting time, iteration count and current error.</p>
<h3 id=task_2__3 ><a href="#task_2__3" class=header-anchor >Task 2</a></h3>
<p>As you realised, it takes a large amount of iterations to converge the transient problem to a steady state. In this second task, you will accelerate the nonlinear diffusion solver using the second order method.</p>
<p>Duplicate the <code>diffusion_nl_1D_steady_1.jl</code> and rename the copy to <code>diffusion_nl_1D_steady_2.jl</code>.</p>
<p>Then, add to the <code># Numerics</code> section a relaxation factor <code>rel &#61; 0.1</code> that we will use to implement a continuation on the nonlinear diffusion coefficient.</p>
<p>In the <code># Derived numerics</code> section, add the damping factor <code>dmp &#61; 1.0 - 2π/nx</code>, which is the value that will most optimally damp the damped-wave equation we will solve using the second order method.</p>
<p>Initialise the effective diffusion coefficient array <code>D</code> to 1, setting the initial guess for the relaxation.</p>
<p>In the time or iteration loop, implement the relaxation &#40;or continuation&#41; on the effective diffusion coefficient array <code>D</code>, such that at each iteration, <code>&#40;1-rel&#41;</code> from the previous values of <code>D</code> is being added to <code>rel</code> times the new value, computed as <code>&#40;D0.*C&#41;.^n</code> &#40;the physical expression of <code>D</code>&#41;.</p>
<p>Because we are only interested in the final distribution of <code>C</code>, at steady-state, the time step <code>dt</code> turns in a numerical parameter that no longer needs to be a scalar; it should be defined locally to each grid point; we do no longer need the global reduction <code>maximum&#40;D&#41;</code>. Adapt the <code>dt</code> formula to use the <em><strong>local maximum</strong></em> amongst direct neighbouring grid points for <code>D</code> &#40;in every point of the domain&#41;.</p>
<div class=note ><div class=title >💡 Note</div>
<div class=messg >In 1D, a <code>maxloc&#40;&#41;</code> function could be defined as such <code>@views maxloc&#40;A&#41; &#61; max.&#40;A&#91;1:end-2&#93;,A&#91;2:end-1&#93;,A&#91;3:end&#93;&#41;</code>.</div></div>
<p>Finally, and most important, modify the <code>dCdt</code> update operation to incorporate the damping term applied to the values of <code>dCdt</code> from the previous iteration. To implement the second order scheme, turn the <code>dCdt</code> assignment to an update, where you add to current definition of <code>dCdt</code> previous values of <code>dCdt*dmp</code>:</p>
<pre><code class="julia hljs">dCdt .= dCdt.*dmp .+ ...</code></pre>
<h3 id=task_3__2 ><a href="#task_3__2" class=header-anchor >Task 3</a></h3>
<p>Report graphically the distribution of the concentration <code>C</code> as function of <code>x</code>, adding axes labels and title reporting iteration count and current error.</p>
<p>Reflect on the speed-up obtained by the second-order method and feel free to add a comment about it.</p>
<div class=note ><div class=title >💡 Note</div>
<div class=messg >The iteration count for the accelerated 1D code should be in the order of 3400.</div></div>
<p>🎉 Well-done&#33; This was a long one. Here is a sample output the code should produce:</p>
<p><img src="../assets/literate_figures/steady_1D_ex4.png" alt=steady_1D_ex4  /></p>

<p><a href="#content">⤴ <em><strong>back to Content</strong></em></a></p>
<hr />
<h2 id=exercise_4_-_nonlinear_steady-state_diffusion_2d ><a href="#exercise_4_-_nonlinear_steady-state_diffusion_2d" class=header-anchor >Exercise 4 - <strong>Nonlinear steady-state diffusion 2D</strong></a></h2>
<p>👉 See <a href="/course-101-0250-00/logistics/#submission">Logistics</a> for submission details.</p>
<p>The goal of this exercise is to:</p>
<ul>
<li><p>Investigate second-order acceleration</p>

<li><p>Implement a fast implicit nonlinear diffusion solver in 2D</p>

</ul>
<p>In this exercise you will transform the fast implicit nonlinear diffusion 1D solver from Exercise 3 to 2D.</p>
<p>To get started, save a copy of the <code>diffusion_nl_1D_steady_2.jl</code> script from <a href="#task_2__3">Exercise 3 - Task 2</a>, and name it <code>diffusion_nl_2D_steady_2.jl</code>.</p>
<h3 id=task_1__4 ><a href="#task_1__4" class=header-anchor >Task 1</a></h3>
<p>You will port the 1D code to 2D, duplicating, if needed, all parameters from the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>-dimension to the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>-dimension. <em>&#40;You can keep the definition of the damping term only function of <code>nx</code> since your domain is square.&#41;</em></p>
<p>In the <code># Array initialisation</code>, use following functions to initialise 3 ellipses where the background subsurface permeability is reduced from <code>D0 &#61; 5.0</code> to <code>D0 &#61; 1.5</code>:</p>
<pre><code class="julia hljs">rad2_1 = (xc .- <span class=hljs-number >2</span>*Lx/<span class=hljs-number >3</span>).^<span class=hljs-number >2</span> .* <span class=hljs-number >3</span> .+ (yc&#x27; .-   Ly/<span class=hljs-number >3</span>).^<span class=hljs-number >2</span> ./ <span class=hljs-number >4</span>
rad2_2 = (xc .- <span class=hljs-number >2</span>*Lx/<span class=hljs-number >3</span>).^<span class=hljs-number >2</span> ./ <span class=hljs-number >4</span> .+ (yc&#x27; .- <span class=hljs-number >2</span>*Ly/<span class=hljs-number >3</span>).^<span class=hljs-number >2</span> .* <span class=hljs-number >3</span>
rad2_3 = (xc .-   Lx/<span class=hljs-number >3</span>).^<span class=hljs-number >2</span> .* <span class=hljs-number >1</span> .+ (yc&#x27; .-   Ly/<span class=hljs-number >2</span>).^<span class=hljs-number >2</span> ./ <span class=hljs-number >1</span></code></pre>
<p>Use these &quot;radius&quot; functions to set the values of <code>D0 &#61; 1.5</code> when the radius is smaller then 1.0 &#40;for all 3 cases&#41;.</p>
<p>As boundary conditions, set <code>C &#61; 0.5</code> at <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mi>d</mi><mi>x</mi><mi mathvariant=normal >/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">x=dx/2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">x</span><span class=mord >/</span><span class=mord >2</span></span></span></span> and <code>C &#61; 0.1</code> at <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mi>L</mi><mi>x</mi><mo>−</mo><mi>d</mi><mi>x</mi><mi mathvariant=normal >/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">x=Lx-dx/2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal">x</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">x</span><span class=mord >/</span><span class=mord >2</span></span></span></span>. Implement a &quot;no-flux&quot; boundary condition &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>∆</mtext><mi>C</mi></mrow><annotation encoding="application/x-tex">∆C</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class=mord >∆</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span> vanishes in the direction orthogonal to the boundary&#41; at <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mi>d</mi><mi>y</mi><mi mathvariant=normal >/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">y=dy/2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mord >/</span><span class=mord >2</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mi>L</mi><mi>y</mi><mo>−</mo><mi>d</mi><mi>y</mi><mi mathvariant=normal >/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">y=Ly-dy/2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mord >/</span><span class=mord >2</span></span></span></span>.</p>
<div class=note ><div class=title >💡 Note</div>
<div class=messg >Take care to adapt the iterative time step condition for 2D diffusion and think about how to modify the <code>maxloc&#40;&#41;</code> function for 2D purposes, taking the local maximum amongst all 8 neighbours for each grid point.</div></div>
<p>Report graphically the distribution of concentration <code>C</code> as function of <code>x</code> and <code>y</code> using a heatmap plot, adding axes labels and title reporting time, iteration count and current error.</p>
<div class=note ><div class=title >💡 Note</div>
<div class=messg >The iteration count for the accelerated 2D code should be in the order of 4500.</div></div>
<p>Here is a sample output the code should produce:</p>
<p><img src="../assets/literate_figures/steady_2D_ex4.png" alt=steady_2D_ex4  /></p>

<p><a href="#content">⤴ <em><strong>back to Content</strong></em></a></p>
<div class=page-foot >
  <div class=copyright >
    <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/"><b>Edit this page on <img class=github-logo  src="https://unpkg.com/ionicons@5.1.2/dist/svg/logo-github.svg"></b></a><br>
    Last modified: December 07, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div>
    </div>