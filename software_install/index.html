<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <script src="/libs/lunr/lunr.min.js"></script> <script src="/libs/lunr/lunr_index.js"></script> <script src="/libs/lunr/lunrclient.min.js"></script> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/poole_hyde.css"> <link rel=stylesheet  href="/css/custom.css"> <style> html {font-size: 17px;} .franklin-content {position: relative; padding-left: 8%; padding-right: 5%; line-height: 1.35em;} @media (min-width: 940px) { .franklin-content {width: 100%; margin-left: auto; margin-right: auto;} } @media (max-width: 768px) { .franklin-content {padding-left: 6%; padding-right: 6%;} } </style> <link rel=icon  href="/assets/favicon.png"> <title>Software install</title> <style> .content {max-width: 50rem} </style> <div class=sidebar > <div class="container sidebar-sticky"> <div class=sidebar-about > <img src="/assets/vaw_logo.png" style="width: 180px; height: auto; display: inline"> <div style="font-weight: margin-bottom: 0.5em"><a href="/"> Fall 2022</a> <span style="opacity: 0.7;">| <a href="http://www.vvz.ethz.ch/Vorlesungsverzeichnis/lerneinheit.view?semkez=2022W&ansicht=KATALOGDATEN&lerneinheitId=162403&lang=en"> ETHZ 101-0250-00</a></span></div> <br> <h1><a href="/">Solving partial differential equations in parallel on GPUs</a></h1> <div style="line-height:18px; font-size: 15px; opacity: 0.85">by &nbsp; <a href="https://vaw.ethz.ch/en/people/person-detail.MjcwOTYw.TGlzdC8xOTYxLDE1MTczNjI1ODA=.html">Ludovic RÃ¤ss</a>, &nbsp; <a href="https://vaw.ethz.ch/en/personen/person-detail.html?persid=124402">Mauro Werder</a>, &nbsp; <a href="https://www.cscs.ch/about/staff/">Samuel Omlin</a> & <br> <a href="https://vaw.ethz.ch/en/people/person-detail.MzAwMjIy.TGlzdC8xOTYxLDE1MTczNjI1ODA=.html">Ivan Utkin</a> </div> </div> <br> <style> </style> <nav class=sidebar-nav  style="opacity: 0.9; margin-bottom: 1.2cm;"> <a class="sidebar-nav-item " href="/"><b>Welcome</b></a> <a class="sidebar-nav-item " href="/logistics/">Logistics</a> <a class="sidebar-nav-item " href="/homework/">Homework</a> <a class="sidebar-nav-item active" href="/software_install/">Software install</a> <a class="sidebar-nav-item " href="/extras/">Extras</a> <br> <div class=course-section >Part 1 - Introduction</div> <a class="sidebar-nav-item " href="/lecture1/">Lecture 1 - Why Julia GPU</a> <a class="sidebar-nav-item " href="/lecture2/">Lecture 2 - PDEs and physical processes</a> <a class="sidebar-nav-item " href="/lecture3/">Lecture 3 - Acoustic waves</a> <div class=course-section >Part 2 - Solving PDEs on GPUs</div> <a class="sidebar-nav-item " href="/lecture4/">Lecture 4 - Implicit & nonlinear</a> <a class="sidebar-nav-item " href="/lecture5/">Lecture 5 - Parallel computing</a> <a class="sidebar-nav-item " href="/lecture6/">Lecture 6 - GPU computing & perf</a> <div class=course-section >Part 3 - Multi-GPU computing (projects)</div> <a class="sidebar-nav-item " href="/lecture7/">Lecture 7 - XPU computing</a> <a class="sidebar-nav-item " href="/lecture8/">Lecture 8 - Julia MPI & multi-XPU</a> <a class="sidebar-nav-item " href="/lecture9/">Lecture 9 - Advanced optimisations</a> <div class=course-section >Final Projects</div> <a class="sidebar-nav-item " href="/lecture10/">Lecture 10 - Final projects</a> </nav> <form id=lunrSearchForm  name=lunrSearchForm > <input class=search-input  name=q  placeholder="Enter search term" type=text > <input type=submit  value=Search  formaction="/search/index.html"> </form> <br> <br> </div> </div> <div class="content container"> <div class=franklin-content > <h1 id=software_install ><a href="#software_install" class=header-anchor >Software install</a></h1> <div class=franklin-toc ><ol><li><a href="#software_install">Software install</a><ol><li><a href="#opening_and_running_the_jupyter_julia_notebook">Opening and running the Jupyter Julia notebook</a><li><a href="#installing_julia_v18_or_later">Installing Julia v1.8 &#40;or later&#41;</a><li><a href="#running_julia">Running Julia</a></ol></ol></div> <h2 id=opening_and_running_the_jupyter_julia_notebook ><a href="#opening_and_running_the_jupyter_julia_notebook" class=header-anchor >Opening and running the Jupyter Julia notebook</a></h2> <h3 id=course_slides_and_lecture_material ><a href="#course_slides_and_lecture_material" class=header-anchor >Course slides and lecture material</a></h3> <p>All the course slides are <a href="https://jupyter.org/">Jupyter notebooks</a>; browser-based computational notebooks.</p> <p>Code cells are executed by putting the cursor into the cell and hitting <code>shift &#43; enter</code>. For more info see the <a href="https://jupyter-notebook.readthedocs.io/en/stable/">documentation</a>.</p> <h3 id=exercises_and_homework ><a href="#exercises_and_homework" class=header-anchor >Exercises and homework</a></h3> <p>The first two lecture&#39;s homework assignments will be <a href="https://jupyter.org/">Jupyter notebooks</a>. You&#39;ll find them on Moodle within your <a href="https://moodle-app2.let.ethz.ch/mod/lti/view.php?id&#61;780549">Jupyter Hub</a> space. You can execute them on the <a href="https://moodle-app2.let.ethz.ch/mod/lti/view.php?id&#61;780549">Jupyter Hub</a> or download them and run them them locally if you&#39;re already set-up.</p> <p>For submission, download the final <code>.ipynb</code> notebooks from the server, or collect the local <code>.ipynb</code> notebooks into a single local folder you then upload to Moodle. See <a href="/logistics">Logistics</a> and <a href="/homework">Homework</a> for details.</p> <p>Starting from lecture 3, exercise scripts will be mostly standalone regular Julia scripts that have to be uploaded to your private git repo &#40;shared with the teaching staff only&#41;. Details in <a href="/logistics/#submission">Logistics</a>.</p> <h2 id=installing_julia_v18_or_later ><a href="#installing_julia_v18_or_later" class=header-anchor >Installing Julia v1.8 &#40;or later&#41;</a></h2> <p>Check you have an active internet connexion and <a href="https://julialang.org/downloads/">download Julia v1.8</a> for your platform following the install directions provided under <strong>&#91;help&#93;</strong>.</p> <p>Alternatively, open a terminal and download the binaries &#40;select the one for your platform&#41;:</p> <pre><code class="sh hljs">wget https://julialang-s3.julialang.org/bin/winnt/x64/1.8/julia-1.8.0-win64.exe <span class=hljs-comment ># Windows</span>
wget https://julialang-s3.julialang.org/bin/mac/x64/1.8/julia-1.8.0-mac64.dmg <span class=hljs-comment ># macOS</span>
wget https://julialang-s3.julialang.org/bin/linux/x64/1.8/julia-1.8.0-linux-x86_64.tar.gz <span class=hljs-comment ># Linux x86</span></code></pre> <p>Then extract them and add Julia to <code>PATH</code> &#40;usually done in your <code>.bashrc</code>, <code>.profile</code>, or <code>config</code> file&#41;.</p> <blockquote> <p><strong>Note for Windows users</strong><br />When installing Julia 1.8 on Windows, make sure to check the &quot;Add PATH&quot; tick or ensure Julia is on PATH &#40;see <strong>&#91;help&#93;</strong>&#41;. Julia&#39;s REPL has a built-in shell mode you can access typing <code>;</code> that natively works on Unix-based systems. On Windows, you can access the Windows shell by typing <code>Powershell</code> within the shell mode, and exit it typing <code>exit</code>, as described <a href="https://docs.julialang.org/en/v1/stdlib/REPL/#man-shell-mode">here</a>.</p> </blockquote> <h3 id=terminal_external_editor ><a href="#terminal_external_editor" class=header-anchor >Terminal &#43; external editor</a></h3> <p>Ensure you have a text editor with syntax highlighting support for Julia. <a href="https://www.sublimetext.com/download">Sublime Text</a> and <a href="https://atom.io">Atom</a> can be recommended.</p> <p>From within the terminal, type</p> <pre><code class="sh hljs">julia</code></pre>
<p>to make sure that the Julia REPL &#40;aka terminal&#41; starts. Then you should ba able to add <code>1&#43;1</code> and verify you get the expected result. Exit with <code>Ctrl-d</code>.</p>
<p><img src="/assets/julia_terminal.png" alt="Julia from Terminal" /></p>
<h3 id=vs_code ><a href="#vs_code" class=header-anchor >VS Code</a></h3>
<p>If you&#39;d enjoy a more IDE type of environment, <a href="https://code.visualstudio.com">check out VS Code</a>. Follow the <a href="https://github.com/julia-vscode/julia-vscode#getting-started">installation directions</a> for the <a href="https://www.julia-vscode.org">Julia VS Code extension</a>.</p>
<h4 id=vs_code_remote_-_ssh_setup ><a href="#vs_code_remote_-_ssh_setup" class=header-anchor >VS Code Remote - SSH setup</a></h4>
<p>VS Code&#39;s <a href="https://marketplace.visualstudio.com/items?itemName&#61;ms-vscode-remote.remote-ssh">Remote - SSH</a> extension allows you to connect and open a remote folder on any remote machine with a running SSH server. Once connected to a server, you can interact with files and folders anywhere on the remote filesystem &#40;<a href="https://code.visualstudio.com/docs/remote/ssh">more</a>&#41;.</p>
<ol>
<li><p>To get started, follow <a href="https://code.visualstudio.com/docs/remote/ssh#_installation">the install steps</a>.</p>

<li><p>Then, you can <a href="https://code.visualstudio.com/docs/remote/ssh#_connect-to-a-remote-host">connect to a remote host</a>, using <code>ssh user@hostname</code> and your password &#40;selecting <code>Remote-SSH: Connect to Host...</code> from the Command Palette&#41;.</p>

<li><p><a href="https://code.visualstudio.com/docs/remote/ssh#_remember-hosts-and-advanced-settings">Advanced options</a> permit you to <a href="#connect_to_the_machine_and_to_your_compute_node_from_vs_code">access a remote compute node from within VS Code</a>.</p>

</ol>
<div class=note ><div class=title >ðŸ’¡ Note</div>
<div class=messg >This remote configuration supports Julia graphics to render within VS Code&#39;s plot pane. However, this &quot;remote&quot; visualisation option is only functional when plotting from a Julia instance launched as <code>Julia: Start REPL</code> from the Command Palette. Displaying a plot from a Julia instance launched from the remote terminal &#40;which allows, e.g., to include custom options such as <code>ENV</code> variables or load modules&#41; will fail. To work around this limitation, select <code>Julia: Connect external REPL</code> from the Command Palette and follow the prompted instructions.</div></div>
<h2 id=running_julia ><a href="#running_julia" class=header-anchor >Running Julia</a></h2>
<h3 id=first_steps ><a href="#first_steps" class=header-anchor >First steps</a></h3>
<p>Now that you have a running Julia install, launch Julia &#40;e.g. by typing <code>julia</code> in the shell since it should be on path&#41;</p>
<pre><code class="sh hljs">julia</code></pre>
<p>Welcome in the <a href="https://docs.julialang.org/en/v1/stdlib/REPL/">Julia REPL</a> &#40;command window&#41;. There, you have 3 &quot;modes&quot;, the standard</p>
<pre><code class="julia-repl hljs">[user@comp ~]$ julia
               _
   _       _ _(_)_     |  Documentation: https://docs.julialang.org
  (_)     | (_) (_)    |
   _ _   _| |_  __ _   |  Type &quot;?&quot; for help, &quot;]?&quot; for Pkg help.
  | | | | | | |/ _` |  |
  | | |_| | | | (_| |  |  Version 1.8.0 (2022-08-17)
 _/ |\__&#x27;_|_|_|\__&#x27;_|  |  Official https://julialang.org/ release
|__/                   |

<span class="hljs-meta prompt_">julia&gt;</span></code></pre>
<p>the shell mode by hitting <code>;</code>, where you can enter Unix commands,</p>
<pre><code class="julia-repl hljs"><span class=hljs-metas>shell&gt;</span></code></pre>
<p>and the <a href="https://docs.julialang.org/en/v1/stdlib/REPL/#Pkg-mode">Pkg mode</a> &#40;package manager&#41; by hitting <code>&#93;</code>, that will be used to add and manage packages, and environments,</p>
<pre><code class="julia-repl hljs"><span class=hljs-metap>(@v1.8) pkg&gt;</span></code></pre>
<p>You can interactively execute commands in the REPL, like adding two numbers</p>
<pre><code class="julia-repl hljs"><span class="hljs-meta prompt_">julia&gt;</span><span class=language-julia > <span class=hljs-number >2</span>+<span class=hljs-number >2</span>
</span>4

<span class="hljs-meta prompt_">julia&gt;</span></code></pre>
<p>Within this class, we will mainly work with Julia scripts. You can run them using the <code>include&#40;&#41;</code> function in the REPL</p>
<pre><code class="julia-repl hljs"><span class="hljs-meta prompt_">julia&gt;</span><span class=language-julia > include(<span class=hljs-string >&quot;my_script.jl&quot;</span>)</span></code></pre>
<p>Alternatively, you can also execute a Julia script from the shell</p>
<pre><code class="sh hljs">julia -O3 --check-bounds=no my_script.jl</code></pre>
<p>here passing the <code>-O3</code> optimisation flag, and the Julia <code>--check-bounds</code> flag set to <code>no</code> in order to deactivate out-of-bound checking.</p>
<h3 id=package_manager ><a href="#package_manager" class=header-anchor >Package manager</a></h3>
<p>The <a href="https://docs.julialang.org/en/v1/stdlib/REPL/#Pkg-mode">Pkg mode</a> permits you to install and manage Julia packages, and control the project&#39;s environment.</p>
<p>Environments or Projects are an efficient way that enable portability and reproducibility. Upon activating a local environment, you generate a local <code>Project.toml</code> file that stores the packages and version you are using within a specific project &#40;code-s&#41;, and a <code>Manifest.toml</code> file that keeps track locally of the state of the environment. </p>
<p>To activate an project-specific environment, navigate to your targeted project folder, launch Julia</p>
<pre><code class="sh hljs"><span class=hljs-built_in >mkdir</span> my_cool_project
<span class=hljs-built_in >cd</span> my_cool_project 
julia</code></pre>
<p>and activate it</p>
<pre><code class="julia-repl hljs"><span class="hljs-meta prompt_">julia&gt;</span><span class=language-julia > ]
</span>
<span class=hljs-metap>(@v1.8) pkg&gt;</span> 

<span class=hljs-metap>(@v1.8) pkg&gt;</span> activate .
  Activating new environment at `~/my_cool_project/Project.toml`

<span class=hljs-metap>(my_cool_project) pkg&gt;</span></code></pre>
<p>Then, let&#39;s install the <code>Plots.jl</code> package</p>
<pre><code class="julia-repl hljs"><span class=hljs-metap>(my_cool_project) pkg&gt;</span> add Plots</code></pre>
<p>and check the status</p>
<pre><code class="julia-repl hljs"><span class=hljs-metap>(my_cool_project) pkg&gt;</span> st
      Status `~/my_cool_project/Project.toml`
  [91a5bcdd] Plots v1.22.3</code></pre>
<p>as well as the <code>.toml</code> files</p>
<pre><code class="julia-repl hljs"><span class="hljs-meta prompt_">julia&gt;</span><span class=language-julia > ;
</span>
<span class=hljs-metas>shell&gt;</span> ls
Manifest.toml Project.toml</code></pre>
<p>We can now load <code>Plots.jl</code> and plot some random noise</p>
<pre><code class="julia-repl hljs"><span class="hljs-meta prompt_">julia&gt;</span><span class=language-julia > <span class=hljs-keyword >using</span> Plots
</span>
<span class="hljs-meta prompt_">julia&gt;</span><span class=language-julia > heatmap(rand(<span class=hljs-number >10</span>,<span class=hljs-number >10</span>))</span></code></pre>
<p>Let&#39;s assume you&#39;re handed your <code>my_cool_project</code> to someone to reproduce your cool random plot. To do so, you can open julia from the <code>my_cool_project</code> folder with the <code>--project</code> option</p>
<pre><code class="sh hljs"><span class=hljs-built_in >cd</span> my_cool_project 
julia --project</code></pre>
<p>Or you can rather activate it afterwards</p>
<pre><code class="sh hljs"><span class=hljs-built_in >cd</span> my_cool_project 
julia</code></pre>
<p>and then,</p>
<pre><code class="julia-repl hljs"><span class="hljs-meta prompt_">julia&gt;</span><span class=language-julia > ]
</span>
<span class=hljs-metap>(@v1.8) pkg&gt;</span> activate .
  Activating environment at `~/my_cool_project/Project.toml`

<span class=hljs-metap>(my_cool_project) pkg&gt;</span> 

<span class=hljs-metap>(my_cool_project) pkg&gt;</span> st
      Status `~/my_cool_project/Project.toml`
  [91a5bcdd] Plots v1.22.3</code></pre>
<p>Here we go, you can now share that folder with colleagues or with yourself on another machine and have a reproducible environment ðŸ™‚</p>
<h3 id=multi-threading_on_cpus ><a href="#multi-threading_on_cpus" class=header-anchor >Multi-threading on CPUs</a></h3>
<p>On the CPU, <a href="https://docs.julialang.org/en/v1/manual/multi-threading/#man-multithreading">multi-threading</a> is made accessible via <a href="https://docs.julialang.org/en/v1/base/multi-threading/">Base.Threads</a>. To make use of threads, Julia needs to be launched with</p>
<pre><code class="sh hljs">julia --project -t auto</code></pre>
<p>which will launch Julia with as many threads are there are cores on your machine &#40;including hyper-threaded cores&#41;. Alternatively set the environment variable <code>JULIA_NUM_THREADS</code>, e.g. <code>export JULIA_NUM_THREADS&#61;2</code> to enable 2 threads.</p>
<h3 id=julia_on_gpus ><a href="#julia_on_gpus" class=header-anchor >Julia on GPUs</a></h3>
<p>The <a href="https://github.com/JuliaGPU/CUDA.jl">CUDA.jl</a> module permits to launch compute kernels on Nvidia GPUs natively from within Julia. <a href="https://juliagpu.org">JuliaGPU</a> provides further reading and <a href="https://juliagpu.gitlab.io/CUDA.jl/tutorials/introduction/">introductory material</a> about GPU ecosystems within Julia.</p>
<h3 id=julia_mpi ><a href="#julia_mpi" class=header-anchor >Julia MPI</a></h3>
<p>The following steps permit you to install <a href="https://github.com/JuliaParallel/MPI.jl">MPI.jl</a> on your machine and test it:</p>
<ol>
<li><p>If Julia MPI is a dependency of a Julia project MPI.jl should have been added upon executing the <code>instantiate</code> command from within the package manager <a href="#package_manager">see here</a>. If not, MPI.jl can be added from within the package manager &#40;typing <code>add MPI</code> in package mode&#41;.</p>

<li><p>Install <code>mpiexecjl</code>:</p>

</ol>
<pre><code class="julia-repl hljs"><span class="hljs-meta prompt_">julia&gt;</span><span class=language-julia > <span class=hljs-keyword >using</span> MPI
</span>
<span class="hljs-meta prompt_">julia&gt;</span><span class=language-julia > MPI.install_mpiexecjl()
</span>[ Info: Installing `mpiexecjl` to `HOME/.julia/bin`...
[ Info: Done!</code></pre>
<ol start=3 >
<li><p>Then, one should add <code>HOME/.julia/bin</code> to PATH in order to launch the Julia MPI wrapper <code>mpiexecjl</code>.</p>

<li><p>Running a Julia MPI code <code>&lt;my_script.jl&gt;</code> on <code>np</code> MPI processes:</p>

</ol>
<pre><code class="sh hljs">$ mpiexecjl -n np julia --project &lt;my_script.jl&gt;</code></pre>
<ol start=5 >
<li><p>To test the Julia MPI installation, launch the <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/blob/main/scripts/hello_mpi.jl"><code>hello_mpi.jl</code></a> using the Julia MPI wrapper <code>mpiexecjl</code> &#40;located in <code>~/.julia/bin</code>&#41; on, e.g., 4 processes:</p>

</ol>
<pre><code class="sh hljs">$ mpiexecjl -n 4 julia --project ./hello_mpi.jl
$ Hello world, I am 0 of 3
$ Hello world, I am 1 of 3
$ Hello world, I am 2 of 3
$ Hello world, I am 3 of 3</code></pre>
<div class=note ><div class=title >ðŸ’¡ Note</div>
<div class=messg ><p>On MacOS, you may encounter <a href="https://github.com/JuliaParallel/MPI.jl/issues/407">this issue</a>. To fix it, define following <code>ENV</code> variable:</p>
<pre><code class="sh hljs">$ <span class=hljs-built_in >export</span> MPICH_INTERFACE_HOSTNAME=localhost</code></pre>
<p>and add <code>-host localhost</code> to the execution script:</p>
<pre><code class="sh hljs">$ mpiexecjl -n 4 -host localhost julia --project ./hello_mpi.jl</code></pre></div></div>
<div class=page-foot >
  <div class=copyright >
    <a href="https://github.com/eth-vaw-glaciology/course-101-0250-00/"><b>Edit this page on <img class=github-logo  src="https://unpkg.com/ionicons@5.1.2/dist/svg/logo-github.svg"></b></a><br>
    Last modified: September 16, 2022. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div>
    </div>